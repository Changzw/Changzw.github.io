<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fri.</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://changzw.github.io/"/>
  <updated>2020-04-25T07:00:42.842Z</updated>
  <id>https://changzw.github.io/</id>
  
  <author>
    <name>Fri.</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SnapKit åˆ†æ</title>
    <link href="https://changzw.github.io/2020/04/10/source-code/SnapKit-%E5%88%86%E6%9E%90/"/>
    <id>https://changzw.github.io/2020/04/10/source-code/SnapKit-%E5%88%86%E6%9E%90/</id>
    <published>2020-04-10T07:24:23.000Z</published>
    <updated>2020-04-25T07:00:42.842Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:12 GMT+0800 (CST) --><a id="more"></a><p>å¯¹åº” <a href="https://changzw.github.io/2017/06/01/source-code/Masonry-%E5%88%86%E6%9E%90/">Masonry æºç åˆ†æ</a>, çœ‹è¿™ç¯‡æ–‡ç« å‰æœ€å¥½å…ˆçœ‹çœ‹è¿™ç¯‡</p><p>ï¼ˆDSL å…¶å®æ˜¯ Domain Specific Language çš„ç¼©å†™ï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰</p><p>åˆ†ææºç ï¼š</p><ol><li>è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œä»–è®¾è®¡çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>éœ€è¦å“ªäº›åŸºç¡€çŸ¥è¯†</li><li>æ•´ä½“ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„</li><li>ç”±å¤–è€Œå†…é€å±‚åˆ†æå±‚æ¬¡ç»“æ„</li><li>æ¯ä¸ªå±‚æ¬¡ç»“æ„çš„æ„å›¾æ˜¯ä»€ä¹ˆï¼Œä¸ºäº†å®ç°è¿™ä¸ªæ„å›¾ä»–ä½¿ç”¨äº†ä»€ä¹ˆæ–¹å¼ï¼Œè¿™ä¹ˆåšæœ‰ä»€ä¹ˆä¼˜ç‚¹</li><li>ä¸ºäº†è®©ç”¨æˆ·ä½¿ç”¨æ–¹ä¾¿ï¼Œå®ç°äº†ä»€ä¹ˆæ ·çš„æ¥å£ï¼Œä¸ºäº†å®ç°è¿™æ ·çš„æ¥å£åº•å±‚åˆæ˜¯å¦‚ä½•å®è·µçš„å‘¢ï¼Ÿ</li></ol><h2 id="snapkit-æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#snapkit-æ˜¯ä»€ä¹ˆ"></a> <code>SnapKit</code> æ˜¯ä»€ä¹ˆ</h2><p><a href="https://github.com/SnapKit/SnapKit" target="_blank" rel="noopener">SnapKit æºç åœ°å€</a></p><h2 id="ä¸ºä»€ä¹ˆè¦è®¾è®¡-snapkit"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆè¦è®¾è®¡-snapkit"></a> ä¸ºä»€ä¹ˆè¦è®¾è®¡ <code>SnapKit</code></h2><p>é¦–å…ˆå’Œç³»ç»Ÿæä¾›æ¥å£å¯¹æ¯”ä¸‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">label.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> constraint1 = <span class="type">NSLayoutConstraint</span>.<span class="keyword">init</span>(item: label,</span><br><span class="line">                                          attribute: .<span class="keyword">left</span>,</span><br><span class="line">                                          relatedBy: .<span class="built_in">equal</span>,</span><br><span class="line">                                          toItem: view,</span><br><span class="line">                                          attribute: .<span class="keyword">left</span>,</span><br><span class="line">                                          multiplier: <span class="number">1</span>,</span><br><span class="line">                                          constant: <span class="number">150</span>);</span><br><span class="line">constraint1.isActive = <span class="literal">true</span></span><br><span class="line">... top, width</span><br><span class="line"><span class="keyword">let</span> constraint4 = <span class="type">NSLayoutConstraint</span>.<span class="keyword">init</span>(item: label,</span><br><span class="line">                                          attribute: .height,</span><br><span class="line">                                          relatedBy: .<span class="built_in">equal</span>,</span><br><span class="line">                                          toItem: view,</span><br><span class="line">                                          attribute: .notAnAttribute,</span><br><span class="line">                                          multiplier: <span class="number">1</span>,</span><br><span class="line">                                          constant: <span class="number">20</span>);</span><br><span class="line">constraint4.isActive = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>Anchor: åªæ”¯æŒ ios &gt;= 9</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">label.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line"><span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">  label.leftAnchor.constraint(equalTo: view.leftAnchor, constant: <span class="number">150</span>),</span><br><span class="line">  label.topAnchor.constraint(equalTo: view.topAnchor, constant: <span class="number">200</span>),</span><br><span class="line">  label.widthAnchor.constraint(equalToConstant: <span class="number">200</span>),</span><br><span class="line">  label.heightAnchor.constraint(equalToConstant: <span class="number">200</span>),</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p><span id="code1"></span></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">label.snp.makeConstraints &#123; (make) <span class="keyword">in</span></span><br><span class="line">  make.<span class="keyword">left</span>.equalTo(view).offset(<span class="number">150</span>)</span><br><span class="line">  make.top.equalToSuperview().offset(<span class="number">200</span>)</span><br><span class="line">  make.size.equalTo(<span class="type">CGSize</span>(width: <span class="number">200</span>, height: <span class="number">20</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>P.S. SnapKit å†…éƒ¨ä¼šå¸®ä½ è°ƒç”¨ view.translatesAutoresizingMaskIntoConstraints = true</p><p>SnapKit è®¾è®¡çš„ç›®çš„ï¼Œå°±æ˜¯ä»¥é“¾å¼ç¼–ç¨‹æ‰‹æ®µå°è£… <code>NSLayoutConstraint</code> å†—ä½™ä»£ç ï¼</p><ol><li>å¦‚ä½•å¤„ç†åŸæ¥ç¹æ‚æ¥å£</li><li>å¦‚ä½•å®ç°é“¾å¼</li><li>å¦‚ä½•å°è£… <code>NSLayoutConstraint</code> çš„</li><li>å¦‚ä½•æŠŠå¤šä¸ª <code>NSLayoutConstraint</code> å°è£…æˆç®€å•çš„ä¸€å¥æå®šçš„</li><li>ä½¿ç”¨äº†ä½•ç§ç¼–ç¨‹æ‰‹æ®µ</li></ol><hr><h2 id="snapkit-ä»£ç ç»“æ„åˆ†æ"><a class="markdownIt-Anchor" href="#snapkit-ä»£ç ç»“æ„åˆ†æ"></a> <code>SnapKit</code> ä»£ç ç»“æ„åˆ†æ</h2><h3 id="ä»è°ƒç”¨å±‚æ¬¡åˆ†æ"><a class="markdownIt-Anchor" href="#ä»è°ƒç”¨å±‚æ¬¡åˆ†æ"></a> ä»è°ƒç”¨å±‚æ¬¡åˆ†æ</h3><p>è¿™é‡Œæˆ‘è¦åƒæ´‹è‘±ä¸€æ ·ä¸€å±‚ä¸€å±‚çš„æ‹¨å¼€</p><ol><li>æœ€å¤–å±‚æ¥å£<br>æ ¹æ®è¿™æ®µä»£ç åˆ†æ</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">label.snp.makeConstraints &#123; (make) <span class="keyword">in</span></span><br><span class="line">  make.<span class="keyword">left</span>.equalTo(view).offset(<span class="number">150</span>)</span><br><span class="line">  make.size.equalTo(<span class="type">CGSize</span>(width: <span class="number">200</span>, height: <span class="number">20</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ConstraintMaker.swift</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstraintMaker</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">left</span>: <span class="type">ConstraintMakerExtendable</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> top: <span class="type">ConstraintMakerExtendable</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> bottom: <span class="type">ConstraintMakerExtendable</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">right</span>: <span class="type">ConstraintMakerExtendable</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">prepareConstraints</span><span class="params">(item: LayoutConstraintItem, closure: <span class="params">(<span class="number">_</span> make: ConstraintMaker)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; [<span class="type">Constraint</span>]</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">makeConstraints</span><span class="params">(item: LayoutConstraintItem, closure: <span class="params">(<span class="number">_</span> make: ConstraintMaker)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">remakeConstraints</span><span class="params">(item: LayoutConstraintItem, closure: <span class="params">(<span class="number">_</span> make: ConstraintMaker)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">updateConstraints</span><span class="params">(item: LayoutConstraintItem, closure: <span class="params">(<span class="number">_</span> make: ConstraintMaker)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ğŸ‘†æºç å¯ä»¥çœ‹åˆ°</p><ul><li>ä¸‰ä¸ªè§åçŸ¥æ„çš„æ–¹æ³•</li><li>æ–¹æ³•å‚æ•° <code>ConstraintMaker</code> è¿™ä¸ªå°±æ˜¯ make</li><li>å±æ€§ <code>ConstraintMakerExtendable</code> è¿™ä¸ªå°±æ˜¯ make åé¢çš„ make.left</li></ul><p>æˆ‘æƒ³çŸ¥é“ï¼Œä»–çš„é“¾å¼æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå¦‚ä½•å°è£… autolayout ç›¸å…³çš„æ•°æ®çš„ï¼Œç›®å‰çœ‹åˆ°çš„åªæ˜¯å¹³å¸¸ä½¿ç”¨çš„æ¥å£<br>æˆ‘è¿˜è¦æ‰¾åˆ° ä¸‹å›¾çš„è¿™äº›ä¿¡æ¯<br><img src="/img/view_formula.jpeg" alt="view formula"></p><ol start="2"><li>æ¥ç€å¾€é‡Œé¢çœ‹</li></ol><ul><li><code>ConstraintMakerExtendable</code> ç»§æ‰¿è‡ª <code>ConstraintMakerRelatable</code></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstraintMakerExtendable</span> : <span class="title">ConstraintMakerRelatable</span>  </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">left</span>: <span class="type">ConstraintMakerExtendable</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.description.attributes += .<span class="keyword">left</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> top: <span class="type">ConstraintMakerExtendable</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.description.attributes += .top</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> bottom: <span class="type">ConstraintMakerExtendable</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.description.attributes += .bottom</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">right</span>: <span class="type">ConstraintMakerExtendable</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.description.attributes += .<span class="keyword">right</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br></pre></td></tr></table></figure><ul><li><p>é—®é¢˜&amp;çŒœæµ‹ï¼š</p><ul><li><code>description</code> æ˜¯å•¥ï¼Ÿä¸çŸ¥é“</li><li>ä¸è¿‡ä»–æœ‰ <code>attributes</code> å±æ€§ï¼Œçœ‹æ ·å­å¯¹åº” <code>NSLayoutConstraint.Attribute</code></li><li>left, top â€¦â€¦ è¿™äº›éƒ½è¿”å› <code>ConstraintMakerExtendable</code> ï¼ŒçŒœæµ‹ä»–æ˜¯é“¾çš„èŠ‚ç‚¹å¯¹è±¡</li></ul></li><li><p>ç»§ç»­çœ‹ <code>ConstraintMakerRelatable</code></p></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstraintMakerRelatable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">let</span> description: <span class="type">ConstraintDescription</span></span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(<span class="number">_</span> description: <span class="type">ConstraintDescription</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.description = description</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">relatedTo</span><span class="params">(<span class="number">_</span> other: ConstraintRelatableTarget, relation: ConstraintRelation, file: String, line: UInt)</span></span> -&gt; <span class="type">ConstraintMakerEditable</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> related: <span class="type">ConstraintItem</span></span><br><span class="line">    <span class="keyword">let</span> constant: <span class="type">ConstraintConstantTarget</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> other = other <span class="keyword">as</span>? <span class="type">ConstraintItem</span> &#123;</span><br><span class="line">      <span class="keyword">guard</span> other.attributes == <span class="type">ConstraintAttributes</span>.<span class="keyword">none</span> ||</span><br><span class="line">          other.attributes.layoutAttributes.<span class="built_in">count</span> &lt;= <span class="number">1</span> ||</span><br><span class="line">          other.attributes.layoutAttributes == <span class="keyword">self</span>.description.attributes.layoutAttributes ||</span><br><span class="line">          other.attributes == .edges &amp;&amp; <span class="keyword">self</span>.description.attributes == .margins ||</span><br><span class="line">          other.attributes == .margins &amp;&amp; <span class="keyword">self</span>.description.attributes == .edges ||</span><br><span class="line">          other.attributes == .directionalEdges &amp;&amp; <span class="keyword">self</span>.description.attributes == .directionalMargins ||</span><br><span class="line">          other.attributes == .directionalMargins &amp;&amp; <span class="keyword">self</span>.description.attributes == .directionalEdges <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"Cannot constraint to multiple non identical attributes. (\(file), \(line))"</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      related = other</span><br><span class="line">      constant = <span class="number">0.0</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> other = other <span class="keyword">as</span>? <span class="type">ConstraintView</span> &#123;</span><br><span class="line">      related = <span class="type">ConstraintItem</span>(target: other, attributes: <span class="type">ConstraintAttributes</span>.<span class="keyword">none</span>)</span><br><span class="line">      constant = <span class="number">0.0</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> other = other <span class="keyword">as</span>? <span class="type">ConstraintConstantTarget</span> &#123;</span><br><span class="line">      related = <span class="type">ConstraintItem</span>(target: <span class="literal">nil</span>, attributes: <span class="type">ConstraintAttributes</span>.<span class="keyword">none</span>)</span><br><span class="line">      constant = other</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, <span class="type">OSX</span> <span class="number">10.11</span>, *), <span class="keyword">let</span> other = other <span class="keyword">as</span>? <span class="type">ConstraintLayoutGuide</span> &#123;</span><br><span class="line">      related = <span class="type">ConstraintItem</span>(target: other, attributes: <span class="type">ConstraintAttributes</span>.<span class="keyword">none</span>)</span><br><span class="line">      constant = <span class="number">0.0</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">fatalError</span>(<span class="string">"Invalid constraint. (\(file), \(line))"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> editable = <span class="type">ConstraintMakerEditable</span>(<span class="keyword">self</span>.description)</span><br><span class="line">    editable.description.sourceLocation = (file, line)</span><br><span class="line">    editable.description.relation = relation</span><br><span class="line">    editable.description.related = related</span><br><span class="line">    editable.description.constant = constant</span><br><span class="line">    <span class="keyword">return</span> editable</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@discardableResult</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">equalTo</span><span class="params">(<span class="number">_</span> other: ConstraintRelatableTarget, <span class="number">_</span> file: String = #file, <span class="number">_</span> line: UInt = #line)</span></span> -&gt; <span class="type">ConstraintMakerEditable</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.relatedTo(other, relation: .<span class="built_in">equal</span>, file: file, line: line)</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°äº†</p><ul><li>ConstraintConstantTarget(struct)</li><li>ConstraintRelation(struct)</li><li>ConstraintAttributes(struct)</li><li>ConstraintDescription(class)</li><li>ConstraintItem(class)</li><li>ConstraintMakerEditable(class)</li></ul><h3 id="model-å±‚æ•°æ®åˆ†æ"><a class="markdownIt-Anchor" href="#model-å±‚æ•°æ®åˆ†æ"></a> model å±‚æ•°æ®åˆ†æ</h3><h4 id="constraintconstanttarget"><a class="markdownIt-Anchor" href="#constraintconstanttarget"></a> ConstraintConstantTarget</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">LayoutAttribute</span> = <span class="type">NSLayoutConstraint</span>.<span class="type">Attribute</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">ConstraintConstantTarget</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CGPoint</span>: <span class="title">ConstraintConstantTarget</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CGSize</span>: <span class="title">ConstraintConstantTarget</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ConstraintInsets</span>: <span class="title">ConstraintConstantTarget</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSDirectionalEdgeInsets</span> : <span class="title">ConstraintConstantTarget</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ConstraintConstantTarget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">constraintConstantTargetValueFor</span><span class="params">(layoutAttribute: LayoutAttribute)</span></span> -&gt; <span class="type">CGFloat</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹æºç çŸ¥é“ <code>ConstraintConstantTarget</code> æ˜¯ autolayout æ–¹ç¨‹å¼ä¸­çš„ constantï¼Œä»–æ˜¯è¿™ä¸ª constant æ‰©å±•å°è£…</p><h4 id="constraintrelation"><a class="markdownIt-Anchor" href="#constraintrelation"></a> ConstraintRelation</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">enum</span> <span class="title">ConstraintRelation</span> : <span class="title">Int</span> </span>&#123; </span><br><span class="line">  <span class="keyword">case</span> <span class="built_in">equal</span> </span><br><span class="line">  <span class="keyword">case</span> lessThanOrEqual </span><br><span class="line">  <span class="keyword">case</span> greaterThanOrEqual </span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> layoutRelation: <span class="type">LayoutRelation</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ConstraintRelation</code> æ˜¯ æ–¹ç¨‹å¼ä¸­çš„ å…³ç³»ç¬¦å·</p><h4 id="constraintattributes"><a class="markdownIt-Anchor" href="#constraintattributes"></a> ConstraintAttributes</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">struct</span> <span class="title">ConstraintAttributes</span> : <span class="title">OptionSet</span>, <span class="title">ExpressibleByIntegerLiteral</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> <span class="keyword">none</span>: <span class="type">ConstraintAttributes</span> &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> <span class="keyword">left</span>: <span class="type">ConstraintAttributes</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> top: <span class="type">ConstraintAttributes</span> &#123;  <span class="keyword">return</span> <span class="number">2</span> &#125;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> <span class="keyword">right</span>: <span class="type">ConstraintAttributes</span> &#123; <span class="keyword">return</span> <span class="number">4</span> &#125;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> bottom: <span class="type">ConstraintAttributes</span> &#123; <span class="keyword">return</span> <span class="number">8</span> &#125;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> leading: <span class="type">ConstraintAttributes</span> &#123; <span class="keyword">return</span> <span class="number">16</span> &#125;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> trailing: <span class="type">ConstraintAttributes</span> &#123; <span class="keyword">return</span> <span class="number">32</span> &#125;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> width: <span class="type">ConstraintAttributes</span> &#123; <span class="keyword">return</span> <span class="number">64</span> &#125;</span><br><span class="line">...</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> layoutAttributes:[<span class="type">LayoutAttribute</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> attrs = [<span class="type">LayoutAttribute</span>]()</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.<span class="built_in">contains</span>(<span class="type">ConstraintAttributes</span>.<span class="keyword">left</span>)) &#123;</span><br><span class="line">      attrs.append(.<span class="keyword">left</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.<span class="built_in">contains</span>(<span class="type">ConstraintAttributes</span>.top)) &#123;</span><br><span class="line">      attrs.append(.top)</span><br><span class="line">    &#125;</span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> attrs</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: ConstraintAttributes, <span class="keyword">right</span>: ConstraintAttributes)</span></span> -&gt; <span class="type">ConstraintAttributes</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">left</span>.union(<span class="keyword">right</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> +=<span class="params">(<span class="keyword">left</span>: <span class="keyword">inout</span> ConstraintAttributes, <span class="keyword">right</span>: ConstraintAttributes)</span></span> &#123;</span><br><span class="line">  <span class="keyword">left</span>.formUnion(<span class="keyword">right</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ConstraintAttributes ä½¿ç”¨äº†swift çš„é€‰æ‹©é›†(å¯é€‰æšä¸¾)</li><li>é‡è½½äº†è¿ç®—ç¬¦</li><li>ä¾ç„¶çŒœæµ‹ å®ƒå¯¹åº” <code>NSLayoutConstraint.Attribute</code></li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ConstraintItem.swift</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstraintItem</span> </span>&#123;</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">weak</span> <span class="keyword">var</span> target: <span class="type">AnyObject?</span></span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">let</span> attributes: <span class="type">ConstraintAttributes</span></span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">init</span>(target: <span class="type">AnyObject?</span>, attributes: <span class="type">ConstraintAttributes</span>)</span><br><span class="line">  <span class="keyword">internal</span> <span class="keyword">var</span> layoutConstraintItem: <span class="type">LayoutConstraintItem?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.target <span class="keyword">as</span>? <span class="type">LayoutConstraintItem</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: ConstraintItem, rhs: ConstraintItem)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// LayoutConstraintItem.swift</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">LayoutConstraintItem</span>: <span class="title">class</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">9.0</span>, <span class="type">OSX</span> <span class="number">10.11</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ConstraintLayoutGuide</span> : <span class="title">LayoutConstraintItem</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ConstraintView</span> : <span class="title">LayoutConstraintItem</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">ConstraintLayoutGuide</span> = <span class="type">UILayoutGuide</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">ConstraintView</span> = <span class="type">UIView</span></span><br></pre></td></tr></table></figure><p>nice~<br>ConstraintItem å°±æ˜¯ view å’Œ ä»–å¯¹åº”å¸ƒå±€å±æ€§çš„å…ƒç»„ (view, attr)</p><h4 id="constraintdescription"><a class="markdownIt-Anchor" href="#constraintdescription"></a> ConstraintDescription</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstraintDescription</span> </span>&#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">let</span> item: <span class="type">LayoutConstraintItem</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> attributes: <span class="type">ConstraintAttributes</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> relation: <span class="type">ConstraintRelation?</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> sourceLocation: (<span class="type">String</span>, <span class="type">UInt</span>)?</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> label: <span class="type">String?</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> related: <span class="type">ConstraintItem?</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> multiplier: <span class="type">ConstraintMultiplierTarget</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> constant: <span class="type">ConstraintConstantTarget</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> priority: <span class="type">ConstraintPriorityTarget</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="built_in">lazy</span> <span class="keyword">var</span> constraint: <span class="type">SnapKit</span>.<span class="type">Constraint?</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125; <span class="comment">// main</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">init</span>(item: <span class="type">LayoutConstraintItem</span>, attributes: <span class="type">ConstraintAttributes</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ConstraintDescription</code> åŒ…å«äº† autolayout å¸ƒå±€æ–¹ç¨‹å¼ä¸­æ‰€æœ‰ä¿¡æ¯ï¼Œå¯æ˜¯ä¸çŸ¥é“ä¸ºå•¥ä¸åœ¨è¿™é‡Œè°ƒç”¨ NSLayoutConstraint æ·»åŠ å±æ€§ï¼Œéè¦æä¸€ä¸ª SnapKit.Constraintæ¥åšè¿™äº›äº‹</p><ul><li>ConstraintMakerEditable æ˜¯é“¾å¼ç¼–ç¨‹æŠ€å·§é‡Œé¢çš„å¾€åçœ‹</li></ul><h3 id="åˆ†æ-snapkit-é“¾å¼å°è£…"><a class="markdownIt-Anchor" href="#åˆ†æ-snapkit-é“¾å¼å°è£…"></a> åˆ†æ <code>SnapKit</code> é“¾å¼å°è£…</h3><h4 id="ä¸»è¦ç»„ä»¶ç»“"><a class="markdownIt-Anchor" href="#ä¸»è¦ç»„ä»¶ç»“"></a> ä¸»è¦ç»„ä»¶ç»“</h4><ul><li>æ–‡ä»¶åˆ†ç»„<br><img src="/img/snapkit_files.jpeg" alt="snapkit_files"></li></ul><h4 id="ä½¿ç”¨å‡½æ•°è°ƒç”¨æ ˆåˆ†æ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å‡½æ•°è°ƒç”¨æ ˆåˆ†æ"></a> ä½¿ç”¨å‡½æ•°è°ƒç”¨æ ˆåˆ†æ</h4><details><summary>SnapKit ä¸»æµç¨‹</summary><pres><p><img src="/img/snapKit_main_flow.jpeg" alt="snapKit main flow"><br></p></pres><p></p></details><details><summary>SnapKit é“¾å¼æµç¨‹</summary><pres><p><img src="/img/snapKit_chain.jpeg" alt="snapKit chain"><br></p></pres><p></p></details><p>maker åˆ›å»ºä¸€ä¸ªå…¶å®èŠ‚ç‚¹ ContraintExtentableï¼Œä»–ç»´æŠ¤è‡ªå·±çš„ description<br>maker ä¿å­˜ descriptions[] æ•°ç»„</p><p>ä¼ é€’ description æ¥å»¶ç»­é“¾èŠ‚ç‚¹</p><p>to be continued</p><h3 id="ä»£ç ç»„ä»¶åˆ†æ"><a class="markdownIt-Anchor" href="#ä»£ç ç»„ä»¶åˆ†æ"></a> ä»£ç ç»„ä»¶åˆ†æ</h3><blockquote><p><a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/index.html#//apple_ref/doc/uid/TP40010853-CH7-SW1" target="_blank" rel="noopener">Auto Layout Guide</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:12 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="ç¬¬ä¸‰æ–¹æ¡†æ¶" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
      <category term="UI å¸ƒå±€" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/UI-%E5%B8%83%E5%B1%80/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
      <category term="æºç " scheme="https://changzw.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="swift" scheme="https://changzw.github.io/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ closures ä»£æ›¿ Gesture Recognizers é€‰æ‹©å™¨</title>
    <link href="https://changzw.github.io/2020/03/08/%E4%BD%BF%E7%94%A8-closures-%E6%B7%BB%E5%8A%A0-Gesture-Recognizers/"/>
    <id>https://changzw.github.io/2020/03/08/%E4%BD%BF%E7%94%A8-closures-%E6%B7%BB%E5%8A%A0-Gesture-Recognizers/</id>
    <published>2020-03-08T01:56:45.000Z</published>
    <updated>2020-04-25T02:56:00.597Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><p><a href="https://medium.com/@sdrzn/adding-gesture-recognizers-with-closures-instead-of-selectors-9fb3e09a8f0b" target="_blank" rel="noopener">åŸæ–‡ Adding Gesture Recognizers with Closures Instead of Selectors<br></a></p><p>æ·»åŠ UITapGestureRecognizeræˆ–ä»»ä½• recognizer/target action çš„æœ€ç³Ÿç³•çš„éƒ¨åˆ†æ˜¯ä»…é’ˆå¯¹é€‰æ‹©å™¨å‚æ•°å®ç°æ–°åŠŸèƒ½ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸ªå·§å¦™çš„æŠ€å·§ï¼Œè®©ä½ æ·»åŠ ä¸å¸¦é€‰æ‹©å™¨çš„æ‰‹åŠ¿è¯†åˆ«å™¨ã€‚</p><p>å‡è®¾æˆ‘ä»¬åœ¨View Controllerä¸­æœ‰ä¸€ä¸ªUIImageViewï¼Œæˆ‘ä»¬æƒ³å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªUITapGestureRecognizerï¼Œä»¥ä¾¿åœ¨ç‚¹å‡»å®ƒæ—¶æ‰“å°å‡ºä¸€æ¡è¯­å¥.</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ª UITapGestureRecognizer çš„å®ä¾‹ï¼Œå¹¶å°†å…¶ç›®æ ‡è®¾ç½®ä¸ºè§†å›¾æ§åˆ¶å™¨åŠå…¶é€‰æ‹©å™¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šå¿«é€Ÿå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·(myImageViewTapped(senderï¼šUITapGestureRecognizer))ã€‚</p><p>è¿™å¯èƒ½ä¼šæœ‰ç‚¹å¤šä½™ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´è¦æ·»åŠ äº¤äº’æ€§çš„æ¯ä¸ªå­è§†å›¾çš„å‡½æ•°çš„ä»£ç æ··ä¹±ã€‚</p><p>æˆ‘ä»¥ä¸ºæˆ‘å¯ä»¥å¿«é€Ÿæ‰©å±•ä¸€ä¸‹ï¼Œä»¥ä¾¿ä¸ºæˆ‘çš„å›¾åƒè§†å›¾æ·»åŠ æ•²å‡»æ‰‹åŠ¿è¯†åˆ«å™¨ï¼Œä½†æ˜¯ç„¶åæˆ‘å¿…é¡»ä¸ºæ¯ä¸ªè¯†åˆ«å™¨åˆ›å»ºä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¯¹å—ï¼Ÿé”™è¯¯ï¼åˆ©ç”¨å…³è”å¯¹è±¡çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥å°†é—­åŒ…å­˜å‚¨ä¸ºæ‰©å±•ä¸­çš„è®¡ç®—å±æ€§ï¼</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="comment">// In order to create computed properties for extensions, we need a key to </span></span><br><span class="line">  <span class="comment">// store and access the stored property</span></span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedObjectKeys</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> tapGestureRecognizer = <span class="string">"MediaViewerAssociatedObjectKey_mediaViewer"</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">typealias</span> <span class="type">Action</span> = (() -&gt; <span class="type">Void</span>)?</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Set our computed property type to a closure</span></span><br><span class="line">  <span class="keyword">fileprivate</span> <span class="keyword">var</span> tapGestureRecognizerAction: <span class="type">Action?</span> &#123;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> newValue = newValue &#123;</span><br><span class="line">        <span class="comment">// Computed properties get stored as associated objects</span></span><br><span class="line">        objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedObjectKeys</span>.tapGestureRecognizer, newValue, objc_AssociationPolicy.<span class="type">OBJC_ASSOCIATION_RETAIN</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> tapGestureRecognizerActionInstance = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedObjectKeys</span>.tapGestureRecognizer) <span class="keyword">as</span>? <span class="type">Action</span></span><br><span class="line">      <span class="keyword">return</span> tapGestureRecognizerActionInstance</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// This is the meat of the sauce, here we create the tap gesture recognizer and</span></span><br><span class="line">  <span class="comment">// store the closure the user passed to us in the associated object we declared above</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">addTapGestureRecognizer</span><span class="params">(action: <span class="params">(<span class="params">()</span></span></span></span> -&gt; <span class="type">Void</span>)?) &#123;</span><br><span class="line">    <span class="keyword">self</span>.isUserInteractionEnabled = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">self</span>.tapGestureRecognizerAction = action</span><br><span class="line">    <span class="keyword">let</span> tapGestureRecognizer = <span class="type">UITapGestureRecognizer</span>(target: <span class="keyword">self</span>, action: #selector(handleTapGesture))</span><br><span class="line">    <span class="keyword">self</span>.addGestureRecognizer(tapGestureRecognizer)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Every time the user taps on the UIImageView, this function gets called,</span></span><br><span class="line">  <span class="comment">// which triggers the closure we stored</span></span><br><span class="line">  <span class="meta">@objc</span> <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">handleTapGesture</span><span class="params">(sender: UITapGestureRecognizer)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> action = <span class="keyword">self</span>.tapGestureRecognizerAction &#123;</span><br><span class="line">      action?()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"no action"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬è¦å°†UITapGestureRecognizeræ·»åŠ åˆ°UIViewæˆ–UIViewå­ç±»ï¼ˆå¦‚UIImageViewï¼‰æ—¶ï¼Œéƒ½å¯ä»¥è¿™æ ·åšï¼Œè€Œæ— éœ€ä¸ºé€‰æ‹©å™¨åˆ›å»ºå…³è”çš„åŠŸèƒ½ï¼è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sampleImageView.addTapGestureRecognizer &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"image tapped"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰UITapGestureRecognizerså®ä¾‹ï¼Œæ²¡æœ‰targetsï¼Œæ²¡æœ‰selectorsï¼Œæ²¡æœ‰ä¸å¿…è¦çš„functionsï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="iOS Programming" scheme="https://changzw.github.io/categories/iOS-Programming/"/>
    
      <category term="objc" scheme="https://changzw.github.io/categories/iOS-Programming/objc/"/>
    
      <category term="runtime" scheme="https://changzw.github.io/categories/iOS-Programming/objc/runtime/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
      <category term="swift" scheme="https://changzw.github.io/tags/swift/"/>
    
      <category term="ç¿»è¯‘" scheme="https://changzw.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªå®šä¹‰ keyboard</title>
    <link href="https://changzw.github.io/2020/02/17/%E8%87%AA%E5%AE%9A%E4%B9%89-keyboard/"/>
    <id>https://changzw.github.io/2020/02/17/%E8%87%AA%E5%AE%9A%E4%B9%89-keyboard/</id>
    <published>2020-02-17T09:18:39.000Z</published>
    <updated>2020-04-25T02:44:20.510Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><p>åŸæ–‡ï¼š<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/ExtensibilityPG/CustomKeyboard.html" target="_blank" rel="noopener">CustomKeyboard</a></p><h3 id="è‡ªå®šä¹‰é”®ç›˜api"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰é”®ç›˜api"></a> è‡ªå®šä¹‰é”®ç›˜API</h3><p>å¼€å‘è‡ªå®šä¹‰é”®ç›˜çš„å¿«é€Ÿå…¥é—¨,å¦‚ä¸‹å›¾ï¼Œå®ƒå±•ç¤ºäº†é”®ç›˜è¿è¡Œè¿‡ç¨‹ä¸­ä¸€äº›é‡è¦çš„å¯¹è±¡ï¼Œä»¥åŠå®ƒä»¬åœ¨å¼€å‘æµç¨‹ä¸­çš„çš„ä½ç½®ï¼š</p><p><img src="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/Art/keyboard_architecture_2x.png" alt="keyboard"></p><p>è‡ªå®šä¹‰é”®ç›˜æ¨¡æ¿ï¼ˆåœ¨iOSâ€œApplication Extensionâ€ç›®æ ‡æ¨¡æ¿ç»„ï¼‰åŒ…å«ä¸€ä¸ªUIInputViewControllerçš„å­ç±»ï¼Œå®ƒæ˜¯ä½ å¼€å‘çš„é”®ç›˜çš„ä¸»è§†å›¾æ§åˆ¶å™¨ã€‚è¯¥æ¨¡æ¿åŒ…å«</p><p>é”®ç›˜æ‰€å¿…éœ€çš„â€œä¸‹ä¸€ä¸ªé”®ç›˜â€æŒ‰é’®çš„å®ç°ï¼Œå®ƒè°ƒç”¨äº†UIInputViewControllerç±»çš„advanceToNextInputModeæ–¹æ³•ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥åœ¨è¾“å…¥è§†å›¾æ§åˆ¶å™¨çš„ä¸»è§†å›¾ï¼ˆåœ¨å…¶inputViewå±æ€§ï¼‰ä¸­æ·»åŠ å­è§†å›¾ã€æ§åˆ¶å™¨ä»¥åŠæ‰‹åŠ¿è¯†åˆ«å™¨ç­‰ã€‚å¯¹äºå…¶å®ƒç±»å‹çš„æ‰©å±•åº”ç”¨ï¼Œåœ¨ç›®æ ‡ä¸Šå¹¶ä¸å­˜åœ¨çª—ä½“ï¼Œå› æ­¤ä¹Ÿå°±æ²¡æœ‰æ ¹è§†å›¾æ§åˆ¶å™¨äº†ã€‚</p><p>åœ¨æ¨¡æ¿çš„Info.plistæ–‡ä»¶ä¸­æœ‰é¢„å…ˆé…ç½®å¥½çš„é”®ç›˜æ‰€éœ€è¦çš„æœ€åŸºæœ¬çš„å€¼ã€‚å‚è§å…¶ä¸­çš„NSExtensionAttributeså­—å…¸å…³é”®å­—ï¼Œé…ç½®ä¸€ä¸ªé”®ç›˜çš„å…³é”®å­—åœ¨<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/ExtensibilityPG/CustomKeyboard.html#//apple_ref/doc/uid/TP40014214-CH16-SW18" target="_blank" rel="noopener">ã€Šé…ç½®è‡ªå®šä¹‰é”®ç›˜çš„Info.plistæ–‡ä»¶ã€‹</a>ä¸­æœ‰ä»‹ç»ã€‚</p><p>é»˜è®¤ï¼Œé”®ç›˜ä¸èƒ½è®¿é—®ç½‘ç»œï¼Œä¸èƒ½å’Œå®ƒçš„appå…±äº«å®¹å™¨ã€‚å¦‚æœè¦å…·å¤‡è¿™ç§èƒ½åŠ›ï¼Œå¿…é¡»è¦å°†Info.plistæ–‡ä»¶ä¸­RequestsOpenAccessçš„å€¼ç½®ä¸ºYESã€‚è¿™éœ€è¦æ‰©å±•é”®ç›˜çš„æ²™ç›’ï¼Œåœ¨<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/ExtensibilityPG/CustomKeyboard.html#//apple_ref/doc/uid/TP40014214-CH16-SW3" target="_blank" rel="noopener">ã€Šè®¾è®¡ç”¨æˆ·ä¿¡ä»»ã€‹</a>ä¸­æœ‰ä»‹ç»ç›¸å…³å†…å®¹ã€‚</p><p>ä¸€ä¸ªè¾“å…¥è§†å›¾æ§åˆ¶å™¨éµä»å„ç§ä¸æ–‡æœ¬è¾“å…¥å¯¹è±¡å†…å®¹äº¤äº’çš„åè®®ï¼š</p><ul><li>å“åº”è§¦æ‘¸æ¶ˆæ¯æ—¶å¦‚æœè¦æ’å…¥æˆ–åˆ é™¤æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://developer.apple.com/reference/uikit/uikeyinput" target="_blank" rel="noopener">UIKeyInput</a>åè®®çš„insertText:å’ŒdeleteBackwardæ–¹æ³•ã€‚å¯ä»¥åœ¨è§†å›¾æ§åˆ¶å™¨çš„<a href="https://developer.apple.com/reference/uikit/uiinputviewcontroller/1618193-textdocumentproxy" target="_blank" rel="noopener">textDocumentProxy</a>å±æ€§ä¸­è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œè¯¥å±æ€§ä»£è¡¨å½“å‰æ–‡æœ¬è¾“å…¥å¯¹è±¡ï¼Œå®ƒéµä»<a href="https://developer.apple.com/reference/uikit/uitextdocumentproxy" target="_blank" rel="noopener">UITextDocumentProxy</a>åè®®ã€‚å¦‚ä¸‹ï¼š</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.textDocumentProxy insertText:<span class="string">@"hello "</span>]; <span class="comment">// Inserts the string "hello " at the insertion point</span></span><br><span class="line">[<span class="keyword">self</span>.textDocumentProxy deleteBackward];       <span class="comment">// Deletes the character to the left of the insertion point</span></span><br><span class="line">[<span class="keyword">self</span>.textDocumentProxy insertText:<span class="string">@"\n"</span>];     <span class="comment">// In a text view, inserts a newline character at the insertion point</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨è°ƒç”¨deleteBackwardä¹‹å‰è¦å…ˆå†³å®šåˆ é™¤çš„å­—ç¬¦æ•°ã€‚å¯ä»¥é€šè¿‡textDocumentProxyçš„<a href="https://developer.apple.com/reference/uikit/uitextdocumentproxy/1618190-documentcontextbeforeinput" target="_blank" rel="noopener">documentContextBeforeInput</a>å±æ€§ï¼Œæ¥è·å¾—å…‰æ ‡é™„è¿‘çš„æ–‡æœ¬ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å¦‚ä¸‹ï¼š</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *precedingContext = <span class="keyword">self</span>.textDocumentProxy.documentContextBeforeInput;</span><br></pre></td></tr></table></figure><ul><li>ä¸ºäº†æ§åˆ¶å…‰æ ‡æ‰€åœ¨ä½ç½®çš„æ“ä½œï¼Œæ¯”å¦‚æ”¯æŒå‘å‰åˆ é™¤æ–‡å­—ï¼Œéœ€è¦è°ƒç”¨UITextDocumentProxyåè®®ä¸­çš„<a href="https://developer.apple.com/reference/uikit/uitextdocumentproxy/1618194-adjusttextposition" target="_blank" rel="noopener">adjustTextPositionByCharacterOffset:</a>æ–¹æ³•ã€‚æ¯”å¦‚å‘å‰åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) deleteForward &#123;</span><br><span class="line">    [<span class="keyword">self</span>.textDocumentProxy adjustTextPositionByCharacterOffset: <span class="number">1</span>];</span><br><span class="line">    [<span class="keyword">self</span>.textDocumentProxy deleteBackward];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡å®ç°<a href="https://developer.apple.com/reference/uikit/uitextinputdelegate" target="_blank" rel="noopener">UITextInputDelegate</a>åè®®ä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥å“åº”å½“å‰è¾“å…¥æ–‡æœ¬å¯¹è±¡çš„ä¸€äº›å˜åŒ–ï¼Œæ¯”å¦‚å†…å®¹å˜åŒ–ä»¥åŠç”¨æˆ·è§¦å‘çš„å…‰æ ‡ä½ç½®çš„å˜åŒ–ã€‚</li></ul><p>ä¸ºäº†å±•ç°ä¸å½“å‰æ–‡æœ¬è¾“å…¥å¯¹è±¡é€‚é…çš„é”®ç›˜å¸ƒå±€ï¼Œéœ€è¦å‚ç…§è¯¥å¯¹è±¡çš„<a href="https://developer.apple.com/reference/uikit/uikeyboardtype" target="_blank" rel="noopener">UIKeyboardType</a>å±æ€§ï¼Œæ ¹æ®æ¯ç§ä½ çš„é”®ç›˜æ‰€èƒ½æ”¯æŒçš„å±æ€§ï¼Œå˜åŒ–å¸ƒå±€å†…å®¹ã€‚</p><p><strong>åœ¨è‡ªå®šä¹‰é”®ç›˜ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥æ”¯æŒå¤šè¯­è¨€ï¼š</strong></p><ul><li>ä¸ºæ¯ä¸ªè¯­è¨€åˆ›å»ºä¸€ä¸ªé”®ç›˜ï¼Œæ¯ä¸ªé”®ç›˜éƒ½ä½œä¸ºå‘å®¹å™¨appæ·»åŠ çš„ç‹¬ç«‹çš„Target</li><li>åˆ›å»ºä¸€ä¸ªå¤šè¯­è¨€é”®ç›˜ï¼ŒåŠ¨æ€åˆ‡æ¢å½“å‰è¯­è¨€ã€‚å¯ä»¥ä½¿ç”¨UIInputViewControllerç±»çš„primaryLanguageå±æ€§æ¥åŠ¨æ€åˆ‡æ¢è¯­è¨€ã€‚</li></ul><p>æ ¹æ®ä½ è¦æ”¯æŒçš„è¯­è¨€æ•°é‡ä»¥åŠä½ æƒ³æä¾›çš„ç”¨æˆ·ä½“éªŒï¼Œä½ å¯ä»¥ä»ä¸Šé¢é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ¡ˆã€‚</p><p>æ¯ç§è‡ªå®šä¹‰é”®ç›˜ï¼ˆéœ€è¦RequestsOpenAccessï¼‰éƒ½å¯ä»¥é€šè¿‡UILexiconç±»è®¿é—®è‡ªåŠ¨çº é”™çš„è¯å…¸ã€‚é€šè¿‡ä½¿ç”¨è¯¥ç±»ï¼Œå¹¶ç»“åˆä½ è‡ªå·±çš„è¯å…¸è®¾è®¡ï¼Œå¯ä»¥åœ¨ç”¨æˆ·è¾“å…¥è¿‡ç¨‹ä¸­ä¸ºä»–æä¾›è¾“å…¥å»ºè®®å’Œè‡ªåŠ¨çº é”™ã€‚UILexiconå¯¹è±¡åŒ…å«æ¥è‡ªå¦‚ä¸‹æºçš„å•è¯ï¼š</p><ul><li>æ¥è‡ªç”¨æˆ·é€šè®¯å½•çš„äººåå’Œå§“</li><li>åœ¨ è®¾ç½® &gt; é€šç”¨ &gt; é”®ç›˜ &gt; å¿«æ·æ–¹å¼ï¼ˆæ–‡æœ¬æ›¿æ¢ï¼‰ åˆ—è¡¨</li><li>é€šç”¨è¯å…¸</li></ul><p>ä½ å¯ä»¥ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€æ¥è°ƒæ•´ä½ çš„è‡ªå®šä¹‰é”®ç›˜ä¸»è§†å›¾çš„é«˜åº¦ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰é”®ç›˜ä¼šæ ¹æ®å±å¹•å°ºå¯¸ä»¥åŠè®¾å¤‡æ–¹å‘ï¼Œå’Œç³»ç»Ÿé”®ç›˜çš„å°ºå¯¸ä¿æŒä¸€è‡´ã€‚è‡ªå®šä¹‰é”®ç›˜çš„å®½åº¦é€šå¸¸ä¸å±å¹•å½“å‰å®½åº¦ä¸€è‡´ã€‚ä¿®æ”¹è‡ªå®šä¹‰é”®ç›˜ä¸»è§†å›¾çš„é«˜åº¦çº¦æŸå³å¯ä¿®æ”¹å…¶é«˜åº¦ã€‚</p><p>ä¸‹é¢çš„ä»£ç å±•ç¤ºå¦‚ä½•å®šä¹‰å’Œæ·»åŠ çº¦æŸï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> _expandedHeight = <span class="number">500</span>;</span><br><span class="line"><span class="built_in">NSLayoutConstraint</span> *_heightConstraint = </span><br><span class="line">    [<span class="built_in">NSLayoutConstraint</span> constraintWithItem: <span class="keyword">self</span>.view </span><br><span class="line">                                 attribute: <span class="built_in">NSLayoutAttributeHeight</span> </span><br><span class="line">                                 relatedBy: <span class="built_in">NSLayoutRelationEqual</span> </span><br><span class="line">                                    toItem: <span class="literal">nil</span> </span><br><span class="line">                                 attribute: <span class="built_in">NSLayoutAttributeNotAnAttribute</span></span><br><span class="line">                                multiplier: <span class="number">0.0</span> </span><br><span class="line">                                  constant: _expandedHeight];</span><br><span class="line">[<span class="keyword">self</span>.view addConstraint: _heightConstraint];</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰é”®ç›˜çš„å¼€å‘å…³é”®"><a class="markdownIt-Anchor" href="#è‡ªå®šä¹‰é”®ç›˜çš„å¼€å‘å…³é”®"></a> è‡ªå®šä¹‰é”®ç›˜çš„å¼€å‘å…³é”®</h2><p>è‡ªå®šä¹‰é”®ç›˜å¼€å‘æœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p><ul><li>ä¿¡ä»»ã€‚ è‡ªå®šä¹‰é”®ç›˜èƒ½è®¿é—®ç”¨æˆ·è¾“å…¥çš„å†…å®¹ ï¼Œå› æ­¤åœ¨é”®ç›˜å’Œç”¨æˆ·é—´å»ºç«‹ä¿¡ä»»éå¸¸å…³é”®ã€‚</li><li>â€œä¸‹ä¸€ä¸ªé”®ç›˜â€é”®ã€‚ é€šè¿‡é”®ç›˜ç•Œé¢å¿…é¡»èƒ½è®©ç”¨æˆ·èƒ½åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªé”®ç›˜ã€‚</li></ul><h3 id="ä¸ºç”¨æˆ·ä¿¡ä»»æ‰€åšçš„è®¾è®¡"><a class="markdownIt-Anchor" href="#ä¸ºç”¨æˆ·ä¿¡ä»»æ‰€åšçš„è®¾è®¡"></a> ä¸ºç”¨æˆ·ä¿¡ä»»æ‰€åšçš„è®¾è®¡</h3><p>ä½œä¸ºè‡ªå®šä¹‰é”®ç›˜çš„å¼€å‘è€…ï¼Œä½ é¦–å…ˆåº”å½“è€ƒè™‘çš„æ˜¯å¦‚ä½•å»ºç«‹å’Œç»´æŠ¤ç”¨æˆ·ä¿¡ä»»ã€‚ä½ è¦ç†è§£éšç§ç­–ç•¥çš„æœ€ä½³å®è·µå¹¶çŸ¥é“å¦‚ä½•å®ç°å®ƒæ‰èƒ½å¾ˆå¥½åœ°è·µè¡Œã€‚</p><blockquote><p>æ³¨æ„<br>æœ¬èŠ‚ä¸ºä½ åˆ›å»ºè‡ªå®šä¹‰é”®ç›˜æä¾›ç›¸å…³çš„å¼€å‘æ‰‹å†Œï¼Œè¯¥æ‰‹å†Œè¦æ±‚å°Šé‡ç”¨æˆ·éšç§ã€‚äº†è§£iOSç¼–ç¨‹è¦æ±‚ï¼Œè¯·é˜…è¯»åº”ç”¨å•†åº—å®¡æ ¸æ‰‹å†Œï¼ŒiOSäººæœºäº¤äº’æ‰‹å†Œï¼ŒiOSå¼€å‘è®¸å¯åè®®ï¼Œè¯·å‚è§è‹¹æœçš„<a href="https://developer.apple.com/support/appstore/app-review/" target="_blank" rel="noopener">ã€Šåº”ç”¨å®¡æ ¸æ”¯æŒã€‹</a>ï¼Œ<a href="https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/ExpectedAppBehaviors/ExpectedAppBehaviors.html#//apple_ref/doc/uid/TP40007072-CH3-SW6" target="_blank" rel="noopener">ã€Šæ”¯æŒç”¨æˆ·éšç§ã€‹</a>ï¼Œ<a href="https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40007072" target="_blank" rel="noopener">ã€ŠiOSåº”ç”¨ç¼–ç¨‹æŒ‡å—ã€‹</a>ã€‚</p></blockquote><p>å¯¹äºé”®ç›˜ï¼Œå¦‚ä¸‹ä¸‰ä¸ªæ–¹é¢å¯¹äºå»ºç«‹å’Œç»´æŠ¤ç”¨æˆ·ä¿¡ä»»è‡³å…³é‡è¦ï¼š</p><ul><li>æŒ‰é”®æ•°æ®çš„å®‰å…¨ã€‚ ç”¨æˆ·å¸Œæœ›ä»–ä»¬çš„æ•²é”®ä¼šè½åœ¨æ–‡æ¡£ä»¥åŠè¾“å…¥åŒºåŸŸå†…ï¼Œè€Œä¸æ˜¯ä¸Šä¼ åˆ°æœåŠ¡å™¨æˆ–è€…ç”¨äºå…¶ä»–ä¸æ˜ç›®çš„ã€‚</li><li>æœ€å°åŒ–åˆç†åˆ©ç”¨å…¶å®ƒç”¨æˆ·æ•°æ®ã€‚ å¦‚æœä½ çš„é”®ç›˜è¿˜éœ€è¦ä½¿ç”¨å…¶ä»–ç”¨æˆ·æ•°æ®ï¼Œä¾‹å¦‚å®šä½æœåŠ¡æˆ–è€…é€šè®¯å½•ï¼Œä½ æœ‰ä¹‰åŠ¡è§£é‡Šè¿™ç»™ç”¨æˆ·å¸¦æ¥çš„å¥½å¤„æ˜¯ä»€ä¹ˆã€‚</li><li>å‡†ç¡®ã€‚ æŠŠè¾“å…¥äº‹ä»¶è½¬æ¢æˆæ–‡æœ¬è¦æ±‚ç²¾å‡†ï¼Œè¿™æœ¬èº«è™½ç„¶ä¸æ˜¯ä¸€ä¸ªéšç§è¯é¢˜ï¼Œä½†ä»–ä¼šå½±å“åˆ°ä¿¡ä»»ï¼šæ¯æ¬¡æ–‡å­—è½¬æ¢éœ€è¦ä½“ç°å‡ºä½ çš„ä»£ç çš„ç²¾å‡†ã€‚</li></ul><p>åœ¨ä¿¡ä»»çš„å¼€å‘è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆè€ƒè™‘çš„æ˜¯æ˜¯å¦è¦è·å–open accessæƒé™ã€‚å°½ç®¡å¼€å¯äº†open accessæƒé™èƒ½ç»™è‡ªå®šä¹‰é”®ç›˜å¼€å‘å¸¦æ¥æå¤§ä¾¿åˆ©ï¼Œä½†è¿™ä¹Ÿå¢åŠ äº†ä½ ä½œä¸ºå¼€å‘è€…çš„è´£ä»»ã€‚ä¸‹é¢æ˜¯æ ‡å‡†çš„open accessçš„èƒ½åŠ›å’Œéšç§è€ƒè™‘ï¼š</p><table><thead><tr><th>Open Access</th><th>èƒ½åŠ›å’Œé™åˆ¶</th><th>éšç§è€ƒè™‘</th></tr></thead><tbody><tr><td>Off(default)</td><td>Â·é”®ç›˜å¯ä»¥æ‰§è¡Œæ‰€æœ‰åŸºæœ¬é”®ç›˜çš„èŒè´£<br>Â·å¯ä»¥è®¿é—®é€šç”¨è¯å…¸ä»¥æ”¯æŒè‡ªåŠ¨çº é”™å’Œè¾“å…¥å»ºè®®<br>Â·è®¿é—®è®¾ç½®é‡Œçš„å¿«æ·çŸ­è¯­<br>Â·ä¸ä¸containingåº”ç”¨å…±äº«å®¹å™¨<br>Â·ä¸è®¿é—®é”®ç›˜å®¹å™¨ä»¥å¤–çš„æ–‡ä»¶ç³»ç»Ÿ<br>Â·ä¸è®¿é—®é”®ç›˜å®¹å™¨ä»¥å¤–çš„æ–‡ä»¶ç³»ç»Ÿ<br>Â·ä¸èƒ½ç›´æ¥æˆ–é—´æ¥è®¿é—®iCloudæˆ–æ¸¸æˆä¸­å¿ƒæˆ–åº”ç”¨å†…è´­ä¹°</td><td>ç”¨æˆ·äº†è§£æŒ‰é”®ä»…ä»…è¢«å‘é€åˆ°å½“å‰ä½¿ç”¨é”®ç›˜çš„åº”ç”¨é‡Œ</td></tr><tr><td>On</td><td>Â·å…·å¤‡éè”ç½‘è‡ªå®šä¹‰é”®ç›˜çš„æ‰€æœ‰èƒ½åŠ›<br>Â·åœ¨ç”¨æˆ·è®¸å¯æƒ…å†µä¸‹å¯ä»¥è®¿é—®ä½ç½®æœåŠ¡å’Œé€šè®¯å½•<br>Â·é”®ç›˜å’Œcontaining appå¯ä»¥è®¿é—®å…±äº«å®¹å™¨<br>Â·é”®ç›˜å¯ä»¥ä¸ºæœåŠ¡å™¨ä¾§å¤„ç†è¿‡ç¨‹å‘é€æŒ‰é”®æˆ–å…¶ä»–è¾“å…¥äº‹ä»¶<br>Â·containing appè‡ªåŠ¨çº é”™å­—å…¸æä¾›ç¼–è¾‘ç•Œé¢<br>Â·é€šè¿‡containing appé”®ç›˜å¯ä»¥ä½¿ç”¨iCloudæ¥ä¿è¯è‡ªåŠ¨çº é”™è¯å…¸å’Œè®¾ç½®çš„æ›´æ–°<br>Â·é€šè¿‡containing appï¼Œé”®ç›˜å¯ä»¥å‚ä¸åˆ°æ¸¸æˆä¸­å¿ƒå’Œåº”ç”¨å†…è´­ä¹°<br>Â·å¦‚æœé”®ç›˜æ”¯æŒç§»åŠ¨è®¾å¤‡ç®¡ç†(MDM)ï¼Œå®ƒå¯ä¸è¢«ç®¡ç†çš„åº”ç”¨å…±åŒå·¥ä½œ</td><td>Â·ç”¨æˆ·äº†è§£é”®ç›˜å¼€å‘è€…ä¼šåˆ©ç”¨æŒ‰é”®æ•°æ®<br>Â·ä½ å¿…é¡»éµå®ˆæœ‰è”ç½‘èƒ½åŠ›çš„é”®ç›˜å¼€å‘æ‰‹å†Œå’ŒiOSå¼€å‘è®¸å¯åè®®ï¼Œå¯å‚è§ã€Šåº”ç”¨å®¡æ ¸æ”¯æŒã€‹</td></tr></tbody></table><p>å¦‚æœä½ çš„è‡ªå®šä¹‰é”®ç›˜ä¸éœ€è¦open accessæƒé™ï¼Œç³»ç»Ÿç¡®ä¿æ•²é”®ä¿¡æ¯ä¸ä¼šè¢«å‘é€ç»™ä½ çš„é”®ç›˜ä»¥åŠåˆ«çš„åœ°æ–¹ã€‚å¦‚æœåªæƒ³æä¾›ä¸€èˆ¬çš„é”®ç›˜åŠŸèƒ½ï¼Œè¯·ä¸è¦ç»™é”®ç›˜é…å¤‡è”ç½‘èƒ½åŠ›ã€‚ç”±äºæœ‰æ²™ç›’é™åˆ¶ï¼Œä¸è”ç½‘çš„é”®ç›˜ä¸€å®šæ˜¯æ»¡è¶³è‹¹æœçš„æ•°æ®éšç§æ‰‹å†Œå¹¶èƒ½è·å¾—ç”¨æˆ·ä¿¡ä»»çš„ã€‚</p><p>å¼€å¯open accessæƒé™ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œå¯ä»¥åœ¨Info.plistæ–‡ä»¶ä¸­é…ç½®ï¼‰ï¼Œèƒ½ç»™ä½ çš„å¼€å‘å¸¦æ¥æ›´å¤šå¯èƒ½æ€§ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥æ›´å¤šçš„è´£ä»»ã€‚</p><blockquote><p>æ³¨æ„<br>å‘åº”ç”¨å•†åº—æäº¤ä¸€ä¸ªopen-accessçš„é”®ç›˜å¿…é¡»éµå®ˆè‹¹æœã€Šåº”ç”¨å®¡æ ¸æ”¯æŒã€‹ä¸­çš„ç›¸å…³æ¡æ¬¾ã€‚</p></blockquote><p>æ¯ä¸€ä¸ªä¸open accessç›¸å…³çš„åŠŸèƒ½éƒ½éœ€è¦ä½ å±¥è¡Œç›¸åº”çš„è´£ä»»ï¼Œåº”å½“æœ€å¤§é™åº¦åœ°å°Šé‡ç”¨æˆ·æ•°æ®ï¼Œä¸å¾—ç”¨äºä¸ç”¨æˆ·è¾“å…¥æ— å…³çš„å…¶ä»–ä»»ä½•ç›®çš„ã€‚ä¸‹è¡¨åˆ—å‡ºäº†open accesså¸¦æ¥çš„å¥½å¤„ä»¥åŠå¼€å‘è€…éœ€æ‰¿æ‹…çš„è´£ä»»ï¼š</p><table><thead><tr><th>èƒ½åŠ›</th><th>ç”¨æˆ·åˆ©ç›Šç¤ºä¾‹</th><th>å¼€å‘è€…è´£ä»»</th></tr></thead><tbody><tr><td>ä¸containing appå…±äº«å®¹å™¨</td><td>ä¸ºé”®ç›˜çš„è‡ªåŠ¨çº é”™è¯å…¸ç®¡ç†UIç•Œé¢</td><td>è¦è€ƒè™‘åˆ°è‡ªåŠ¨çº é”™æ•°æ®å±äºç”¨æˆ·éšç§ã€‚ä¸è¦æŠŠä»–å‘åˆ°ä½ çš„æœåŠ¡å™¨ï¼Œç”¨ä½œä¸è¾“å…¥æ— å…³çš„ç”¨é€”ã€‚</td></tr><tr><td>æŠŠæŒ‰é”®æ•°æ®å‘åˆ°ä½ çš„æœåŠ¡å™¨</td><td>é€šè¿‡å¼€å‘è€…çš„è®¡ç®—èµ„æºå¯ä»¥æä¾›æ›´å¥½çš„æŒ‰é”®å¤„ç†ç»“æœå’Œè¾“å…¥é¢„æµ‹</td><td>åªæœ‰ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„è¾“å…¥ä½“éªŒä¹‹ç”¨æ—¶ï¼Œæ‰èƒ½ä¿å­˜æŒ‰é”®å’Œè¯­éŸ³æ•°æ®</td></tr><tr><td>åŸºäºäº‘çš„è‡ªåŠ¨çº é”™è¯å…¸</td><td>æŠŠäººåã€åœ°åã€çƒ­ç‚¹æ–°é—»åŠ å…¥åˆ°è‡ªåŠ¨çº é”™è¯å…¸ä¸­</td><td>ä¸è¦æŠŠç”¨æˆ·èº«ä»½ä¸è¾“å…¥æ•°æ®å…³è”èµ·æ¥ï¼Œä¸å¾—å°†ç”¨æˆ·ä¿¡æ¯ç”¨ä½œä¸è¾“å…¥ä½“éªŒæ— å…³çš„å…¶ä»–ç›®çš„</td></tr><tr><td>é€šè®¯å½•</td><td>æŠŠäººåã€åœ°åã€ç”µè¯å·ç æ·»åŠ åˆ°è‡ªåŠ¨çº é”™è¯å…¸ä¸­</td><td>ä¸å¾—è®²é€šè®¯å½•ç”¨ä½œä¸è¾“å…¥ä½“éªŒæ— å…³çš„å…¶ä»–ç›®çš„</td></tr><tr><td>ä½ç½®æœåŠ¡</td><td>å°†é™„è¿‘çš„åœ°åæ·»åŠ åˆ°è‡ªåŠ¨çº é”™è¯å…¸ä¸­</td><td>ä¸è¦åœ¨åå°ä½¿ç”¨ä½ç½®æœåŠ¡ï¼Œä¸å¾—å°†ä½ç½®ä¿¡æ¯å‘é€åˆ°ä½ çš„æœåŠ¡å™¨å¹¶ç”¨äºä¸è¾“å…¥ä½“éªŒæ— å…³çš„å…¶ä»–ç›®çš„</td></tr></tbody></table><p>ä¸€ä¸ªå…·æœ‰open-accessæƒé™çš„é”®ç›˜å’Œå…¶containing appèƒ½å°†æŒ‰é”®æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼Œé€šè¿‡è¿™äº›æ•°æ®å¯ä»¥ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„è¾“å…¥ä½“éªŒã€‚å¦‚æœä½ ä½¿ç”¨äº†è¿™äº›èƒ½åŠ›ï¼Œå½“ä¸éœ€è¦è¿™äº›æ•°æ®çš„æ—¶å€™ï¼Œè¯·åŠæ—¶åœ¨æœåŠ¡å™¨ç«¯åˆ é™¤ã€‚å‚è§ä¸Šé¢çš„è¡¨æ ¼æ¥å±¥è¡Œä½ ä½¿ç”¨open-accessæƒé™ä¸­çš„ä¹‰åŠ¡ã€‚</p><h3 id="æä¾›åˆ‡æ¢åˆ°å…¶ä»–é”®ç›˜çš„æ–¹æ³•"><a class="markdownIt-Anchor" href="#æä¾›åˆ‡æ¢åˆ°å…¶ä»–é”®ç›˜çš„æ–¹æ³•"></a> æä¾›åˆ‡æ¢åˆ°å…¶ä»–é”®ç›˜çš„æ–¹æ³•</h3><p>ç³»ç»Ÿé”®ç›˜çš„å°åœ°çƒæŒ‰é”®ç”¨äºåˆ‡æ¢åˆ°å…¶ä»–é”®ç›˜ï¼š<br><img src="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/Art/globe_key_2x.png" alt="The system keyboardâ€™s Globe key"></p><p>ä½ çš„è‡ªå®šä¹‰é”®ç›˜å¿…é¡»æä¾›ç±»ä¼¼çš„æœºåˆ¶èƒ½åˆ‡æ¢åˆ°å…¶ä»–é”®ç›˜ã€‚</p><p>è°ƒç”¨UIInputViewControllerç±»çš„<a href="https://developer.apple.com/reference/uikit/uiinputviewcontroller/1618191-advancetonextinputmode" target="_blank" rel="noopener">advanceToNextInputMode</a>æ–¹æ³•å¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–é”®ç›˜ã€‚ç³»ç»Ÿä¼šé€‰æ‹©ä¸‹ä¸€ä¸ªé”®ç›˜ï¼Œæ²¡æœ‰èƒ½è·å¾—é”®ç›˜åˆ—è¡¨çš„APIï¼Œä¹Ÿæ²¡æœ‰åˆ‡æ¢åˆ°æŒ‡å®šé”®ç›˜çš„APIã€‚</p><p>Xcodeè‡ªå®šä¹‰é”®ç›˜æ¨¡æ¿ä¸­å°±å·²ç»åœ¨ä¸‹ä¸€ä¸ªé”®ç›˜æŒ‰é’®ä¸Šå…·å¤‡äº†advanceToNextInputModeçš„åŠŸèƒ½ã€‚ä¸ºäº†æä¾›æœ€å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œåº”å½“æŠŠä½ çš„ä¸‹ä¸€ä¸ªé”®ç›˜æŒ‰é”®æ”¾åœ¨é è¿‘ç³»ç»Ÿé”®ç›˜çš„å°åœ°çƒé”®çš„ä½ç½®ã€‚</p><blockquote><p>æ³¨æ„<br>è¦é€šè¿‡åº”ç”¨å®¡æ ¸ï¼Œå¿…é¡»åœ¨ä½ çš„é”®ç›˜ä¸Šæä¾›æ˜æ˜¾å…è®¸ç”¨æˆ·åˆ‡æ¢é”®ç›˜çš„UIæ ‡è¯†ã€‚</p></blockquote><h2 id="å¼€å§‹è‡ªå®šä¹‰é”®ç›˜çš„å¼€å‘"><a class="markdownIt-Anchor" href="#å¼€å§‹è‡ªå®šä¹‰é”®ç›˜çš„å¼€å‘"></a> å¼€å§‹è‡ªå®šä¹‰é”®ç›˜çš„å¼€å‘</h2><h3 id="ä½¿ç”¨xcodeè‡ªå®šä¹‰é”®ç›˜æ¨¡æ¿"><a class="markdownIt-Anchor" href="#ä½¿ç”¨xcodeè‡ªå®šä¹‰é”®ç›˜æ¨¡æ¿"></a> ä½¿ç”¨Xcodeè‡ªå®šä¹‰é”®ç›˜æ¨¡æ¿</h3><p>åˆ›å»ºé”®ç›˜åŠå…¶containing appä¸å…¶ä»–æ‰©å±•åº”ç”¨ç•¥æœ‰ä¸åŒã€‚æœ¬èŠ‚å°†å¸¦ä½ é¢†ç•¥åŸºæœ¬é”®ç›˜çš„å¼€å‘å’Œè¿è¡Œã€‚</p><p><strong>åœ¨ä¸€ä¸ªå®¹å™¨appä¸­åˆ›å»ºé”®ç›˜ï¼Œæ­¥éª¤å¦‚ä¸‹</strong></p><ol><li>åœ¨Xcodeä¸­é€‰æ‹©File &gt; New &gt; Project &gt; iOS &gt; Applicationé€‰æ‹©Single View Applicationæ¨¡æ¿ã€‚</li><li>ç‚¹å‡»Nextã€‚</li><li>å¡«å†™Project Nameï¼ˆå¦‚CKImeï¼‰ï¼Œç‚¹å‡»Nextã€‚</li><li>é€‰æ‹©è¦ä¿å­˜çš„ä½ç½®ï¼Œç‚¹å‡»Createã€‚è¿™æ ·ï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªç©ºappï¼Œè¯¥appåªèƒ½å®Œæˆä¸€ä¸ªç®€å•çš„æ“ä½œï¼Œæ¥ä¸‹æ¥å®ƒå°†æ‰¿è½½é”®ç›˜ã€‚åœ¨ä½ æäº¤åˆ°åº”ç”¨å•†åº—ä¹‹å‰ï¼Œä½ éœ€è¦å®Œæˆä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ã€‚è¯·åˆ°åº”ç”¨å®¡æ ¸æ”¯æŒå‚è€ƒåº”ç”¨å•†åº—å®¡æ ¸æŒ‡å—ã€‚</li><li>é€‰æ‹©File &gt; New &gt; Target &gt; iOS &gt; Application Extensioné€‰æ‹©Custom Keyboard Extensionï¼Œç‚¹å‡»Nextã€‚</li><li>å¡«å†™Product Nameï¼ˆå¦‚CKbdï¼‰ï¼Œç‚¹å‡»Finishã€‚</li><li>ç¡®è®¤Projectå’ŒEmbed in Applicationä¸­éƒ½æ˜¾ç¤ºçš„æ˜¯å®¹å™¨appçš„åå­—ï¼ˆCKImeï¼‰ï¼Œç‚¹å‡»Finishã€‚å¦‚æœå¼¹å‡ºActivate â€œCKbdâ€ schemeæç¤ºè®©æ¿€æ´»é”®ç›˜å·¥ç¨‹ï¼Œç‚¹å‡»Activateã€‚</li></ol><p><strong>å®šä¹‰é”®ç›˜group nameï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ol><li>åœ¨Xcodeå·¥ç¨‹å¯¼èˆªè§†å›¾ä¸­ï¼Œé€‰æ‹©å®¹å™¨appçš„Info.plistæ–‡ä»¶ï¼Œ</li><li>åœ¨å³ä¾§plistç¼–è¾‘å™¨ä¸­ï¼Œé¼ æ ‡hoveråˆ°Bundle nameä¸Šï¼Œç‚¹â€œ+â€æŒ‰é’®åˆ›å»ºä¸€è¡Œç©ºå±æ€§ã€‚</li><li>åœ¨Keyä¸­å¡«å†™Bundle display nameï¼Œå›è½¦</li><li>åŒå‡»è¯¥è¡Œçš„Valueï¼Œå¡«å†™ä½ è¦è‡ªå®šä¹‰çš„é”®ç›˜group nameã€‚</li><li>é€‰æ‹©File &gt; Saveä¿å­˜è®¾ç½®ã€‚</li></ol><p>ä¸‹è¡¨æ±‡æ€»äº†åœ¨å®¹å™¨appå’Œé”®ç›˜appçš„Info.plistæ–‡ä»¶ä¸­ä½ å¯ä»¥é…ç½®çš„UIå­—ç¬¦ä¸²ï¼š</p><table><thead><tr><th>iOS UIå­—ç¬¦ä¸²</th><th>Info.plistå…³é”®å­—</th></tr></thead><tbody><tr><td>Â· åœ¨ç³»ç»Ÿè®¾ç½®çš„å·²è´­é”®ç›˜åˆ—è¡¨ä¸­çš„é”®ç›˜group name</td><td>åœ¨å®¹å™¨appçš„Info.plistæ–‡ä»¶ä¸­çš„Bundle display name</td></tr><tr><td>Â· ç³»ç»Ÿè®¾ç½®ä¸­çš„é”®ç›˜åç§°<br>Â· é”®ç›˜æ¢åˆ—è¡¨ä¸­çš„é”®ç›˜åç§°</td><td>åœ¨é”®ç›˜appçš„Info.plistæ–‡ä»¶ä¸­çš„Bundle display name</td></tr></tbody></table><p><strong>è¿è¡Œè‡ªå®šä¹‰é”®ç›˜å¹¶å°†Xcodeè°ƒè¯•å™¨attachåˆ°å®ƒä¸Šé¢</strong></p><ol><li>åœ¨Xcodeï¼Œä½ çš„view controllerå®ç°ä¸­è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼ˆæ¯”å¦‚å¯ä»¥æ–­åœ¨viewDidLoadä¸Šï¼‰ã€‚</li><li>åœ¨Xcodeå·¥å…·æ ç¡®ä¿å½“å‰æ´»åŠ¨çš„é¡¹ç›®ä¸ºé”®ç›˜é¡¹ç›®ï¼Œå¹¶å¯¹åº”iOSæ¨¡æ‹Ÿå™¨æˆ–è®¾å¤‡ã€‚</li><li>é€‰æ‹©èœå•Project &gt; Runï¼Œæˆ–ç‚¹å‡»Build and then run the current schemeæŒ‰é’®ï¼ˆå³æ’­æ”¾æŒ‰é’®ï¼‰ã€‚Xcodeä¼šæç¤ºé€‰æ‹©host appã€‚é€‰æ‹©ä¸€ä¸ªå¸¦æœ‰è¾“å…¥æ¡†çš„ï¼Œæ¯”å¦‚é€šè®¯å½•æˆ–Safariã€‚</li><li>ç‚¹å‡»Runã€‚Xcodeå°†è¿è¡Œèµ·ä½ æŒ‡å®šçš„host appã€‚å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡ä½¿ç”¨é”®ç›˜æ‰©å±•åº”ç”¨ï¼Œéœ€è¦ç°åœ¨è®¾ç½®ä¸­æ·»åŠ å¹¶å¯ç”¨é”®ç›˜ï¼š<ol><li>Settings &gt; General &gt; Keyboard &gt; Keyboards</li><li>ç‚¹å‡»Add New Keyboardâ€¦</li><li>åœ¨OTHER IPHONE KEYBOARDSä¸­ç‚¹å‡»ä½ åˆšåˆšåˆ›å»ºçš„é”®ç›˜</li></ol></li><li>åœ¨iOSæ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šï¼Œè°ƒå‡ºä½ çš„è‡ªå®šä¹‰é”®ç›˜ã€‚<br>ç‚¹å‡»ä»»æ„å¯è¾“å…¥åŒºåŸŸï¼Œå°†æ˜¾ç¤ºå‡ºç³»ç»Ÿé”®ç›˜ã€‚æŒ‰ä½å°åœ°çƒï¼Œé€‰æ‹©ä½ çš„è‡ªå®šä¹‰é”®ç›˜ã€‚<br>æ­¤æ—¶ä½ å°†çœ‹åˆ°è‡ªå®šä¹‰é”®ç›˜ï¼Œä½†æ˜¯è°ƒè¯•å™¨å°šæœªattachä¸Šæ¥ã€‚ä¸€ä¸ªä»æ¨¡æ¿æ„å»ºè€Œæ¥çš„æç®€é”®ç›˜ä»…æœ‰ä¸€ä¸ªNext KeyboardæŒ‰é’®ï¼Œç‚¹å‡»ååˆ‡æ¢å›å‰ä¸€ä¸ªé”®ç›˜ã€‚</li><li>å–æ¶ˆä½ çš„é”®ç›˜ï¼ˆä»¥ä¾¿åœ¨ç¬¬8æ­¥ä¸­ä½ å¯ä»¥å†æ¬¡è°ƒå‡ºé”®ç›˜ä»¥å‘½ä¸­viewDidLoadæ–­ç‚¹ï¼‰</li><li>åœ¨Xcodeä¸­ï¼Œé€‰æ‹©Debug &gt; Attach to Process &gt; By Process Identifier(PID) or Name åœ¨å¼¹å‡ºå¯¹è¯æ¡†ä¸­ï¼Œè¾“å…¥ä½ çš„é”®ç›˜æ‰©å±•åº”ç”¨çš„åå­—ï¼ˆåŒ…å«ç©ºæ ¼ï¼‰.é»˜è®¤å°±æ˜¯è¯¥æ‰©å±•åº”ç”¨åœ¨å·¥ç¨‹å¯¼èˆªçª—å£é‡Œçš„group nameã€‚</li><li>ç‚¹å‡»Attachã€‚Xcodeå°†æ˜¾ç¤ºå‡ºç­‰å¾…attachçš„è°ƒè¯•å™¨ã€‚</li><li>åœ¨ä»»æ„èƒ½è¾“å…¥æ–‡å­—çš„appä¸­è°ƒå‡ºé”®ç›˜ã€‚<br>å½“ä½ çš„é”®ç›˜ä¸»è§†å›¾å¼€å§‹åŠ è½½æ—¶ï¼ŒXcodeè°ƒè¯•å™¨å°†attacheåˆ°ä½ çš„é”®ç›˜ï¼Œå¹¶å‘½ä¸­æ–­ç‚¹ã€‚</li></ol><h3 id="ä¸ºè‡ªå®šä¹‰é”®ç›˜é…ç½®infoplistæ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä¸ºè‡ªå®šä¹‰é”®ç›˜é…ç½®infoplistæ–‡ä»¶"></a> ä¸ºè‡ªå®šä¹‰é”®ç›˜é…ç½®Info.plistæ–‡ä»¶</h3><p>è‡ªå®šä¹‰é”®ç›˜çš„Info.plistæ–‡ä»¶å…è®¸é™æ€å®šä¹‰é”®ç›˜çš„ç°å¼ç‰¹å¾ï¼ŒåŒ…æ‹¬ä¸»è¦è¯­è¨€ï¼Œä»¥åŠæ˜¯å¦éœ€è¦open accessæƒé™ã€‚</p><p>æ‰“å¼€Xcodeå¹¶åˆ‡æ¢åˆ°è‡ªå®šä¹‰é”®ç›˜çš„ targetã€‚åœ¨å·¥ç¨‹å¯¼èˆªæ é€‰æ‹©Info.plistæ–‡ä»¶ï¼ŒæŒ‰æ–‡æœ¬æ ¼å¼å‘ˆç°å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>NSExtension<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>NSExtensionAttributes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>IsASCIICapable<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>PrefersRightToLeft<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>PrimaryLanguage<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>en-US<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>RequestsOpenAccess<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>NSExtensionPointIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>com.apple.keyboard-service<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>NSExtensionPrincipalClass<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>KeyboardViewController<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸ªå…³é”®å­—åœ¨App Extension Keysä¸­éƒ½æœ‰è§£é‡Šã€‚å¯ä»¥ä½¿ç”¨å­—å…¸NSExtensionAttributesä¸­çš„å…³é”®å­—æ¥æè¿°ä½ çš„è‡ªå®šä¹‰é”®ç›˜çš„ç‰¹å¾å’Œéœ€æ±‚ï¼Œå¦‚ä¸‹ï¼š</p><p><code>IsASCIICapable</code> - é»˜è®¤ä¸ºNOçš„å¸ƒå°”å€¼ã€‚ç”¨æˆ·é”®ç›˜æ˜¯å¦å¯ä»¥å‘æ–‡æ¡£ä¸­æ’å…¥ASCIIå­—ä¸²ã€‚å¦‚æœè¦ä¸º<code>UIKeyboardTypeASCIICapable</code>å±æ€§çš„è¾“å…¥å¯¹è±¡å±•ç°å•ç‹¬ç±»å‹çš„é”®ç›˜ï¼Œéœ€è¦å°†è¯¥å€¼ç½®ä¸ºYESã€‚</p><p><code>PrefersRightToLeft</code> - é»˜è®¤ä¸ºNOçš„å¸ƒå°”å€¼ã€‚æ˜¯å¦ä¸ºä»å³åˆ°å·¦çš„è¯­ç§è®¾è®¡çš„çš„è‡ªå®šä¹‰é”®ç›˜ã€‚</p><p><code>PrimaryLanguage</code> - é»˜è®¤ä¸ºen-USçš„å­—ä¸²ã€‚ä»¥&lt;è¯­ç§&gt;-&lt;åŒºåŸŸ&gt;çš„å½¢å¼æè¿°é”®ç›˜çš„ä¸»è¯­è¨€ã€‚å¯ä»¥åˆ°http://www.opensource.apple.com/source/CF/CF-476.14/CFLocaleIdentifier.cæ‰¾åˆ°å¯¹åº”çš„è¯­ç§å’ŒåŒºåŸŸã€‚</p><p><code>RequestsOpenAccess</code> - é»˜è®¤ä¸ºNOçš„å¸ƒå°”å€¼ã€‚æ˜¯å¦éœ€è¦æ¯”åŸºç¡€é”®ç›˜æ›´å¤§çš„æ²™ç›’èŒƒå›´ã€‚æŠŠè¯¥å€¼ç½®ä¸ºYESå°†éœ€è¦å®Œå…¨è®¿é—®æƒé™ï¼Œä½ çš„é”®ç›˜å°†è·å¾—å¦‚ä¸‹èƒ½åŠ›ï¼Œæ¯ä¸ªèƒ½åŠ›éƒ½ä¼´éšæœ‰ç›¸åº”çš„æƒé™ï¼š</p><ul><li>è®¿é—®å®šä½æœåŠ¡ï¼Œé€šè®¯å½•æ•°æ®åº“ï¼Œç›¸æœºï¼Œæ¯ä¸ªéƒ½éœ€è¦ç”¨æˆ·å…è®¸</li><li>ä¸é”®ç›˜çš„å®¹å™¨appå…±äº«å®¹å™¨æ•°æ®ï¼Œä»¥ä¾¿å®Œæˆæ¯”å¦‚åœ¨å®¹å™¨appä¸­ç®¡ç†ç”¨æˆ·è¯åº“çš„ç•Œé¢çš„åŠŸèƒ½</li><li>é€šè¿‡ç½‘ç»œå‘é€æŒ‰é”®ã€è¾“å…¥äº‹ä»¶ä¹‹ç±»çš„æ•°æ®ä¾›äº‘ç«¯å¤„ç†</li><li>ä½¿ç”¨UIPasteboardç±»</li><li>æ’­æ”¾éŸ³é¢‘ï¼ŒåŒ…æ‹¬ä½¿ç”¨playInputClickæ–¹æ³•æ’­æ”¾æŒ‰é”®éŸ³</li><li>è®¿é—®iCloudï¼Œå¯ä»¥ç”¨æ¥æ ¹æ®ç”¨æˆ·èº«ä»½åŒæ­¥æ¯”å¦‚é”®ç›˜è®¾ç½®ã€è‡ªå®šä¹‰è‡ªåŠ¨çº é”™è¯å…¸</li><li>é€šè¿‡å®¹å™¨appè®¿é—®æ¸¸æˆä¸­å¿ƒå’Œåº”ç”¨å†…è´­ä¹°</li><li>å¦‚æœä½ çš„é”®ç›˜æ”¯æŒç§»åŠ¨è®¾å¤‡ç®¡ç†ï¼ˆMDMï¼‰ï¼Œå¯ä»¥ä¸è¢«ç®¡ç†çš„appæ— ç¼åˆä½œ</li></ul><p>å½“è€ƒè™‘æ˜¯å¦å°†è¿™äº›å…³é”®å­—è®¾ç½®ä¸ºYESä¹‹å‰ï¼Œä¸€å®šè¦å…ˆé˜…è¯»<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/ExtensibilityPG/CustomKeyboard.html#//apple_ref/doc/uid/TP40014214-CH16-SW3" target="_blank" rel="noopener">ã€Šç”¨æˆ·ä¿¡ä»»è®¾è®¡ã€‹</a>ï¼Œè¿™é‡Œæè¿°äº†å¦‚ä½•å°Šé‡å’Œä¿æŠ¤ç”¨æˆ·æ•°æ®ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="iOS Programming" scheme="https://changzw.github.io/categories/iOS-Programming/"/>
    
      <category term="AppExtensions" scheme="https://changzw.github.io/categories/iOS-Programming/AppExtensions/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
      <category term="ç¿»è¯‘" scheme="https://changzw.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>runloop å®è·µç›¸å…³</title>
    <link href="https://changzw.github.io/2019/12/29/runloop/runloop-%E5%AE%9E%E8%B7%B5%E7%9B%B8%E5%85%B3/"/>
    <id>https://changzw.github.io/2019/12/29/runloop/runloop-%E5%AE%9E%E8%B7%B5%E7%9B%B8%E5%85%B3/</id>
    <published>2019-12-29T11:00:54.000Z</published>
    <updated>2020-05-29T04:54:34.402Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:12 GMT+0800 (CST) --><a id="more"></a><p>RunLoop æ˜¯ç³»ç»Ÿå±‚çº§ä¸Šçš„è®¾è®¡ï¼Œç”¨æ¥ç»™ç®¡ç†ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—æ´¾å‘ï¼Œé‚£æˆ‘ä»¬éƒ½å¯ä»¥ç”¨ runLoop åšä»€ä¹ˆå‘¢ï¼Ÿ<br>ç®€å•æ¥è¯´ï¼ŒRunLoop æ˜¯ç”¨æ¥ç›‘å¬è¾“å…¥æºï¼Œè¿›è¡Œè°ƒåº¦å¤„ç†çš„ã€‚</p><p>RunLoop è¾“å…¥æºå¯ä»¥æ˜¯ï¼š</p><ul><li>è¾“å…¥è®¾å¤‡</li><li>ç½‘ç»œ</li><li>å‘¨æœŸæ€§æˆ–è€…å»¶è¿Ÿæ—¶é—´</li><li>å¼‚æ­¥å›è°ƒ</li></ul><p><img src="/img/runloop_core.jpeg" alt="runloop activities"></p><p>runloop çš„ observer å¯ä»¥ç›‘å¬çš„ 7ä¸­çŠ¶æ€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">CF_OPTIONS</span><span class="params">(CFOptionFlags, CFRunLoopActivity)</span> </span>&#123;</span><br><span class="line">  kCFRunLoopEntry ,         <span class="comment">// è¿›å…¥ loop</span></span><br><span class="line">  kCFRunLoopBeforeTimers ,  <span class="comment">// è§¦å‘ Timer ä¹‹å‰</span></span><br><span class="line">  kCFRunLoopBeforeSources , <span class="comment">// è§¦å‘ Source0 ä¹‹å‰</span></span><br><span class="line">  kCFRunLoopBeforeWaiting , <span class="comment">// ç­‰å¾… mach_port æ¶ˆæ¯ï¼ˆç­‰å¾…æºSourceå’Œè®¡æ—¶å™¨Timerä¹‹å‰ï¼Œè¿›å…¥ç¡çœ ï¼‰</span></span><br><span class="line">  <span class="comment">// åœ¨è¿™ä¸¤ä¸ªçŠ¶æ€ä¸­çœŸæ­£å¤„ç†äº‹ä»¶</span></span><br><span class="line">  kCFRunLoopAfterWaiting ), <span class="comment">// æ¥æ”¶ mach_port æ¶ˆæ¯ï¼ˆç­‰å¾…æºSourceå’Œè®¡æ—¶å™¨Timeråï¼ŒåŒæ—¶åœ¨è¢«å”¤é†’ä¹‹å‰ï¼‰</span></span><br><span class="line">  kCFRunLoopExit , <span class="comment">// é€€å‡º loop</span></span><br><span class="line">  kCFRunLoopAllActivities  <span class="comment">// loop æ‰€æœ‰çŠ¶æ€æ”¹å˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ£€æµ‹-ios-app-å¡é¡¿"><a class="markdownIt-Anchor" href="#æ£€æµ‹-ios-app-å¡é¡¿"></a> æ£€æµ‹ iOS App å¡é¡¿</h2><h3 id="æ€è·¯åˆ†æ"><a class="markdownIt-Anchor" href="#æ€è·¯åˆ†æ"></a> æ€è·¯åˆ†æ</h3><h4 id="å¡é¡¿å¦‚ä½•é€ æˆçš„"><a class="markdownIt-Anchor" href="#å¡é¡¿å¦‚ä½•é€ æˆçš„"></a> å¡é¡¿å¦‚ä½•é€ æˆçš„</h4><p>iOSç³»ç»Ÿé¡µé¢åˆ·æ–°é¢‘ç‡ï¼š60 FPSï¼Œ60æ¬¡/s, <code>let refresh_time_per = 1s/60 &lt; 0.02</code><br>å¦‚æœåœ¨ <code>refresh_time_per</code> æ—¶é—´å†…æ²¡æœ‰å®Œæˆå›¾ç‰‡ç»˜åˆ¶ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å¡é¡¿ç°è±¡ï¼<br>è€Œç³»ç»Ÿé¡µé¢åˆ·æ–°äº‹ä»¶å¤„ç†â€¦â€¦ äº‹ä»¶å‡ ä¹éƒ½æ˜¯ç”± runloop è°ƒç”¨æ‰§è¡Œçš„ã€‚<br>é‚£ä¹ˆå¦‚æœ runloop ä¸€æ¬¡å¾ªç¯æ—¶é—´ &gt; <code>refresh_time_per</code> å°±è¯´æ˜å›¾ç‰‡æ²¡æœ‰æ¸²æŸ“å®Œæˆï¼Œå¯¼è‡´å¡é¡¿ã€‚</p><p>é—®é¢˜æ¥äº†ï¼Œå¦‚ä½•åˆ¤æ–­ runloop ä¸€æ¬¡å¾ªç¯æ—¶é—´ &gt; <code>refresh_time_per</code> å‘¢ï¼Ÿ</p><p>RunLoop çš„çº¿ç¨‹ï¼Œè¿›å…¥ç¡çœ å‰æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´è¿‡é•¿è€Œå¯¼è‡´æ— æ³•è¿›å…¥ç¡çœ ï¼Œæˆ–è€…çº¿ç¨‹å”¤é†’åæ¥æ”¶æ¶ˆæ¯æ—¶é—´è¿‡é•¿è€Œæ— æ³•è¿›å…¥ä¸‹ä¸€æ­¥çš„è¯ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯çº¿ç¨‹å—é˜»äº†ã€‚å¦‚æœè¿™ä¸ªçº¿ç¨‹æ˜¯ä¸»çº¿ç¨‹çš„è¯ï¼Œè¡¨ç°å‡ºæ¥çš„å°±æ˜¯å‡ºç°äº†å¡é¡¿ã€‚</p><p>æ‰€ä»¥è¦åˆ©ç”¨ RunLoop åŸç†æ¥ç›‘æ§å¡é¡¿çš„è¯ï¼Œå°±æ˜¯è¦å…³æ³¨è¿™ä¸¤ä¸ªé˜¶æ®µã€‚<br>RunLoop çš„ä¸¤ä¸ª loop çŠ¶æ€<br>åœ¨è¿›å…¥ç¡çœ ä¹‹å‰: kCFRunLoopBeforeSources<br>åœ¨è¿›å…¥å”¤é†’ä¹‹å: kCFRunLoopAfterWaiting<br>ä¹Ÿå°±æ˜¯è¦è§¦å‘ Source0 å›è°ƒå’Œæ¥æ”¶ mach_port æ¶ˆæ¯ä¸¤ä¸ªçŠ¶æ€ã€‚</p><details><summary>runloop æ ¸å¿ƒæºç </summary><pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// while</span></span><br><span class="line"><span class="comment">// 2. é€šçŸ¥ Observers: RunLoop å³å°†è§¦å‘ Timer å›è°ƒã€‚</span></span><br><span class="line">__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeTimers);</span><br><span class="line"><span class="comment">// 3. é€šçŸ¥ Observers: RunLoop å³å°†è§¦å‘ Source0 (éport) å›è°ƒã€‚</span></span><br><span class="line">__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeSources);</span><br><span class="line"><span class="comment">// æ‰§è¡Œè¢«åŠ å…¥çš„block</span></span><br><span class="line">__CFRunLoopDoBlocks(runloop, currentMode);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. RunLoop è§¦å‘ Source0 (éport) å›è°ƒã€‚</span></span><br><span class="line">sourceHandledThisLoop = __CFRunLoopDoSources0(runloop, currentMode, stopAfterHandle);</span><br><span class="line"><span class="comment">// æ‰§è¡Œè¢«åŠ å…¥çš„block</span></span><br><span class="line">__CFRunLoopDoBlocks(runloop, currentMode);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. å¦‚æœæœ‰ Source1 (åŸºäºport) å¤„äº ready çŠ¶æ€ï¼Œç›´æ¥å¤„ç†è¿™ä¸ª Source1 ç„¶åè·³è½¬å»å¤„ç†æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (__Source0DidDispatchPortLastTime) &#123;</span><br><span class="line">  Boolean hasMsg = __CFRunLoopServiceMachPort(dispatchPort, &amp;msg)</span><br><span class="line">  <span class="keyword">if</span> (hasMsg) <span class="keyword">goto</span> handle_msg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šçŸ¥ Observers: RunLoop çš„çº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ (sleep)ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (!sourceHandledThisLoop) &#123;</span><br><span class="line">  __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeWaiting);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. è°ƒç”¨ mach_msg ç­‰å¾…æ¥å— mach_port çš„æ¶ˆæ¯ã€‚çº¿ç¨‹å°†è¿›å…¥ä¼‘çœ , ç›´åˆ°è¢«ä¸‹é¢æŸä¸€ä¸ªäº‹ä»¶å”¤é†’ã€‚</span></span><br><span class="line"><span class="comment">// â€¢ ä¸€ä¸ªåŸºäº port çš„Source çš„äº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">// â€¢ ä¸€ä¸ª Timer åˆ°æ—¶é—´äº†</span></span><br><span class="line"><span class="comment">// â€¢ RunLoop è‡ªèº«çš„è¶…æ—¶æ—¶é—´åˆ°äº†</span></span><br><span class="line"><span class="comment">// â€¢ è¢«å…¶ä»–ä»€ä¹ˆè°ƒç”¨è€…æ‰‹åŠ¨å”¤é†’</span></span><br><span class="line">__CFRunLoopServiceMachPort(waitSet, &amp;msg, <span class="keyword">sizeof</span>(msg_buffer), &amp;livePort) &#123;</span><br><span class="line">  mach_msg(msg, MACH_RCV_MSG, port); <span class="comment">// thread wait for receive msg</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. é€šçŸ¥ Observers: RunLoop çš„çº¿ç¨‹åˆšåˆšè¢«å”¤é†’äº†ã€‚</span></span><br><span class="line">__CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopAfterWaiting);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶åˆ°æ¶ˆæ¯ï¼Œå¤„ç†æ¶ˆæ¯ã€‚</span></span><br><span class="line">handle_msg:</span><br><span class="line">      <span class="comment">// 9.1 å¦‚æœä¸€ä¸ª Timer åˆ°æ—¶é—´äº†ï¼Œè§¦å‘è¿™ä¸ªTimerçš„å›è°ƒã€‚</span></span><br><span class="line"><span class="keyword">if</span> (msg_is_timer) &#123;</span><br><span class="line">  __CFRunLoopDoTimers(runloop, currentMode, mach_absolute_time())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9.2 å¦‚æœæœ‰dispatchåˆ°main_queueçš„blockï¼Œæ‰§è¡Œblockã€‚</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (msg_is_dispatch) &#123;</span><br><span class="line">  __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9.3 å¦‚æœä¸€ä¸ª Source1 (åŸºäºport) å‘å‡ºäº‹ä»¶äº†ï¼Œå¤„ç†è¿™ä¸ªäº‹ä»¶</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  CFRunLoopSourceRef source1 = __CFRunLoopModeFindSourceForMachPort(runloop, currentMode, livePort);</span><br><span class="line">  sourceHandledThisLoop = __CFRunLoopDoSource1(runloop, currentMode, source1, msg);</span><br><span class="line">  <span class="keyword">if</span> (sourceHandledThisLoop) &#123;</span><br><span class="line">    mach_msg(reply, MACH_SEND_MSG, reply);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  é€€å‡º runloop é€»è¾‘ retVal != 0 exit</span></span><br><span class="line"><span class="keyword">if</span> (sourceHandledThisLoop &amp;&amp; stopAfterHandle) &#123;</span><br><span class="line">  <span class="comment">// è¿›å…¥loopæ—¶å‚æ•°è¯´å¤„ç†å®Œäº‹ä»¶å°±è¿”å›ã€‚</span></span><br><span class="line">  retVal = kCFRunLoopRunHandledSource;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">  <span class="comment">// è¶…å‡ºä¼ å…¥å‚æ•°æ ‡è®°çš„è¶…æ—¶æ—¶é—´äº†</span></span><br><span class="line">  retVal = kCFRunLoopRunTimedOut;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (__CFRunLoopIsStopped(runloop)) &#123;</span><br><span class="line">  <span class="comment">// è¢«å¤–éƒ¨è°ƒç”¨è€…å¼ºåˆ¶åœæ­¢äº†</span></span><br><span class="line">  retVal = kCFRunLoopRunStopped;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (__CFRunLoopModeIsEmpty(runloop, currentMode)) &#123;</span><br><span class="line">  <span class="comment">// source/timer/observerä¸€ä¸ªéƒ½æ²¡æœ‰äº†</span></span><br><span class="line">  retVal = kCFRunLoopRunFinished;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></pre></details><h3 id="å¡é¡¿ç›‘å¬å®è·µ"><a class="markdownIt-Anchor" href="#å¡é¡¿ç›‘å¬å®è·µ"></a> å¡é¡¿ç›‘å¬å®è·µ</h3><ol><li>åˆ›å»º runloop çš„observerå¯¹è±¡:</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> weakSelf = <span class="type">Unmanaged</span>&lt;<span class="type">Monitor</span>&gt;.passUnretained(<span class="keyword">self</span>).toOpaque()</span><br><span class="line"><span class="keyword">var</span> ctx: <span class="type">CFRunLoopObserverContext</span> = <span class="type">CFRunLoopObserverContext</span>(version: <span class="number">0</span>, weakSelf: info, retain: <span class="literal">nil</span>, release: <span class="literal">nil</span>, copyDescription: <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">self</span>.runLoopObserver = <span class="type">CFRunLoopObserverCreate</span>(kCFAllocatorDefault, <span class="type">CFRunLoopActivity</span>.allActivities.rawValue, <span class="literal">true</span>, <span class="number">0</span>, runLoopCallBack(), &amp;ctx)</span><br></pre></td></tr></table></figure><ol start="2"><li>å°† observer æ·»åŠ åˆ° runloop çš„ commonModes ä¸­</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CFRunLoopAddObserver</span>(<span class="type">CFRunLoopGetCurrent</span>(), <span class="keyword">self</span>.runLoopObserver, <span class="type">CFRunLoopMode</span>.commonModes)</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºå­çº¿ç¨‹ï¼Œç›‘å¬runloopçš„çŠ¶æ€<ul><li>beforeSources: è¿›å…¥ç¡çœ å‰</li><li>afterWaiting: å”¤é†’åçš„çŠ¶æ€</li><li>è®¾ç½®å¡é¡¿é˜€å€¼</li><li>æ‰“å°å †æ ˆä¿¡æ¯</li></ul></li></ol><p>ä¸ºä»€ä¹ˆè¦ç›‘å¬ beforeSources å’Œ afterWaiting è¿™ä¸¤ä¸ªçŠ¶æ€å‘¢ï¼Ÿ<br>å› ä¸ºåªæœ‰è¿™ä¸¤ä¸ªçŠ¶æ€ runloop è§¦å‘äº‹ä»¶å›è°ƒï¼Œå¦‚æœrunloop é•¿æ—¶é—´å¤„äºè¿™ä¸¤ä¸ªçŠ¶æ€ä¸­è¯´æ˜å¡é¡¿ï¼</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DispatchQueue</span>.global().async &#123;</span><br><span class="line">  <span class="keyword">while</span> <span class="literal">true</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> sem = <span class="keyword">self</span>.dispatchSemaphore?.wait(timeout: <span class="type">DispatchTime</span>.now() + <span class="number">1</span> / <span class="number">50</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">case</span> <span class="type">DispatchTimeoutResult</span>.timedOut = sem &#123;</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> <span class="number">_</span> = <span class="keyword">self</span>.runLoopObserver <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.dispatchSemaphore = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">self</span>.runLoopActivity = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">self</span>.runLoopActivity == <span class="type">CFRunLoopActivity</span>.beforeSources || <span class="keyword">self</span>.runLoopActivity == <span class="type">CFRunLoopActivity</span>.afterWaiting) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"symbo: \(Thread.callStackSymbols)"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"æ‰“å°å¡é¡¿å †æ ˆ..."</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•è·å–å¡é¡¿çš„æ–¹æ³•å †æ ˆä¿¡æ¯"><a class="markdownIt-Anchor" href="#å¦‚ä½•è·å–å¡é¡¿çš„æ–¹æ³•å †æ ˆä¿¡æ¯"></a> å¦‚ä½•è·å–å¡é¡¿çš„æ–¹æ³•å †æ ˆä¿¡æ¯ï¼Ÿ</h3><h4 id="ç›´æ¥è°ƒç”¨ç³»ç»Ÿå‡½æ•°è·å–"><a class="markdownIt-Anchor" href="#ç›´æ¥è°ƒç”¨ç³»ç»Ÿå‡½æ•°è·å–"></a> ç›´æ¥è°ƒç”¨ç³»ç»Ÿå‡½æ•°è·å–</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> s_fatal_signals[] = &#123;</span><br><span class="line">  SIGABRT,</span><br><span class="line">  SIGBUS,</span><br><span class="line">  SIGFPE,</span><br><span class="line">  SIGILL,</span><br><span class="line">  SIGSEGV,</span><br><span class="line">  SIGTRAP,</span><br><span class="line">  SIGTERM,</span><br><span class="line">  SIGKILL,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> s_fatal_signal_num = <span class="keyword">sizeof</span>(s_fatal_signals) / <span class="keyword">sizeof</span>(s_fatal_signals[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> UncaughtExceptionHandler(<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">  <span class="built_in">NSArray</span> *exceptionArray = [exception callStackSymbols]; <span class="comment">// å¾—åˆ°å½“å‰è°ƒç”¨æ ˆä¿¡æ¯</span></span><br><span class="line">  <span class="built_in">NSString</span> *exceptionReason = [exception reason];     <span class="comment">// éå¸¸é‡è¦ï¼Œå°±æ˜¯å´©æºƒçš„åŸå› </span></span><br><span class="line">  <span class="built_in">NSString</span> *exceptionName = [exception name];       <span class="comment">// å¼‚å¸¸ç±»å‹</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> SignalHandler(<span class="keyword">int</span> code) &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"signal handler = %d"</span>,code);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> InitCrashReport() &#123;</span><br><span class="line">  <span class="comment">// ç³»ç»Ÿé”™è¯¯ä¿¡å·æ•è·</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s_fatal_signal_num; ++i) &#123;</span><br><span class="line">    signal(s_fatal_signals[i], SignalHandler);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//oc æœªæ•è·å¼‚å¸¸çš„æ•è·</span></span><br><span class="line">  <span class="built_in">NSSetUncaughtExceptionHandler</span>(&amp;UncaughtExceptionHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">  <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">    InitCrashReport();</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸‰æ–¹åº“æ¥è·å–å †æ ˆä¿¡æ¯"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰æ–¹åº“æ¥è·å–å †æ ˆä¿¡æ¯"></a> ç¬¬ä¸‰æ–¹åº“æ¥è·å–å †æ ˆä¿¡æ¯</h4><p><a href="https://opensource.plausible.coop/src/projects/PLCR/repos/plcrashreporter/browse" target="_blank" rel="noopener">PLCrashReporter</a></p><h2 id="åˆ©ç”¨runloopç©ºé—²æ—¶é—´"><a class="markdownIt-Anchor" href="#åˆ©ç”¨runloopç©ºé—²æ—¶é—´"></a> åˆ©ç”¨RunLoopç©ºé—²æ—¶é—´</h2><p>å¡é¡¿æ˜¯å› ä¸º runloop ä¸€æ¬¡æ—¶é—´ &gt; 1/60s<br>é‚£ä¹ˆå¦‚æœ runloop ä¸€æ¬¡è¿è¡Œæ—¶é—´ &lt; 1/60s å‘¢ï¼Ÿ<br>è­¬å¦‚ä½ æŠŠæ‰‹æœºæ”¾åœ¨é‚£çœ‹ç€ appï¼Œrunloop åœ¨é‚£ç¡è§‰(<code>kCFRunLoopBeforeWaiting</code>)</p><p>è¿™ä¸ªæ—¶å€™å¾€ runloop é‡Œé¢æ”¾ä¸ª source or timerï¼Œrunloop å°±ä¼šé†’æ¥ è¿›å…¥ <code>kCFRunLoopAfterWaiting</code> çŠ¶æ€</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">BeforeWaitingDo</span> = () -&gt; ()</span><br><span class="line"><span class="keyword">var</span> tasks: [<span class="type">BeforeWaitingDo</span>] = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">exec</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">let</span> t = <span class="keyword">self</span>.tasks.remove(at: <span class="number">0</span>)</span><br><span class="line">  t()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerObserver</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">let</span> rl = <span class="type">CFRunLoopGetCurrent</span>()</span><br><span class="line">  <span class="keyword">let</span> observer = <span class="type">CFRunLoopObserverCreateWithHandler</span>(kCFAllocatorDefault, <span class="type">CFRunLoopActivity</span>.beforeWaiting.rawValue, <span class="literal">true</span>, <span class="number">0</span>) &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] (observer, actives) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> = <span class="keyword">self</span>,</span><br><span class="line">    <span class="keyword">let</span> <span class="number">_</span> = <span class="keyword">self</span>.tasks.first <span class="keyword">else</span> &#123;<span class="keyword">return</span>&#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ª source0 æŠŠ runloop è¢«å«é†’</span></span><br><span class="line">    <span class="keyword">self</span>.perform(#selector(<span class="type">ChatEmojiViewController</span>.exec), on: <span class="type">Thread</span>.current, with: <span class="literal">nil</span>, waitUntilDone: <span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">CFRunLoopAddObserver</span>(rl, observer, <span class="type">CFRunLoopMode</span>.commonModes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Ftime.geekbang.org%2Fcolumn%2Fintro%2F161%3Fcode%3DQjb1JtJcvAPISj9QjxdKrAmeXmURMroQbkOcLNm0jeY%253D%26from%3Dsinglemessage%26isappinstalled%3D0" target="_blank" rel="noopener">ã€ŠiOSå¼€å‘é«˜æ‰‹è¯¾ã€‹</a><br><a href="https://www.jianshu.com/p/632d7a1526e9" target="_blank" rel="noopener">iOS æ€§èƒ½ç›‘æ§ï¼ˆäºŒï¼‰â€”â€” ä¸»çº¿ç¨‹å¡é¡¿ç›‘æ§</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:12 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="iOS Programming" scheme="https://changzw.github.io/categories/iOS-Programming/"/>
    
      <category term="runloop" scheme="https://changzw.github.io/categories/iOS-Programming/runloop/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
      <category term="åº•å±‚" scheme="https://changzw.github.io/tags/%E5%BA%95%E5%B1%82/"/>
    
  </entry>
  
  <entry>
    <title>è°ƒè¯•å†…å­˜ä¸è¶³é—®é¢˜ï¼šä½¿ç”¨è¿è¡Œæ—¶é­”æ³•æ•è·å¸ƒå±€åé¦ˆå¾ªç¯</title>
    <link href="https://changzw.github.io/2019/12/01/performance/%E8%B0%83%E8%AF%95%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BD%BF%E7%94%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E9%AD%94%E6%B3%95%E6%8D%95%E8%8E%B7%E5%B8%83%E5%B1%80%E5%8F%8D%E9%A6%88%E5%BE%AA%E7%8E%AF/"/>
    <id>https://changzw.github.io/2019/12/01/performance/%E8%B0%83%E8%AF%95%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BD%BF%E7%94%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E9%AD%94%E6%B3%95%E6%8D%95%E8%8E%B7%E5%B8%83%E5%B1%80%E5%8F%8D%E9%A6%88%E5%BE%AA%E7%8E%AF/</id>
    <published>2019-11-30T23:25:43.000Z</published>
    <updated>2020-04-25T02:55:55.884Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><p>ç›®æ ‡ï¼š<br>ä½¿ç”¨ä»£ç æ›¿ä»£ <code>UIViewLayoutFeedbackLoopDebuggingThreshold</code> ç¬¦å·è°ƒè¯•ï¼Œæ¥æ•è· Autolayoutåé¦ˆå¾ªç¯æ‰€å¯¼è‡´çš„å†…å­˜ä¸è¶³é—®é¢˜ã€‚</p><h2 id="å¯¼è‡´å†…å­˜ä¸è¶³çš„åŸå› "><a class="markdownIt-Anchor" href="#å¯¼è‡´å†…å­˜ä¸è¶³çš„åŸå› "></a> å¯¼è‡´å†…å­˜ä¸è¶³çš„åŸå› </h2><p>å¦‚æœ Appï¼Œå¼€å§‹æœ‰å¤§é‡æ—¥æ´»ç”¨æˆ·å¹¶ä¸”å´©æºƒç‡å¾ˆä½ï¼Œä½†æ˜¯è¿‡æ®µæ—¶é—´ï¼Œæ€»ä¼šå‡ºç°å´©æºƒé—®é¢˜ï¼Œæ£€æŸ¥ Fabric ä¹Ÿæ²¡å•¥ç”¨ã€‚</p><p>å‡ºç°è¿™ç§æƒ…å†µå¾ˆå¯èƒ½æ˜¯å› ä¸ºï¼Œå†…å­˜ä¸è¶³ï¼Œå¯¼è‡´åº”ç”¨è¢«ç³»ç»Ÿç»ˆæ­¢ã€‚</p><p>å¯¼è‡´å†…å­˜ä¸è¶³çš„åŸå› ï¼š</p><ul><li>å¾ªç¯å¼•ç”¨;</li><li>ç«äº‰æ¡ä»¶;</li><li>åºŸå¼ƒçš„çº¿ç¨‹;</li><li>æ­»é”;</li><li>å¸ƒå±€åé¦ˆå¾ªç¯ã€‚</li></ul><p>Apple æä¾›äº†å¾ˆå¤šæ–¹æ³•æ¥è§£å†³è¿™ç±»é—®é¢˜ï¼š</p><ul><li>Instruments é‡Œçš„ Allocations å’Œ Leaks å·¥å…·ç”¨äºè§£å†³å¾ªç¯å¼•ç”¨å’Œ <a href="https://developer.apple.com/videos/play/wwdc2015/230/" target="_blank" rel="noopener">å…¶ä»–ç±»å‹çš„æ³„æ¼</a></li><li>åœ¨ Xcode 8 ä¸­å¼•å…¥çš„ <a href="https://developer.apple.com/videos/play/wwdc2016/410/" target="_blank" rel="noopener">Memory Debugger</a> ä»£æ›¿äº† Allocations å’Œ Leaks çš„ä¸€éƒ¨åˆ†åŠŸèƒ½</li><li><a href="https://developer.apple.com/videos/play/wwdc2016/412/" target="_blank" rel="noopener">Thread Sanitizer</a> å¸®åŠ©ä½ æ‰¾åˆ°ç«äº‰æ¡ä»¶ã€åºŸå¼ƒçš„çº¿ç¨‹æˆ–è€…æ­»é”</li></ul><h2 id="å¸ƒå±€åé¦ˆå¾ªç¯"><a class="markdownIt-Anchor" href="#å¸ƒå±€åé¦ˆå¾ªç¯"></a> å¸ƒå±€åé¦ˆå¾ªç¯</h2><blockquote><p>å½“è§†å›¾æ­£åœ¨è¿è¡Œå®ƒä»¬çš„å¸ƒå±€ä»£ç ï¼Œä½†æŸç§æ–¹æ³•å¯¼è‡´å®ƒä»¬å†ä¸€æ¬¡å¼€å§‹å¸ƒå±€ä¼ é€’ï¼Œæ­¤æ—¶å¸ƒå±€åé¦ˆå¾ªç¯å°±ä¼šå‡ºç°ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæŸä¸ªè§†å›¾æ­£åœ¨æ”¹å˜æŸä¸ªçˆ¶è§†å›¾çš„å¤§å°ï¼Œæˆ–è€…å› ä¸ºä½ æœ‰ä¸€ä¸ªæ¨¡æ£±ä¸¤å¯çš„å¸ƒå±€ã€‚æ— è®ºå“ªç§åŸå› ï¼Œè¿™ä¸ªé—®é¢˜çš„è¡¨ç°æ˜¯ä½ çš„ CPU ä½¿ç”¨è¢«å æ»¡å’Œ RAM ä½¿ç”¨é‡ç¨³æ­¥ä¸Šå‡ï¼Œå› ä¸ºä½ çš„è§†å›¾æ­£åœ¨ä¸€æ¬¡åˆä¸€æ¬¡åœ°è¿è¡Œå®ƒä»¬çš„å¸ƒå±€ä»£ç ï¼Œå´æ²¡æœ‰è¿”å›ã€‚<br>-æ¥è‡ª<a href="https://www.hackingwithswift.com/articles/59/debugging-auto-layout-feedback-loops" target="_blank" rel="noopener">HackingWithSwift çš„ Paul Hudson</a></p></blockquote><p>åœ¨ WWDC 16 ä¸­ Apple ä»‹ç»äº†â€œå¸ƒå±€åé¦ˆå¾ªç¯è°ƒè¯•å™¨â€ã€‚è¿™ä¸ªè°ƒè¯•å™¨æœ‰åŠ©äºè¯†åˆ«åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å‘ç”Ÿå¾ªç¯çš„æ—¶é—´ç‚¹ã€‚è¿™å°±æ˜¯ä¸€ä¸ªç¬¦å·æ–­ç‚¹ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼éå¸¸ç®€å•ï¼šå®ƒä¼šè®¡ç®—åœ¨å•ä¸ª run loop è¿­ä»£ä¸­è°ƒç”¨æ¯ä¸ªè§†å›¾ä¸Šçš„ <font color="red">layoutSubviews()</font> æ–¹æ³•çš„æ¬¡æ•°ã€‚ä¸€æ—¦è¿™ä¸ªè®¡æ•°å€¼è¶…è¿‡æŸä¸ªä¸´ç•Œå€¼ï¼ˆæ¯”å¦‚ï¼Œ100ï¼‰ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºå°†ä¼šåœåœ¨è¿™ä¸ªæ–­ç‚¹å¹¶æ‰“å°å‡ºæ—¥å¿—ã€‚<a href="https://www.hackingwithswift.com/articles/59/debugging-auto-layout-feedback-loops" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> å¿«é€Ÿåœ°ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™ä¸ªè°ƒè¯•å™¨ã€‚</p><p>è¿™ä¸ªæ–¹æ³•åœ¨å¯ä»¥é‡ç°é—®é¢˜çš„æƒ…å†µä¸‹ååˆ†æœ‰æ•ˆã€‚ä½†æ˜¯åœ¨çº¿ä¸Šå‡ºç°å°±ä¸ç”¨å®¹æ˜“è°ƒè¯•ã€‚ä½†æ˜¯ä½ å¯ä»¥å°è¯•æŠŠ <font color="red">UIViewLayoutFeedbackLoopDebuggingThreshold</font> çš„ä»£ç å¤åˆ¶åˆ°ç”Ÿäº§ä»£ç ä¸­ã€‚</p><h3 id="å¦‚ä½•ç”¨ä»£ç å®ç°-uiviewlayoutfeedbackloopdebuggingthreshold-çš„åŠŸèƒ½å‘¢"><a class="markdownIt-Anchor" href="#å¦‚ä½•ç”¨ä»£ç å®ç°-uiviewlayoutfeedbackloopdebuggingthreshold-çš„åŠŸèƒ½å‘¢"></a> å¦‚ä½•ç”¨ä»£ç å®ç° UIViewLayoutFeedbackLoopDebuggingThreshold çš„åŠŸèƒ½å‘¢</h3><p>ç¬¦å·æ–­ç‚¹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼šå®ƒä¼šè®¡ç®— layoutSubviews() çš„è°ƒç”¨æ¬¡æ•°å¹¶åœ¨å•ä¸ª run loop è¿­ä»£ä¸­è¶…è¿‡æŸä¸ªä¸´ç•Œå€¼æ—¶å‘é€ä¸€ä¸ªäº‹ä»¶ã€‚å¬èµ·æ¥å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿ</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrackableView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> counter: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.layoutSubviews()</span><br><span class="line">    counter += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (counter == <span class="number">100</span>) &#123;</span><br><span class="line">      <span class="type">YourAnalyticsFramework</span>.event(name: <span class="string">"loop"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å¯¹äºä¸€ä¸ªè§†å›¾ï¼Œè¿™æ®µä»£ç è¿è¡Œæ­£å¸¸ã€‚</li><li>ä½†æ˜¯ç°åœ¨ä½ æƒ³è¦åœ¨å¦ä¸€ä¸ªè§†å›¾ä¸Šå®ç°å®ƒã€‚å½“ç„¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª UIView çš„å­ç±»ï¼Œåœ¨è¿™é‡Œå®ç°å®ƒå¹¶ä½¿ä½ é¡¹ç›®ä¸­çš„æ‰€æœ‰è§†å›¾éƒ½ç»§æ‰¿è¿™ä¸ªå­ç±»ã€‚</li><li>ç„¶åä¸º UITableViewï¼ŒUIScrollViewï¼ŒUIStackView ç­‰åšåŒæ ·çš„äº‹æƒ…ã€‚</li></ol><p>å¦‚æœå°†æ­¤é€»è¾‘æ³¨å…¥ä½ æƒ³è¦çš„ä»»ä½•ç±»ï¼Œè€Œæ— éœ€ç¼–å†™å¤§é‡é‡å¤çš„ä»£ç ã€‚è¿™æ—¶å€™å°±å¯ä»¥ <code>å€ŸåŠ©è¿è¡Œæ—¶ç¼–ç¨‹</code> äº†ã€‚</p><h3 id="ä½¿ç”¨-runtime-å®ç°å­ç±»"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-runtime-å®ç°å­ç±»"></a> ä½¿ç”¨ runtime å®ç°å­ç±»</h3><p>æˆ‘ä»¬ä¼šåšåŒæ ·çš„äº‹æƒ…â€”â€”åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œé‡å†™ layoutSubviews() æ–¹æ³•å¹¶è®¡ç®—å…¶è°ƒç”¨æ¬¡æ•°ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯æ‰€æœ‰è¿™äº›éƒ½ä½¿ç”¨ runtime å®Œæˆï¼Œè€Œä¸æ˜¯åœ¨é¡¹ç›®ä¸­åˆ›å»ºé‡å¤çš„ç±»ã€‚</p><p><strong>åˆ›å»ºè‡ªå®šä¹‰å­ç±»</strong>ï¼Œå¹¶å°†åŸå§‹è§†å›¾çš„ç±»æ›´æ”¹ä¸ºæ–°çš„å­ç±»ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LayoutLoopHunter</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">RuntimeConstants</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> <span class="type">Prefix</span> = â€œruntimeâ€</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span><span class="params">(<span class="keyword">for</span> view: UIView, threshold: Int = <span class="number">100</span>, onLoop: @escaping <span class="params">()</span></span></span> -&gt; ()) &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬æ ¹æ®åŠŸèƒ½çš„å‰ç¼€å’ŒåŸå§‹ç±»åä¸ºæ–°ç±»åˆ›å»ºåç§°ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> classFullName = â€œ\(<span class="type">RuntimeConstants</span>.<span class="type">Prefix</span>)<span class="number">_</span>\(<span class="type">String</span>(describing: view.<span class="keyword">self</span>))â€</span><br><span class="line">    <span class="keyword">let</span> originalClass = type(of: view)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> trackableClass = objc_allocateClassPair(originalClass, classFullName, <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// åœ¨å½“å‰è¿è¡Œæ—¶ä¼šè¯æœŸé—´å°šæœªåˆ›å»ºæ­¤ç±»ã€‚</span></span><br><span class="line">      <span class="comment">// æ³¨å†Œè¿™ä¸ªç±»ï¼Œå¹¶ä¸”ç”¨åŸå§‹è§†å›¾çš„ç±»æ¥å’Œå®ƒäº¤æ¢ã€‚</span></span><br><span class="line">      objc_registerClassPair(trackableClass)</span><br><span class="line">      object_setClass(view, trackableClass)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> trackableClass = <span class="type">NSClassFromString</span>(classFullName) &#123;</span><br><span class="line">      <span class="comment">// æˆ‘ä»¬ä¹‹å‰åœ¨æ­¤è¿è¡Œæ—¶ä¼šè¯ä¸­åˆ†é…äº†ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ç±»ã€‚</span></span><br><span class="line">      <span class="comment">// æˆ‘ä»¬å¯ä»¥ä»åŸå§‹å­—ç¬¦ä¸²ä¸­è·å–å®ƒï¼Œå¹¶ä»¥ç›¸åŒçš„æ–¹å¼ä¸æˆ‘ä»¬çš„è§†å›¾äº¤æ¢ã€‚</span></span><br><span class="line">      object_setClass(view, trackableClass)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>objc_allocateClassPair() æ–¹æ³•çš„æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªæ–¹æ³•ä½•æ—¶å¤±è´¥ï¼š</li></ol><blockquote><p>æ–°ç±»ï¼Œæˆ–è€…å¦‚æœæ— æ³•åˆ›å»ºç±»ï¼Œåˆ™ä¸º Nil ï¼ˆä¾‹å¦‚ï¼Œæ‰€éœ€åç§°å·²è¢«ä½¿ç”¨ï¼‰ã€‚</p></blockquote><p>è¿™å°±æ„å‘³ç€ä¸èƒ½æ‹¥æœ‰ä¸¤ä¸ªåŒåçš„ç±»ã€‚æˆ‘ä»¬çš„ç­–ç•¥æ˜¯ä¸ºå•ä¸ªè§†å›¾ç±»åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¿è¡Œæ—¶ç±»ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨åŸå§‹ç±»åå‰åŠ ä¸Šå‰ç¼€æ¥å½¢æˆæ–°ç±»çš„åç§°çš„åŸå› ã€‚</p><ol start="2"><li>ç°åœ¨æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨åˆ°å­ç±»ä¸­ã€‚ç†è®ºä¸Šï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</li><li>æ·»åŠ ä¸€ä¸ªä¿å­˜è®¡æ•°å™¨çš„å±æ€§ã€‚</li><li>ä¸ºè¿™ä¸ªç±»åˆ›å»ºä¸€ä¸ªå…³è”å¯¹è±¡ï¼ˆAssociated objectï¼‰ã€‚</li></ol><p>ä½†æ˜¯ç›®å‰ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•å¥æ•ˆã€‚ä½ å¯ä»¥æƒ³è±¡å±æ€§æ˜¯å­˜å‚¨åœ¨åˆ†é…ç»™ç±»çš„å†…å­˜é‡Œçš„ä¸œè¥¿ï¼Œç„¶è€Œå…³è”å¯¹è±¡åˆ™å‚¨å­˜åœ¨ä¸€ä¸ªå®Œå…¨ä¸åŒçš„åœ°æ–¹ã€‚å› ä¸ºåˆ†é…ç»™å·²å­˜åœ¨å¯¹è±¡çš„å†…å­˜æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬<font color="red">åœ¨è‡ªå®šä¹‰ç±»ä¸Šæ–°æ·»åŠ çš„å±æ€§å°†ä¼šä»å…¶ä»–èµ„æºé‡Œâ€œçªƒå–â€å†…å­˜</font>ã€‚å®ƒå¯èƒ½å¯¼è‡´æ„æ–™ä¹‹å¤–çš„è¡Œä¸ºå’Œéš¾ä»¥è°ƒè¯•çš„ç¨‹åºå´©æºƒï¼ˆç‚¹å‡» <a href="https://stackoverflow.com/questions/3346427/object-setclass-to-bigger-class" target="_blank" rel="noopener">è¿™é‡Œ</a> æŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼‰ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨å…³è”å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬å°†ä¼šå­˜å‚¨åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ä¸€ä¸ªå“ˆå¸Œè¡¨é‡Œï¼Œè¿™æ˜¯å®Œå…¨å®‰å…¨çš„ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">var</span> <span class="type">CounterKey</span> = <span class="string">"_counter"</span></span><br><span class="line">...</span><br><span class="line">objc_setAssociatedObject(trackableClass, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, <span class="number">0</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br></pre></td></tr></table></figure><p>å½“æ–°çš„å­ç±»è¢«åˆ›å»ºæ—¶ï¼Œè®¡æ•°å™¨åˆå€¼è®¾ç½®ä¸º 0ã€‚</p><p><strong>å®ç°è¿™ä¸ªæ–°çš„layoutSubviews() æ–¹æ³•ï¼Œå¹¶å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„ç±»ä¸­</strong>ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> layoutSubviews: <span class="meta">@convention</span>(block) (<span class="type">Any?</span>) -&gt; () = &#123; nullableSelf <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> _self = nullableSelf <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> counter = objc_getAssociatedObject(_self, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>) <span class="keyword">as</span>? <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> counter == threshold &#123;</span><br><span class="line">      onLoop()</span><br><span class="line">    &#125;</span><br><span class="line">    objc_setAssociatedObject(trackableClass, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, counter+<span class="number">1</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> implementation = imp_implementationWithBlock(layoutSubviews)</span><br><span class="line">class_addMethod(trackableClass, #selector(originalClass.layoutSubviews), implementation, <span class="string">"v@:"</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ç†è§£ä¸Šé¢è¿™æ®µä»£ç å®é™…ä¸Šåœ¨å¹²ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ¥è‡ª &lt;objc/runtime.h&gt; çš„ç»“æ„ä½“ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> </span>&#123;</span><br><span class="line">  <span class="type">SEL</span> method_name;</span><br><span class="line">  char *method_types;</span><br><span class="line">  <span class="type">IMP</span> method_imp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•å®é™…ä¸Šæ˜¯ç”±ä»€ä¹ˆç»„æˆçš„ï¼š</p><ul><li>æ–¹æ³•çš„å®ç° method_impï¼Œè¿™æ˜¯è°ƒç”¨æ–¹æ³•æ—¶è¦æ‰§è¡Œçš„å®é™…å‡½æ•°ã€‚å®ƒçš„å‰ä¸¤ä¸ªå½¢å‚æ€»æ˜¯æ–¹æ³•æ¥æ”¶è€…å’Œæ¶ˆæ¯é€‰æ‹©å™¨ã€‚</li><li>åŒ…å«æ–¹æ³•ç­¾åçš„æ–¹æ³•ç±»å‹å­—ç¬¦ä¸² method_typesã€‚ä½ å¯ä»¥åœ¨ <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="noopener">è¿™é‡Œ</a> è¯¦ç»†äº†è§£å…¶æ ¼å¼ã€‚ä½†æ˜¯åœ¨ç°åœ¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ˜ç¡®è¯´æ˜çš„å­—ç¬¦ä¸²æ˜¯ â€œv@:â€ã€‚ä½œä¸ºè¿”å›ç±»å‹ï¼Œv ä»£è¡¨ voidï¼Œè€Œ @ å’Œ : åˆ†åˆ«ä»£è¡¨æ¥æ”¶è€…å’Œæ¶ˆæ¯é€‰æ‹©å™¨ã€‚</li><li>é€‰æ‹©å™¨ method_name ä½œä¸ºé”®ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶æŸ¥æ‰¾æ–¹æ³•çš„å®ç°ã€‚</li></ul><p>ä½ å¯ä»¥æŠŠ Witness Tableï¼ˆåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå®ƒä¹Ÿè¢«ç§°ä½œæ–¹æ³•æ´¾å‘è¡¨ï¼‰æƒ³è±¡æˆä¸€ä¸ªç®€å•çš„å­—å…¸æ•°æ®ç»“æ„ã€‚é‚£ä¹ˆé€‰æ‹©å™¨ä¸ºé”®ï¼Œä¸”å®ç°éƒ¨åˆ†åˆ™ä¸ºå¯¹åº”çš„å€¼ã€‚<br>åœ¨ä¸‹é¢è¿™è¡Œä»£ç ä¸­:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class_addMethod(trackableClass,#selector(originalClass.layoutSubviews), implementation, <span class="string">"v@:"</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰€åšçš„æ˜¯ç»™ layoutSubviews() æ–¹æ³•å¯¹åº”çš„é”®åˆ†é…æ–°å€¼ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ç›´æˆªäº†å½“ã€‚æˆ‘ä»¬è·å¾—è¿™ä¸ªè®¡æ•°å™¨ï¼Œä½¿å®ƒçš„è®¡æ•°å€¼åŠ ä¸€ã€‚å¦‚æœè®¡æ•°å€¼è¶…è¿‡ä¸´ç•Œå€¼ï¼Œæˆ‘ä»¬ä¼šå‘é€åˆ†æäº‹ä»¶ï¼Œå…¶ä¸­åŒ…å«ç±»åå’Œæƒ³è¦çš„ä»»ä½•æ•°æ®ä½“ã€‚</p><p>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹å¦‚ä½•å¯¹å…³è”å¯¹è±¡å®ç°å’Œä½¿ç”¨é”®ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">var</span> <span class="type">CounterKey</span> = â€œ_counterâ€</span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line">objc_setAssociatedObject(trackableClass, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, counter+<span class="number">1</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨ var æ¥ä¿®é¥°è®¡æ•°å™¨çš„é”®è¿™ä¸ªé™æ€å±æ€§å¹¶åœ¨ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹æ—¶ä½¿ç”¨å¼•ç”¨ï¼Ÿç­”æ¡ˆéšè—åœ¨ Swift è¯­è¨€åŸºç¡€â€”â€”å­—ç¬¦ä¸²ä¹‹ä¸­ã€‚å­—ç¬¦ä¸²åƒå…¶ä»–æ‰€æœ‰çš„å€¼ç±»å‹ä¸€æ ·ï¼Œæ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚é‚£ä¹ˆï¼Œå½“ä½ æŠŠå®ƒä¼ å…¥è¿™ä¸ªé—­åŒ…æ—¶ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°†ä¼šè¢«å¤åˆ¶åˆ°ä¸€ä¸ªä¸åŒçš„åœ°å€ï¼Œè¿™ä¼šå¯¼è‡´åœ¨å…³è”å¯¹è±¡è¡¨ä¸­äº§ç”Ÿä¸€ä¸ªå®Œå…¨ä¸åŒçš„é”®ã€‚&amp; ç¬¦å·æ€»æ˜¯ä¿è¯å°†ç›¸åŒçš„åœ°å€ä½œä¸ºé”®å‚æ•°çš„å€¼ã€‚ä½ å¯ä»¥å°è¯•ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printAddress</span><span class="params">(<span class="number">_</span> string: UnsafeRawPointer)</span></span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"\(string)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">"test"</span></span><br><span class="line"></span><br><span class="line">printAddress(str)</span><br><span class="line">printAddress(str)</span><br><span class="line"><span class="keyword">let</span> closure = &#123;</span><br><span class="line">  printAddress(str)</span><br><span class="line">  printAddress(str)</span><br><span class="line">&#125;</span><br><span class="line">closure()</span><br><span class="line"><span class="comment">// æœ€åä¸¤ä¸ªå‡½æ•°è°ƒç”¨çš„åœ°å€å°†å§‹ç»ˆä¸åŒ</span></span><br></pre></td></tr></table></figure><p>ç”¨å¼•ç”¨çš„æ–¹å¼æ¥ä¼ é€’é”®çš„ä¸»æ„æ€»æ˜¯å¥½çš„ï¼Œå› ä¸ºæœ‰æ—¶ï¼Œå³ä½¿ä½ æ²¡æœ‰ä½¿ç”¨é—­åŒ…ï¼Œå˜é‡çš„åœ°å€ä»å¯èƒ½å› å†…å­˜ç®¡ç†è€Œæ›´æ”¹ã€‚åœ¨æˆ‘ä»¬ä¾‹å­ä¸­ï¼Œå¦‚æœä½ æŠŠä¸Šé¢çš„ä»£ç è¿è¡Œå¤šæ¬¡ï¼Œå³ä½¿æ˜¯å‰ä¸¤ä¸ª printAddress() çš„è°ƒç”¨ä¹Ÿå¯èƒ½ä¼šè¾“å‡ºä¸åŒçš„åœ°å€ã€‚</p><p>è®©æˆ‘ä»¬å›åˆ°è¿è¡Œæ—¶çš„é­”æ³•é‡Œæ¥ã€‚åœ¨æ–° layoutSubviews() çš„å®ç°é‡Œï¼Œè¿˜æœ‰ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…æ²¡æœ‰å®Œæˆã€‚è¿™ä»¶äº‹æ˜¯æ¯æ¬¡é‡å†™çˆ¶ç±»çš„æ–¹æ³•æ—¶é€šå¸¸éƒ½ä¼šåšçš„äº‹æƒ…â€”â€”è°ƒç”¨çˆ¶ç±»å®ç°ã€‚layoutSubviews() çš„æ–‡æ¡£é‡Œæåˆ°ï¼š</p><blockquote><p>åœ¨ iOS 5.1 åŠæ›´æ—©ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚è€Œä¹‹åçš„é»˜è®¤å®ç°ä¼šä½¿ç”¨ä½ è®¾ç½®çš„ä»»ä½•çº¦æŸæ¥ç¡®å®šä»»ä½•å­è§†å›¾çš„å¤§å°å’Œä½ç½®ã€‚</p></blockquote><p>ä¸ºäº†é¿å…å‘ç”Ÿä¸€äº›éš¾ä»¥é¢„æ–™çš„å¸ƒå±€è¡Œä¸ºï¼Œæˆ‘ä»¬å¾—è°ƒç”¨çˆ¶ç±»çš„å®ç°ï¼Œä½†è¿™ä¸åƒå¹³å¸¸é‚£æ ·ç®€å•æ˜äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> selector = #selector(originalClass.layoutSubviews)</span><br><span class="line"><span class="keyword">let</span> originalImpl = class_getMethodImplementation(originalClass, selector)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">// @convention(c) å‘ŠçŸ¥ Swift è¿™æ˜¯ä¸€ä¸ªè£¸å‡½æ•°æŒ‡é’ˆï¼ˆæ²¡æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="comment">// æ‰€æœ‰çš„ Obj-C æ–¹æ³•å‡½æ•°æŠŠæ¥æ”¶è€…å’Œæ¶ˆæ¯å½“ä½œå‰ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥è¿™æ„å‘³ç€ä¸€ä¸ªç±»å‹ä¸º `() -&gt; Void` çš„æ–¹æ³•ï¼Œè¿™ä¸ `layoutSubview` æ–¹æ³•ç›¸ç¬¦</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">ObjCVoidVoidFn</span> = <span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Any</span>, <span class="type">Selector</span>) -&gt; <span class="type">Void</span></span><br><span class="line"><span class="keyword">let</span> originalLayoutSubviews = <span class="built_in">unsafeBitCast</span>(originalImpl, to: <span class="type">ObjCVoidVoidFn</span>.<span class="keyword">self</span>)</span><br><span class="line">originalLayoutSubviews(view, selector)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®é™…å‘ç”Ÿçš„æ˜¯ï¼šæˆ‘ä»¬æ£€ç´¢æ–¹æ³•æ‰€éœ€çš„å®ç°éƒ¨åˆ†ï¼Œå¹¶ç›´æ¥ä»ä»£ç ä¸­è°ƒç”¨å®ƒï¼Œè€Œä¸æ˜¯ç”¨å¸¸è§çš„æ–¹å¼æ¥è°ƒç”¨æ–¹æ³•ï¼ˆå³æ‰§è¡Œä¸€ä¸ªä¼šåœ¨ Witness Table ä¸­å¯»æ‰¾å¯¹åº”å®ç°çš„é€‰æ‹©å™¨ï¼‰ã€‚</p><p>ç›®å‰ä¸ºæ­¢ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ç°éƒ¨åˆ†ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span><span class="params">(<span class="keyword">for</span> view: UIView, threshold: Int = <span class="number">100</span>, onLoop: @escaping <span class="params">()</span></span></span> -&gt; ()) &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬æ ¹æ®åŠŸèƒ½çš„å‰ç¼€å’ŒåŸå§‹ç±»åä¸ºæ–°ç±»åˆ›å»ºåç§°</span></span><br><span class="line">  <span class="keyword">let</span> classFullName = â€œ\(<span class="type">RuntimeConstants</span>.<span class="type">Prefix</span>)<span class="number">_</span>\(<span class="type">String</span>(describing: view.<span class="keyword">self</span>))â€</span><br><span class="line">  <span class="keyword">let</span> originalClass = type(of: view)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> trackableClass = objc_allocateClassPair(originalClass, classFullName, <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// åœ¨å½“å‰è¿è¡Œæ—¶ä¼šè¯æœŸé—´å°šæœªåˆ›å»ºæ­¤ç±»</span></span><br><span class="line">    <span class="comment">// æ³¨å†Œè¿™ä¸ªç±»å¹¶å°†å…¶ä¸åŸå§‹è§†å›¾çš„ç±»äº¤æ¢</span></span><br><span class="line">    objc_registerClassPair(trackableClass)</span><br><span class="line">    object_setClass(view, trackableClass)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç°åœ¨å¯ä»¥åˆ›å»ºå…³è”å¯¹è±¡</span></span><br><span class="line">    objc_setAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, <span class="number">0</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ æˆ‘ä»¬è‡ªå·± layoutSubviews çš„å®ç°</span></span><br><span class="line">    <span class="keyword">let</span> layoutSubviews: <span class="meta">@convention</span>(block) (<span class="type">Any?</span>) -&gt; () = &#123; nullableSelf <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> _self = nullableSelf <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> selector = #selector(originalClass.layoutSubviews)</span><br><span class="line">      <span class="keyword">let</span> originalImpl = class_getMethodImplementation(originalClass, selector)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// @convention(c) å‘ŠçŸ¥ Swift è¿™æ˜¯ä¸€ä¸ªè£¸å‡½æ•°æŒ‡é’ˆï¼ˆæ²¡æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼‰</span></span><br><span class="line">      <span class="comment">// æ‰€æœ‰çš„ Obj-C æ–¹æ³•å‡½æ•°æŠŠæ¥æ”¶è€…å’Œæ¶ˆæ¯å½“ä½œå‰ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥è¿™æ„å‘³ç€ä¸€ä¸ªç±»å‹ä¸º `() -&gt; Void` çš„æ–¹æ³•ï¼Œè¿™ä¸ `layoutSubview` æ–¹æ³•ç›¸ç¬¦</span></span><br><span class="line">      <span class="keyword">typealias</span> <span class="type">ObjCVoidVoidFn</span> = <span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Any</span>, <span class="type">Selector</span>) -&gt; <span class="type">Void</span></span><br><span class="line">      <span class="keyword">let</span> originalLayoutSubviews = <span class="built_in">unsafeBitCast</span>(originalImpl, to: <span class="type">ObjCVoidVoidFn</span>.<span class="keyword">self</span>)</span><br><span class="line">      originalLayoutSubviews(view, selector)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> counter = objc_getAssociatedObject(_self, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>) <span class="keyword">as</span>? <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> counter == threshold &#123;</span><br><span class="line">          onLoop()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        objc_setAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, counter+<span class="number">1</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> implementation = imp_implementationWithBlock(layoutSubviews)</span><br><span class="line">    class_addMethod(trackableClass, #selector(originalClass.layoutSubviews), implementation, â€œv@:â€œ)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> trackableClass = <span class="type">NSClassFromString</span>(classFullName) &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬ä¹‹å‰åœ¨æ­¤è¿è¡Œæ—¶ä¼šè¯ä¸­åˆ†é…äº†ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ç±»</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯ä»¥ä»åŸå§‹å­—ç¬¦ä¸²ä¸­è·å–å®ƒï¼Œå¹¶ä»¥ç›¸åŒçš„æ–¹å¼ä¸æˆ‘ä»¬çš„è§†å›¾äº¤æ¢</span></span><br><span class="line">    object_setClass(view, trackableClass)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬ä¸ºè§†å›¾åˆ›å»ºæ¨¡æ‹Ÿå¸ƒå±€å¾ªç¯ï¼Œå¹¶ä¸ºå…¶è®¾ç½®è®¡æ•°å™¨æ¥è¿›è¡Œæµ‹è¯•ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"> </span><br><span class="line">    <span class="type">LayoutLoopHunter</span>.setUp(<span class="keyword">for</span>: view) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"Hello, world"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line">    view.setNeedsLayout() <span class="comment">// loop creation</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å¿˜è®°äº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿè®©æˆ‘ä»¬å†æ¬¡å›é¡¾ä¸€ä¸‹ UIViewLayoutFeedbackLoopDebuggingThreshold æ–­ç‚¹çš„å·¥ä½œåŸç†ï¼š</p><blockquote><p>åœ¨ç¡®è®¤ä¸ºåé¦ˆå¾ªç¯ä¹‹å‰ï¼Œå®šä¹‰æŸä¸ªè§†å›¾çš„å­è§†å›¾åœ¨å•ä¸ª run loop é‡Œå¿…é¡»å¸ƒå±€çš„æ¬¡æ•°</p></blockquote><p>æˆ‘ä»¬ä»æœªæŠŠâ€œå•ä¸ª run loop â€è¿™ä¸€æ¡ä»¶è€ƒè™‘è¿›æ¥ã€‚å¦‚æœè§†å›¾åœ¨å±å¹•ä¸Šåœç•™äº†ç›¸å½“é•¿çš„æ—¶é—´ï¼Œå¹¶ç»å¸¸è¢«åå¤å¸ƒå±€ï¼Œè®¡æ•°å™¨è¿Ÿæ—©ä¼šè¶…è¿‡ä¸´ç•Œå€¼ã€‚ä½†è¿™å¯ä¸æ˜¯å› ä¸ºå†…å­˜çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿåªéœ€åœ¨æ¯æ¬¡ run loop è¿­ä»£æ—¶é‡ç½®è®¡æ•°å™¨ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª <a href="https://www.appcoda.com/grand-central-dispatch/" target="_blank" rel="noopener">DispatchWorkItem</a>ï¼Œå®ƒé‡ç½®è®¡æ•°å™¨ï¼Œå¹¶åœ¨ä¸»é˜Ÿåˆ—ä¸Šå¼‚æ­¥ä¼ é€’å®ƒã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå®ƒä¼šåœ¨ run loop ä¸‹ä¸€æ¬¡è¿›å…¥ä¸»çº¿ç¨‹æ—¶è¢«è°ƒç”¨ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">var</span> <span class="type">ResetWorkItemKey</span> = â€œ_resetWorkItemâ€</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> previousResetWorkItem = objc_getAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">ResetWorkItemKey</span>) <span class="keyword">as</span>? <span class="type">DispatchWorkItem</span> &#123;</span><br><span class="line">  previousResetWorkItem.cancel()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> currentResetWorkItem = <span class="type">DispatchWorkItem</span> &#123; [<span class="keyword">weak</span> view] <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> strongView = view <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  objc_setAssociatedObject(strongView, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, <span class="number">0</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">DispatchQueue</span>.main.async(execute: currentResetWorkItem)</span><br><span class="line">objc_setAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">ResetWorkItemKey</span>, currentResetWorkItem, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LayoutLoopHunter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">RuntimeConstants</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> <span class="type">Prefix</span> = â€œruntimeâ€</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Associated objects keys</span></span><br><span class="line">    <span class="comment">// å…³è”å¯¹è±¡é”®</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">CounterKey</span> = â€œ_counterâ€</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">ResetWorkItemKey</span> = â€œ_resetWorkItemâ€</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span><span class="params">(<span class="keyword">for</span> view: UIView, threshold: Int = <span class="number">100</span>, onLoop: @escaping <span class="params">()</span></span></span> -&gt; ()) &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬æ ¹æ®åŠŸèƒ½çš„å‰ç¼€å’ŒåŸå§‹ç±»åä¸ºæ–°ç±»åˆ›å»ºåç§°ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> classFullName = â€œ\(<span class="type">RuntimeConstants</span>.<span class="type">Prefix</span>)<span class="number">_</span>\(<span class="type">String</span>(describing: view.<span class="keyword">self</span>))â€</span><br><span class="line">    <span class="keyword">let</span> originalClass = type(of: view)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> trackableClass = objc_allocateClassPair(originalClass, classFullName, <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// åœ¨å½“å‰è¿è¡Œæ—¶ä¼šè¯æœŸé—´å°šæœªåˆ›å»ºæ­¤ç±»ã€‚</span></span><br><span class="line">      <span class="comment">// æ³¨å†Œè¿™ä¸ªç±»ï¼Œå¹¶ä¸”ç”¨åŸå§‹è§†å›¾çš„ç±»æ¥å’Œå®ƒäº¤æ¢ã€‚</span></span><br><span class="line">      objc_registerClassPair(trackableClass)</span><br><span class="line">      object_setClass(view, trackableClass)</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// ç°åœ¨å¯ä»¥åˆ›å»ºå…³è”å¯¹è±¡</span></span><br><span class="line">      objc_setAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, <span class="number">0</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// æ·»åŠ æˆ‘ä»¬è‡ªå·± layoutSubviews çš„å®ç°</span></span><br><span class="line">      <span class="keyword">let</span> layoutSubviews: <span class="meta">@convention</span>(block) (<span class="type">Any?</span>) -&gt; () = &#123; nullableSelf <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> _self = nullableSelf <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">let</span> selector = #selector(originalClass.layoutSubviews)</span><br><span class="line">        <span class="keyword">let</span> originalImpl = class_getMethodImplementation(originalClass, selector)</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// @convention(c) å‘ŠçŸ¥ Swift è¿™æ˜¯ä¸€ä¸ªè£¸å‡½æ•°æŒ‡é’ˆï¼ˆæ²¡æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼‰</span></span><br><span class="line">        <span class="comment">// æ‰€æœ‰çš„ Obj-C æ–¹æ³•å‡½æ•°æŠŠæ¥æ”¶è€…å’Œæ¶ˆæ¯å½“ä½œå‰ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥è¿™æ„å‘³ç€ä¸€ä¸ªç±»å‹ä¸º `() -&gt; Void` çš„æ–¹æ³•ï¼Œè¿™ä¸ `layoutSubview` æ–¹æ³•ç›¸ç¬¦</span></span><br><span class="line">        <span class="keyword">typealias</span> <span class="type">ObjCVoidVoidFn</span> = <span class="meta">@convention</span>(<span class="built_in">c</span>) (<span class="type">Any</span>, <span class="type">Selector</span>) -&gt; <span class="type">Void</span></span><br><span class="line">        <span class="keyword">let</span> originalLayoutSubviews = <span class="built_in">unsafeBitCast</span>(originalImpl, to: <span class="type">ObjCVoidVoidFn</span>.<span class="keyword">self</span>)</span><br><span class="line">        originalLayoutSubviews(view, selector)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> counter = objc_getAssociatedObject(_self, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>) <span class="keyword">as</span>? <span class="type">Int</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> counter == threshold &#123;</span><br><span class="line">            onLoop()</span><br><span class="line">          &#125;</span><br><span class="line"> </span><br><span class="line">          objc_setAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, counter+<span class="number">1</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// ä¸ºé‡ç½®è®¡æ•°å™¨ï¼Œåœ¨æ¯ä¸ªæ–°çš„ run loop éå†ä¸­åˆ†å‘ work item</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> previousResetWorkItem = objc_getAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">ResetWorkItemKey</span>) <span class="keyword">as</span>? <span class="type">DispatchWorkItem</span> &#123;</span><br><span class="line">          previousResetWorkItem.cancel()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> counterResetWorkItem = <span class="type">DispatchWorkItem</span> &#123; [<span class="keyword">weak</span> view] <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">guard</span> <span class="keyword">let</span> strongView = view <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">          objc_setAssociatedObject(strongView, &amp;<span class="type">RuntimeConstants</span>.<span class="type">CounterKey</span>, <span class="number">0</span>, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async(execute: counterResetWorkItem)</span><br><span class="line">        objc_setAssociatedObject(view, &amp;<span class="type">RuntimeConstants</span>.<span class="type">ResetWorkItemKey</span>, counterResetWorkItem, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> implementation = imp_implementationWithBlock(layoutSubviews)</span><br><span class="line">      class_addMethod(trackableClass, #selector(originalClass.layoutSubviews), implementation, â€œv@:â€œ)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> trackableClass = <span class="type">NSClassFromString</span>(classFullName) &#123;</span><br><span class="line">      <span class="comment">// æˆ‘ä»¬ä¹‹å‰åœ¨æ­¤è¿è¡Œæ—¶ä¼šè¯ä¸­åˆ†é…äº†ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ç±»ã€‚</span></span><br><span class="line">      <span class="comment">// æˆ‘ä»¬å¯ä»¥ä»åŸå§‹å­—ç¬¦ä¸²ä¸­è·å–å®ƒï¼Œå¹¶ä»¥ç›¸åŒçš„æ–¹å¼ä¸æˆ‘ä»¬çš„è§†å›¾äº¤æ¢ã€‚</span></span><br><span class="line">      object_setClass(view, trackableClass)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a class="markdownIt-Anchor" href="#ç»“è®º"></a> ç»“è®º</h2><p>æ˜¯çš„ï¼ç°åœ¨ä½ å¯ä»¥ä¸ºæ‰€æœ‰å¯ç–‘çš„è§†å›¾è®¾ç½®åˆ†æäº‹ä»¶äº†ï¼Œå‘å¸ƒåº”ç”¨ç¨‹åºï¼Œå¹¶æ‰¾åˆ°è¿™ä¸ªé—®é¢˜çš„ç¡®åˆ‡å‡ºå¤„ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜çš„èŒƒå›´ç¼©å°åˆ°æŸä¸ªç‰¹å®šçš„è§†å›¾ï¼Œå¹¶åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å€ŸåŠ©äºä»–ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æœ€åè¦æåˆ°çš„ä¸€ä»¶äº‹æ˜¯ï¼šèƒ½åŠ›è¶Šå¤§è´£ä»»è¶Šå¤§ã€‚è¿è¡Œæ—¶ç¼–ç¨‹éå¸¸å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤å¾ˆå®¹æ˜“åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä¸ºåº”ç”¨ç¨‹åºå¼•å…¥å¦ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ€»æ˜¯å»ºè®®å°†åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰å±é™©ä»£ç åŒ…è£…åœ¨æŸç§å¯åœæ­¢å¼€å…³ä¸­ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨å‘ç°ä»£ç å¯¼è‡´é—®é¢˜æ—¶ä»åç«¯è§¦å‘å¼€å…³ç¦ç”¨è¯¥åŠŸèƒ½ã€‚è¿™æœ‰ä¸€ç¯‡ä»‹ç» Firebase çš„ Feature Flags çš„ <a href="https://medium.com/@rwbutler/feature-flags-a-b-testing-mvt-on-ios-718339ac7aa1" target="_blank" rel="noopener">(å¥½æ–‡ç« </a></p><p>å®Œæ•´ä»£ç å¯ä»¥ä»è¿™ä¸ª <a href="https://github.com/rsrbk/LayoutLoopHunter" target="_blank" rel="noopener">GitHub ä»“åº“</a> é‡Œè·å–ï¼Œå¹¶ä¸”ä¹Ÿå°†ä¼šå‘å¸ƒåˆ° CocoPods ä¸Šï¼Œä»¥è·Ÿè¸ªé¡¹ç›®ä¸­çš„å¸ƒå±€å¾ªç¯ã€‚</p><blockquote><p><a href="https://swift.gg/2019/11/11/layout-feedback-loop/" target="_blank" rel="noopener">å¤§é‡å¼•ç”¨</a><br>åŸæ–‡è¯»èµ·æ¥è´¹åŠ²ï¼Œåªæ˜¯æƒ³è®©è‡ªå·±è¯»çš„å®¹æ˜“å†™çš„è¿™ç¯‡æ–‡ç« </p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="iOS Programming" scheme="https://changzw.github.io/categories/iOS-Programming/"/>
    
      <category term="objc" scheme="https://changzw.github.io/categories/iOS-Programming/objc/"/>
    
      <category term="runtime" scheme="https://changzw.github.io/categories/iOS-Programming/objc/runtime/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://changzw.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>AlamoFire åˆ†æ</title>
    <link href="https://changzw.github.io/2019/08/23/source-code/AlamoFire-%E5%88%86%E6%9E%90/"/>
    <id>https://changzw.github.io/2019/08/23/source-code/AlamoFire-%E5%88%86%E6%9E%90/</id>
    <published>2019-08-23T02:24:19.000Z</published>
    <updated>2020-05-20T03:01:51.578Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:12 GMT+0800 (CST) --><a id="more"></a><p>åˆ†ææºç ï¼š</p><ol><li>è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œä»–è®¾è®¡çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>éœ€è¦å“ªäº›åŸºç¡€çŸ¥è¯†</li><li>æ•´ä½“ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„</li><li>ç”±å¤–è€Œå†…é€å±‚åˆ†æå±‚æ¬¡ç»“æ„</li><li>æ¯ä¸ªå±‚æ¬¡ç»“æ„çš„æ„å›¾æ˜¯ä»€ä¹ˆï¼Œä¸ºäº†å®ç°è¿™ä¸ªæ„å›¾ä»–ä½¿ç”¨äº†ä»€ä¹ˆæ–¹å¼ï¼Œè¿™ä¹ˆåšæœ‰ä»€ä¹ˆä¼˜ç‚¹</li><li>ä¸ºäº†è®©ç”¨æˆ·ä½¿ç”¨æ–¹ä¾¿ï¼Œå®ç°äº†ä»€ä¹ˆæ ·çš„æ¥å£ï¼Œä¸ºäº†å®ç°è¿™æ ·çš„æ¥å£åº•å±‚åˆæ˜¯å¦‚ä½•å®è·µçš„å‘¢ï¼Ÿ</li></ol><p>ä¸ºä»€ä¹ˆè¦åˆ†æ AlamoFire</p><ul><li>åˆ†æå®ƒçš„æ¥å£è®¾è®¡</li><li>åˆ†æä»–æ˜¯å¦‚ä½•å°è£… URL Loading System çš„</li><li>åˆ†æç½‘ç»œå±‚æ¬¡æ€è€ƒæ•°æ®ä¼ è¾“è¿‡ç¨‹</li></ul><p>AlamoFire éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</p><ul><li>Chainable Request / Response Methods</li><li>URL / JSON Parameter Encoding</li><li>Upload File / Data / Stream / MultipartFormData</li><li>Download File using Request or Resume Data</li><li>Authentication with URLCredential</li><li>HTTP Response Validation</li><li>Upload and Download Progress Closures with Progress</li><li>cURL Command Output</li><li>Dynamically Adapt and Retry Requests</li><li>TLS Certificate and Public Key Pinning</li><li>Network Reachability</li></ul><h2 id="foundation-ä¸­æä¾›çš„ç½‘ç»œç›¸å…³æ¥å£"><a class="markdownIt-Anchor" href="#foundation-ä¸­æä¾›çš„ç½‘ç»œç›¸å…³æ¥å£"></a> Foundation ä¸­æä¾›çš„ç½‘ç»œç›¸å…³æ¥å£</h2><p><code>AlamoFire</code> æ˜¯ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“ï¼Œåº•å±‚å°è£…çš„äº‹ Apple æä¾›çš„ <code>URL Loading System</code></p><h3 id="åå°-sessionä¸‹è½½æµç¨‹æ³¨æ„äº‹é¡¹"><a class="markdownIt-Anchor" href="#åå°-sessionä¸‹è½½æµç¨‹æ³¨æ„äº‹é¡¹"></a> åå° sessionä¸‹è½½æµç¨‹&amp;æ³¨æ„äº‹é¡¹</h3><p>åå° sessionConfiguration ä¸‹è½½æ–‡ä»¶ä¿å­˜ åˆ°æœ¬åœ°æ²™ç›’</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯åå° è¯·æ±‚ task</span></span><br><span class="line"><span class="keyword">let</span> configuration = <span class="type">URLSessionConfiguration</span>.background(withIdentifier: <span class="string">"com.czw.backgroundDownload"</span>)</span><br><span class="line"><span class="keyword">let</span> session = <span class="type">URLSession</span>.<span class="keyword">init</span>(configuration: configuration, delegate: <span class="keyword">self</span>, delegateQueue: <span class="type">OperationQueue</span>.main)</span><br><span class="line">session.downloadTask(with: <span class="type">URL</span>(string: urlDownloadStr)!).resume()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">URLSessionDownloadDelegate</span> </span>&#123;</span><br><span class="line"><span class="comment">// ä¸‹è½½å®Œæˆåä»£ç†å›è°ƒæ–¹æ³•ï¼Œå°†æ–‡ä»¶ç§»åŠ¨åˆ°æ²™ç›’æŒ‡å®šä½ç½®</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, downloadTask: URLSessionDownloadTask, didFinishDownloadingTo location: URL)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"ä¸‹è½½å®Œæˆ - \(location)"</span>)</span><br><span class="line">    <span class="keyword">let</span> locationPath = location.path</span><br><span class="line">    <span class="keyword">let</span> documnets = <span class="type">NSHomeDirectory</span>() + <span class="string">"/Documents/xxxx"</span> + <span class="string">".zip"</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"ç§»åŠ¨åœ°å€:\(documnets)"</span>)</span><br><span class="line">    <span class="keyword">let</span> fileManager = <span class="type">FileManager</span>.<span class="keyword">default</span></span><br><span class="line">    <span class="keyword">try</span>! fileManager.moveItem(atPath: locationPath, toPath: documnets)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// http åˆ†æ®µä¼ è¾“ï¼Œä¼šä¸æ–­è°ƒç”¨è¿™ä¸ªæ–¹æ³•ç›´åˆ°ï¼Œå…¨éƒ¨ä¸‹è½½å®Œæˆ</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, downloadTask: URLSessionDownloadTask, didWriteData bytesWritten: Int64, totalBytesWritten: Int64, totalBytesExpectedToWrite: Int64)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">" bytesWritten \(bytesWritten)\n totalBytesWritten \(totalBytesWritten)\n totalBytesExpectedToWrite \(totalBytesExpectedToWrite)"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"ä¸‹è½½è¿›åº¦: \(Double(totalBytesWritten)/Double(totalBytesExpectedToWrite))\n"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå°è¯·æ±‚ï¼Œéœ€è¦ç”³è¯·åå°æƒé™ï¼Œè¿™æ · app è¿›å…¥ background çš„æ—¶å€™æ‰å¯ä»¥ç»§ç»­ä¸‹è½½</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨äºä¿å­˜åå°ä¸‹è½½çš„completionHandler</span></span><br><span class="line"><span class="keyword">var</span> backgroundSessionCompletionHandler: (() -&gt; <span class="type">Void</span>)? </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, handleEventsForBackgroundURLSession identifier: String, completionHandler: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"background: \(identifier)"</span>)</span><br><span class="line">  <span class="keyword">self</span>.backgroundSessionCompletionHandler = completionHandler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-alamofire"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-alamofire"></a> ä½¿ç”¨ AlamoFire</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Alamofire</span>.request(urlString)</span><br><span class="line">  .responseJSON &#123; (data) <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿä¸Šé¢å¯¹æ¯”[åŸç”Ÿçš„æ–¹æ³•(#code1), æ€è€ƒ <code>AlamoFire</code> éƒ½å°è£…äº†ä»€ä¹ˆï¼Œå¦‚ä½•å®ç°é“¾å¼è°ƒç”¨çš„ï¼Œå†…éƒ¨å¦‚ä½•ä½¿ç”¨ oopï¼Œpop çš„, æ€è€ƒ <code>AlamoFire</code> æ¥å£è®¾è®¡</p><p>ä¸‹é¢è¿™äº›éƒ½æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><ul><li>é“¾å¼è¯­æ³•</li><li>ç›´æ¥ä¼  string</li><li>å°è£…è°ƒç”¨ sessionï¼Œresume</li><li>Response å›è°ƒçš„è¿”å›çš„æ˜¯ json æ•°æ®</li><li><code>Alamofire</code> æ¨¡å—å¯¼å…¥è°ƒç”¨</li></ul><p>è°ƒç”¨çš„ç¬¬ä¸€å±‚ï¼š<br>Alamofire.swift</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Alamofire Model</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">request</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> url: URLConvertible,</span></span></span><br><span class="line"><span class="function"><span class="params">  method: HTTPMethod = .<span class="keyword">get</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  parameters: Parameters? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  encoding: ParameterEncoding = URLEncoding.<span class="keyword">default</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  headers: HTTPHeaders? = <span class="literal">nil</span>)</span></span></span><br><span class="line">  -&gt; <span class="type">DataRequest</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="type">SessionManager</span>.<span class="keyword">default</span>.request(</span><br><span class="line">    url,</span><br><span class="line">    method: method,</span><br><span class="line">    parameters: parameters,</span><br><span class="line">    encoding: encoding,</span><br><span class="line">    headers: headers</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SessionManager.swift</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SessionManager</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// A default instance of `SessionManager`, used by top-level Alamofire request methods, and suitable for use</span></span><br><span class="line"><span class="comment">/// directly for any ad hoc requests.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> `<span class="keyword">default</span>`: <span class="type">SessionManager</span> = &#123;</span><br><span class="line">  <span class="keyword">let</span> configuration = <span class="type">URLSessionConfiguration</span>.<span class="keyword">default</span></span><br><span class="line">  configuration.httpAdditionalHeaders = <span class="type">SessionManager</span>.defaultHTTPHeaders </span><br><span class="line">  <span class="keyword">return</span> <span class="type">SessionManager</span>(configuration: configuration)</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(</span><br><span class="line">  configuration: <span class="type">URLSessionConfiguration</span> = <span class="type">URLSessionConfiguration</span>.<span class="keyword">default</span>,</span><br><span class="line">  delegate: <span class="type">SessionDelegate</span> = <span class="type">SessionDelegate</span>(),</span><br><span class="line">  serverTrustPolicyManager: <span class="type">ServerTrustPolicyManager?</span> = <span class="literal">nil</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">self</span>.delegate = delegate</span><br><span class="line">  <span class="keyword">self</span>.session = <span class="type">URLSession</span>(configuration: configuration, delegate: delegate, delegateQueue: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">  commonInit(serverTrustPolicyManager: serverTrustPolicyManager)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>?(</span><br><span class="line">  session: <span class="type">URLSession</span>,</span><br><span class="line">  delegate: <span class="type">SessionDelegate</span>,</span><br><span class="line">  serverTrustPolicyManager: <span class="type">ServerTrustPolicyManager?</span> = <span class="literal">nil</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">guard</span> delegate === session.delegate <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">self</span>.delegate = delegate</span><br><span class="line">  <span class="keyword">self</span>.session = session</span><br><span class="line"></span><br><span class="line">  commonInit(serverTrustPolicyManager: serverTrustPolicyManager)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SessionDelegate()</code> ä»£ç†ç§»äº¤ <code>SessionDelegate</code> æ˜¯ä¸ª class, å¤„ç† <code>URLSession</code> çš„äº‹ä»¶å›è°ƒä»£ç†æ–¹æ³•ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SessionDelegate</span>: <span class="title">URLSessionDataDelegate</span> </span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SessionDelegate</span>: <span class="title">URLSessionTaskDelegate</span> </span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SessionDelegate</span>: <span class="title">URLSessionStreamDelegate</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆ Manager ä¸å¤„ç† <code>URLSession</code> çš„ä»£ç†å›è°ƒæ–¹æ³•ï¼Œè¦æä¸€ä¸ª <code>SessionDelegate</code> å¤„ç†ï¼Œå› ä¸º Manager æ˜¯ä¸€ä¸ªä¸­ä»‹è€…ï¼Œç”¨äºç®¡ç†å„ä¸ª class ä¹‹é—´çš„è”ç³»ï¼Œå¤„ç†å›è°ƒçš„é‚£äº›æ–¹æ³•åº”è¯¥å½’å±äº xxxClass æ¥å¤„ç†</p><p><img src="/img/AlamoFire-Manager.jpg" alt="AlamoFire åŸºæœ¬æ ¸å¿ƒæ¡†æ¶"></p><p>ä½¿ç”¨ Manager ä¸»è¦ä½œç”¨æ˜¯æŠŠä»£ç æ¨¡å—ä¹‹é—´çš„ é¢‘ç¹è°ƒç”¨å…³ç³»åŒ–ç®€ã€‚åˆ’åˆ†ä¸šåŠ¡å±‚ï¼Œç®¡ç†å±‚<br>Manager ç»Ÿä¸€ç®¡ç†è°ƒåº¦<br>å„ä¸ªæ¨¡å—å¤„ç†å®Œæˆåï¼Œå›è°ƒç»™ Manager</p><h3 id="å¤„ç†åå°ä¸‹è½½"><a class="markdownIt-Anchor" href="#å¤„ç†åå°ä¸‹è½½"></a> å¤„ç†åå°ä¸‹è½½</h3><h2 id="request"><a class="markdownIt-Anchor" href="#request"></a> request</h2><h3 id="ç¼–ç "><a class="markdownIt-Anchor" href="#ç¼–ç "></a> ç¼–ç </h3><p><img src="/img/requst_encode.jpeg" alt="æä¾›çš„3ç§ç¼–ç æ–¹å¼"></p><ul><li>url</li><li>json</li><li>propertyList</li></ul><p>url æ˜¯ASCIIç ç¼–ç çš„ï¼Œä»–ä¸æ˜¯ Unicodeï¼ŒASCII ç ä¸­çš„å¤–æ–‡æ— æ³•è¯†åˆ«ï¼Œæ‰€ä»¥è¦ç™¾åˆ†å·ç¼–ç â€”â€”å°† ACSII -&gt; Unicode è¿™æ ·å¯ä»¥è¢«è¯†åˆ«</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(<span class="number">_</span> urlRequest: URLRequestConvertible, with parameters: Parameters?)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">URLRequest</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> urlRequest = <span class="keyword">try</span> urlRequest.asURLRequest()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> parameters = parameters <span class="keyword">else</span> &#123; <span class="keyword">return</span> urlRequest &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// header</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> method = <span class="type">HTTPMethod</span>(rawValue: urlRequest.httpMethod ?? <span class="string">"GET"</span>), encodesParametersInURL(with: method) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url = urlRequest.url <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="type">AFError</span>.parameterEncodingFailed(reason: .missingURL)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">var</span> urlComponents = <span class="type">URLComponents</span>(url: url, resolvingAgainstBaseURL: <span class="literal">false</span>), !parameters.isEmpty &#123;</span><br><span class="line">      <span class="keyword">let</span> percentEncodedQuery = (urlComponents.percentEncodedQuery.<span class="built_in">map</span> &#123; $<span class="number">0</span> + <span class="string">"&amp;"</span> &#125; ?? <span class="string">""</span>) + query(parameters)</span><br><span class="line">      urlComponents.percentEncodedQuery = percentEncodedQuery</span><br><span class="line">      urlRequest.url = urlComponents.url</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> urlRequest.value(forHTTPHeaderField: <span class="string">"Content-Type"</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line">      urlRequest.setValue(<span class="string">"application/x-www-form-urlencoded; charset=utf-8"</span>, forHTTPHeaderField: <span class="string">"Content-Type"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// body</span></span><br><span class="line">    urlRequest.httpBody = query(parameters).data(using: .utf8, allowLossyConversion: <span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> urlRequest</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>p.s. ä¼ è¾“ç»„çš„æ—¶å€™ä¸€å®šè¦ä¼  json å­—ç¬¦ä¸²ï¼</p><p><a href="https://github.com/Alamofire/Alamofire/issues/1920" target="_blank" rel="noopener">iOS 10: Background Session wonâ€™t inform when downloads have failed #1920</a></p><blockquote><p><a href="https://developer.apple.com/documentation/foundation/url_loading_system" target="_blank" rel="noopener">URL Loading System</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:12 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="ç¬¬ä¸‰æ–¹æ¡†æ¶" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
      <category term="Net" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/Net/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
      <category term="æºç " scheme="https://changzw.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>URL Loading System</title>
    <link href="https://changzw.github.io/2019/08/19/URL-Loading-System/"/>
    <id>https://changzw.github.io/2019/08/19/URL-Loading-System/</id>
    <published>2019-08-19T01:52:28.000Z</published>
    <updated>2020-05-20T07:28:52.914Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2><ul><li>åœ¨ Foundation æ¡†æ¶ä¸­</li><li>æ”¯æŒåè®®ï¼š<ul><li>FTPåè®®ï¼ˆftp://ï¼‰</li><li>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆhttp://ï¼‰</li><li>åŠ å¯†è¶…æ–‡æœ¬ä¼ è¾“åè®®(https://)</li><li>æœ¬åœ°èµ„æº(file://)</li><li>æ•°æ®URLs(data://)</li></ul></li><li>å…³é”®ç±»ï¼šURLSessionï¼ŒURLï¼ŒURLRequestï¼ŒTasksï¼ŒData</li><li>æ”¯æŒï¼šAuthorization credentialsï¼Œcache å’Œcookiesï¼Œ é…ç½®ç®¡ç†</li><li>ä½¿ç”¨ closure å’Œ delegate å¤„ç† Response</li></ul><p><img src="/img/url_loading_system.jpg" alt="url_loading_system æ ¸å¿ƒç±» åˆ† 6 ä¸ªéƒ¨åˆ†"></p><h2 id="æ ¸å¿ƒ-urlsession-urlsessiontask"><a class="markdownIt-Anchor" href="#æ ¸å¿ƒ-urlsession-urlsessiontask"></a> æ ¸å¿ƒ URLSession &amp; URLSessionTask</h2><p>ä¸€ä¸ª session è¯·æ±‚ç½‘ç»œæ•°æ®éœ€è¦çš„æ ¸å¿ƒå†…å®¹</p><p><img src="/img/urlsession.jpg" alt="urlsession"></p><h3 id="session-configuration"><a class="markdownIt-Anchor" href="#session-configuration"></a> Session Configuration</h3><p>æ¯ä¸ªé…ç½®å±æ€§éƒ½å€¼å¾—ç ”ç©¶<br><img src="/img/urlsession_configuration.jpg" alt="configuration"><br><a href="https://juejin.im/post/5d5f5bcbe51d4561c02a2547" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« æœ‰å„ä¸ªå‚æ•°ç¿»è¯‘</a></p><p>æ€»å…±æœ‰ä¸‰ç§ configuration</p><ul><li><code>Default</code>: ä½¿ç”¨æœ¬åœ°æ²™ç›’ç¼“å­˜ï¼Œç”¨æˆ·credentialä¿å­˜åœ¨ keychain ä¸­</li><li><code>Ephemeral</code>: ä¸ä½¿ç”¨æ²™ç›’ï¼Œæ‰€æœ‰ç¼“å­˜credential ç­‰æ•°æ®å­˜åœ¨ ä¸ session ç»‘å®šçš„ RAM ä¸­ï¼Œsession å¤±æ•ˆåå†…å­˜è‡ªåŠ¨æ¸…ç†</li><li><code>Background</code>: è·Ÿ default session ç›¸ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯å¦å¤–ä¸€ä¸ª è¿›ç¨‹(process) å¤„ç†æ•°æ®ä¼ è¾“ï¼Œå› ä¸ºæ˜¯è·¨è¿›ç¨‹ï¼Œæ‰€ä»¥ background session æœ‰äº›é™åˆ¶æ“ä½œã€‚ï¼ˆå—¯åå°session ä½¿ç”¨äº†è¿›ç¨‹é—´é€šä¿¡ï¼‰</li></ul><p>ä¸ºä»€ä¹ˆè¦æœ‰ configurationï¼Ÿ<br>session ç›¸å½“ä¸€ä¸ª managerï¼Œç”¨æ¥ç®¡ç†ç»„ç»‡ taskï¼Œç½‘ç»œäº‹ä»¶å¤„ç†çš„æ¢çº½ï¼Œconfigurationæ˜¯è¿™ä¸ªæ¢çº½çš„å‚æ•°ä¿¡æ¯ï¼ç›¸å½“äº ä¸€ä¸ª app ä»–éƒ½æœ‰ è‡ªå·± preference</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> configuration = <span class="type">URLSessionConfiguration</span>.background(withIdentifier: <span class="string">"com.czw.backgroundDownload"</span>)</span><br><span class="line"><span class="keyword">let</span> configuration1 = <span class="type">URLSessionConfiguration</span>.<span class="keyword">default</span><span class="comment">// å…è®¸ç”¨æˆ·æ‹¥æœ‰æ²™ç›’ç¼“å­˜å™¨ï¼Œå½“session é‡Šæ”¾çš„æ—¶å€™ï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨</span></span><br><span class="line"><span class="keyword">let</span> configuration2 = <span class="type">URLSessionConfiguration</span>.ephemeral<span class="comment">// session æ— æ•ˆæ—¶ï¼Œä¸œè¥¿å°±ä¼šæ¶ˆå¤±</span></span><br><span class="line"></span><br><span class="line"><span class="type">URLSession</span>.<span class="keyword">init</span>(configuration: configuration).dataTask(with: <span class="type">URL</span>(string: urlDownloadStr)!)</span><br><span class="line">  .resume()<span class="comment">// åå° sessionConfiguration ä¸èƒ½è®¾ç½® completeHandlerï¼Œéœ€è¦è‡ªå·±è®¾ç½®ä»£ç†</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"background-å†…å­˜å¤§å°ï¼š\(String(describing: configuration.urlCache.memoryCapacity))"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"background-æ²™ç›’å¤§å°ï¼š\(String(describing: configuration.urlCache.diskCapacity))"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"default-å†…å­˜å¤§å°ï¼š\(String(describing: configuration1.urlCache.memoryCapacity))"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"default-æ²™ç›’å¤§å°ï¼š\(String(describing: configuration1.urlCache.diskCapacity))"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"ephemeral-å†…å­˜å¤§å°ï¼š\(String(describing: configuration2.urlCache.memoryCapacity))"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"ephemeral-æ²™ç›’å¤§å°ï¼š\(String(describing: configuration2.urlCache.diskCapacity))"</span>)</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š<br>background-å†…å­˜å¤§å°ï¼šnil<br>background-æ²™ç›’å¤§å°ï¼šnil<br>default-å†…å­˜å¤§å°ï¼š512000<br>default-æ²™ç›’å¤§å°ï¼š10000000<br>ephemeral-å†…å­˜å¤§å°ï¼š512000<br>ephemeral-æ²™ç›’å¤§å°ï¼š0</p><p>å°±åƒæ–‡æ¡£è¯´çš„ï¼Œå½“session å¤±æ•ˆä»¥å ephemeral çš„ cache ä¼šæ¶ˆå¤±ï¼Œå› ä¸ºä»–æ²¡æœ‰æ²™ç›’ç©ºé—´</p><h3 id="session-ç½‘ç»œè¯·æ±‚"><a class="markdownIt-Anchor" href="#session-ç½‘ç»œè¯·æ±‚"></a> session ç½‘ç»œè¯·æ±‚</h3><p><img src="/img/urlsession_flow.jpg" alt="urlsession request flow"></p><p>æˆ‘ä»¬è¦åšçš„</p><ol><li>é…ç½®éœ€è¦çš„ session configurationï¼Œ</li><li>é…ç½® session<ol><li>ç³»ç»Ÿæä¾›çš„ shared å•ä¾‹ï¼Œç³»ç»Ÿè‡ªå·±é…ç½® configurationï¼ŒsessionDelegateï¼ŒdelegateQueue</li><li>è‡ªå®šä¹‰ sessionï¼Œè‡ªå·±è®¾ç½® configurationï¼ŒsessionDelegateï¼ŒdelegateQueue(æ˜¯ serial queue)</li></ol></li><li>æä¾› request &amp; url ç»™ session</li><li>ç”Ÿæˆ task<ol><li>URLSessionTask<ul><li>URLSessionDataTask</li><li>URLSessionUploadTask</li><li>URLSessionDownloadTask</li><li>URLSessionStreamTask</li><li>URLSessionWebSocketTaskï¼ˆiOS 13.0ï¼‰</li></ul></li></ol></li><li>é…ç½®SessionDelegate, SessionTaskDelegate å¯¹ç½‘ç»œäº‹ä»¶å¤„ç† (URLSessionTaskDelegate: URLSessionDelegate<ul><li>URLSessionDataDelegate</li><li>URLSessionDownloadDelegate</li><li>URLSessionStreamDelegate</li><li>URLSessionWebSocketDelegateï¼ˆiOS 13.0ï¼‰</li></ul></li></ol><p>SessionDelegate åªæœ‰3ä¸ªæ¥å£</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line"><span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, didBecomeInvalidWithError error: Error?)</span></span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line"><span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, didReceive challenge: URLAuthenticationChallenge, completionHandler: @escaping <span class="params">(URLSession.AuthChallengeDisposition, URLCredential?)</span></span></span> -&gt; <span class="type">Void</span>) </span><br><span class="line"></span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line"><span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSessionDidFinishEvents</span><span class="params">(forBackgroundURLSession session: URLSession)</span></span></span><br></pre></td></tr></table></figure><p>è‡³äºå„ä¸ª taskDelegateï¼Œå¯¹åº”ä¸åŒçš„task ç±»å‹æœ‰ä¸ªå­—ä¸åŒåè®®æ¥å£<br>è¿™é‡Œä¸»è¦çœ‹ SessionTaskDelegate</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">URLSessionTaskDelegate</span> : <span class="title">URLSessionDelegate</span> </span>&#123; </span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">11.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, willBeginDelayedRequest request: URLRequest, completionHandler: @escaping <span class="params">(URLSession.DelayedRequestDisposition, URLRequest?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">11.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, taskIsWaitingForConnectivity task: URLSessionTask)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, willPerformHTTPRedirection response: HTTPURLResponse, newRequest request: URLRequest, completionHandler: @escaping <span class="params">(URLRequest?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, didReceive challenge: URLAuthenticationChallenge, completionHandler: @escaping <span class="params">(URLSession.AuthChallengeDisposition, URLCredential?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, needNewBodyStream completionHandler: @escaping <span class="params">(InputStream?)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, didSendBodyData bytesSent: Int64, totalBytesSent: Int64, totalBytesExpectedToSend: Int64)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">10.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, didFinishCollecting metrics: URLSessionTaskMetrics)</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line">  <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„æ˜¯ dataTaskï¼ŒdownloadTaskï¼ŒuploadTask</p><h2 id="å®é™…ä½¿ç”¨"><a class="markdownIt-Anchor" href="#å®é™…ä½¿ç”¨"></a> å®é™…ä½¿ç”¨</h2><h3 id="ä»ç½‘ç«™è·å–æ•°æ®åˆ°å†…å­˜"><a class="markdownIt-Anchor" href="#ä»ç½‘ç«™è·å–æ•°æ®åˆ°å†…å­˜"></a> ä»ç½‘ç«™è·å–æ•°æ®åˆ°å†…å­˜</h3><h4 id="ä½¿ç”¨å›è°ƒå¤„ç†æ¥å—ç»“æœä½¿ç”¨closure-å›è°ƒå¾—åˆ°-data"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å›è°ƒå¤„ç†æ¥å—ç»“æœä½¿ç”¨closure-å›è°ƒå¾—åˆ°-data"></a> ä½¿ç”¨å›è°ƒå¤„ç†æ¥å—ç»“æœï¼šä½¿ç”¨closure å›è°ƒå¾—åˆ° data</h4><p><img src="https://docs-assets.developer.apple.com/published/c7124fb5d7/bf4501ff-82b2-4dd4-9ec3-243ef0e70d21.png" alt=""></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// task çš„çŠ¶æ€</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">URLSessionTask</span> </span>&#123; </span><br><span class="line">  <span class="meta">@available</span>(iOS <span class="number">7.0</span>, *)</span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">State</span> : <span class="title">Int</span> </span>&#123; </span><br><span class="line">    <span class="keyword">case</span> running </span><br><span class="line">    <span class="keyword">case</span> suspended <span class="comment">// åˆè¯•çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">case</span> canceling </span><br><span class="line">    <span class="keyword">case</span> completed</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://www.example.com/"</span>)!</span><br><span class="line">  <span class="keyword">let</span> task = <span class="type">URLSession</span>.shared.dataTask(with: url) &#123; data, response, error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">      <span class="keyword">self</span>.handleClientError(error)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> httpResponse = response <span class="keyword">as</span>? <span class="type">HTTPURLResponse</span>,</span><br><span class="line">      (<span class="number">200</span>...<span class="number">299</span>).<span class="built_in">contains</span>(httpResponse.statusCode) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">self</span>.handleServerError(response)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> mimeType = httpResponse.mimeType, mimeType == <span class="string">"text/html"</span>,</span><br><span class="line">      <span class="keyword">let</span> data = data,</span><br><span class="line">      <span class="keyword">let</span> string = <span class="type">String</span>(data: data, encoding: .utf8) &#123;</span><br><span class="line">      <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        <span class="keyword">self</span>.webView.loadHTMLString(string, baseURL: url)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// session create å‡ºæ¥çš„ task æ˜¯ suspend çš„çŠ¶æ€</span></span><br><span class="line">  task.resume()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ç‚¹ï¼š</p><ol><li>session create å‡ºæ¥çš„ task åˆå§‹çŠ¶æ€æ˜¯ suspend</li><li>å›è°ƒå¤„ç†æ˜¯åœ¨ serial queue ä»»åŠ¡æ”¾åˆ°å­çº¿ç¨‹å¤„ç†çš„ï¼Œé€šçŸ¥ UI å˜åŒ–åº”åˆ‡æ¢ä¸»çº¿ç¨‹</li></ol><h4 id="æ¥å—è¯·æ±‚è¯¦æƒ…ç»“æœä½¿ç”¨-delegate"><a class="markdownIt-Anchor" href="#æ¥å—è¯·æ±‚è¯¦æƒ…ç»“æœä½¿ç”¨-delegate"></a> æ¥å—è¯·æ±‚è¯¦æƒ…&amp;ç»“æœï¼šä½¿ç”¨ Delegate</h4><p><img src="https://docs-assets.developer.apple.com/published/8b22355c7f/730c8e1b-654f-4eb9-9c63-d439a69ac5d2.png" alt=""></p><p>è¿™ä¸ªæ—¶å€™ session ä¸åº”è¯¥ä½¿ç”¨ <code>shared</code>ï¼Œè€Œæ˜¯è¦è‡ªå·±é…ç½®</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> session: <span class="type">URLSession</span> = &#123;</span><br><span class="line">  <span class="keyword">let</span> configuration = <span class="type">URLSessionConfiguration</span>.<span class="keyword">default</span></span><br><span class="line">  configuration.waitsForConnectivity = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">return</span> <span class="type">URLSession</span>(configuration: configuration,</span><br><span class="line">                    delegate: <span class="keyword">self</span>,</span><br><span class="line">                    delegateQueue: <span class="literal">nil</span>)</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> receivedData: <span class="type">Data?</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">  loadButton.isEnabled = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://www.example.com/"</span>)!</span><br><span class="line">  receivedData = <span class="type">Data</span>()</span><br><span class="line">  <span class="keyword">let</span> task = session.dataTask(with: url)</span><br><span class="line">  task.resume()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// delegate methods</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, dataTask: URLSessionDataTask, didReceive response: URLResponse,</span></span></span><br><span class="line"><span class="function"><span class="params">        completionHandler: @escaping <span class="params">(URLSession.ResponseDisposition)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> response = response <span class="keyword">as</span>? <span class="type">HTTPURLResponse</span>,</span><br><span class="line">    (<span class="number">200</span>...<span class="number">299</span>).<span class="built_in">contains</span>(response.statusCode),</span><br><span class="line">    <span class="keyword">let</span> mimeType = response.mimeType,</span><br><span class="line">    mimeType == <span class="string">"text/html"</span> <span class="keyword">else</span> &#123;</span><br><span class="line">    completionHandler(.cancel)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  completionHandler(.allow)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, dataTask: URLSessionDataTask, didReceive data: Data)</span></span> &#123;</span><br><span class="line">  <span class="keyword">self</span>.receivedData?.append(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">urlSession</span><span class="params">(<span class="number">_</span> session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?)</span></span> &#123;</span><br><span class="line">  <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">    <span class="keyword">self</span>.loadButton.isEnabled = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">      handleClientError(error)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> receivedData = <span class="keyword">self</span>.receivedData,</span><br><span class="line">      <span class="keyword">let</span> string = <span class="type">String</span>(data: receivedData, encoding: .utf8) &#123;</span><br><span class="line">      <span class="keyword">self</span>.webView.loadHTMLString(string, baseURL: task.currentRequest?.url)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä»£ç†çš„æ–¹å¼ï¼Œå¯ä»¥å¤„ç†å¾ˆå¤šç‰¹æ®Šçš„æƒ…å†µï¼š</p><ul><li>authentication challenges</li><li>following redirects</li></ul><blockquote><p><a href="https://developer.apple.com/documentation/foundation/url_loading_system" target="_blank" rel="noopener">URL Loading System</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="iOS Programming" scheme="https://changzw.github.io/categories/iOS-Programming/"/>
    
      <category term="Guide" scheme="https://changzw.github.io/categories/iOS-Programming/Guide/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>è¯»ä»£ç  Me</title>
    <link href="https://changzw.github.io/2019/05/17/%E8%AF%BB%E4%BB%A3%E7%A0%81-Me/"/>
    <id>https://changzw.github.io/2019/05/17/%E8%AF%BB%E4%BB%A3%E7%A0%81-Me/</id>
    <published>2019-05-16T16:47:30.000Z</published>
    <updated>2020-05-18T12:08:33.197Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆçœ‹"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆçœ‹"></a> ä¸ºä»€ä¹ˆçœ‹</h2><p>æŠ½ç©ºæ™šä¸Šç¡ä¸ç€çœ‹ <a href="https://github.com/vsouza/awesome-ios#gcd" target="_blank" rel="noopener">awesome-ios</a> æä¾›çš„ä¼˜ç§€ä»£ç åº“<br>[Me](<a href="https://github.com/pascalbros/Me" target="_blank" rel="noopener">https://github.com/pascalbros/Me</a> æºç </p><h2 id="ä»–æ˜¯åšä»€ä¹ˆçš„"><a class="markdownIt-Anchor" href="#ä»–æ˜¯åšä»€ä¹ˆçš„"></a> ä»–æ˜¯åšä»€ä¹ˆçš„</h2><p>Me æ˜¯è§£å†³åµŒå¥—å¼‚æ­¥é—®é¢˜çš„ä¸€ä¸ªè½»é‡çº§åº“â€”â€”å°±ä¸€ä¸ªæ–‡ä»¶</p><h2 id="ä½¿ç”¨ä»–ä»¥åçš„æ•ˆæœ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨ä»–ä»¥åçš„æ•ˆæœ"></a> ä½¿ç”¨ä»–ä»¥åçš„æ•ˆæœ</h2><p>before</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MyAPI</span>.login &#123;</span><br><span class="line">  <span class="comment">//Do your stuff and then request posts...</span></span><br><span class="line">  <span class="type">MyAPI</span>.posts &#123;</span><br><span class="line">   <span class="comment">//Do your stuff and then request comments...</span></span><br><span class="line">   <span class="type">MyAPI</span>.comments &#123;</span><br><span class="line">    <span class="comment">//Do your stuff and then request likes...</span></span><br><span class="line">    <span class="type">MyAPI</span>.likes &#123;</span><br><span class="line">      <span class="comment">//We are done here</span></span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>after</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Me</span>.start &#123; (me) <span class="keyword">in</span></span><br><span class="line">  <span class="type">MyAPI</span>.login &#123;</span><br><span class="line">   <span class="comment">//Do your stuff and then request posts...</span></span><br><span class="line">   me.runNext()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;.next &#123; (caller, me) <span class="keyword">in</span></span><br><span class="line">  <span class="type">MyAPI</span>.posts &#123;</span><br><span class="line">   <span class="comment">//Do your stuff and then request comments...</span></span><br><span class="line">   me.runNext()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;.next &#123; (caller, me) <span class="keyword">in</span></span><br><span class="line">  <span class="type">MyAPI</span>.comments &#123;</span><br><span class="line">   <span class="comment">//Do your stuff and then request likes...</span></span><br><span class="line">   me.runNext()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;.next &#123; (caller, me) <span class="keyword">in</span></span><br><span class="line">  <span class="type">MyAPI</span>.likes &#123;</span><br><span class="line">   <span class="comment">//We are done here</span></span><br><span class="line">   me.end()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;.run()</span><br></pre></td></tr></table></figure><p>çœ‹æ•ˆæœï¼š</p><ol><li>Me æŠŠå¼‚æ­¥åµŒå¥—ä»£ç â€“&gt; é“¾å¼ä»£ç ï¼ˆæƒ³æƒ³ä»–æ˜¯æ€ä¹ˆåšçš„ï¼Ÿï¼‰</li><li>Me æ˜¯é“¾æ¡å‹çš„ï¼Œstartï¼Œnextï¼Œnext(name:)ï¼Œjump(toName:)ï¼Œend<ol><li>ä»–æ˜¯å¦‚ä½•åšå¼‚æ­¥é€šçŸ¥çš„ï¼Ÿ</li><li>å¦‚ä½•å¼€å§‹ï¼Œå¦‚ä½•ç»“æŸï¼Ÿ</li><li>æ”¯æŒå®ç°å¤šé“¾æ¡å¹¶å‘æ‰§è¡Œå—ï¼Ÿ</li></ol></li><li>ä»æä¾›çš„æ¥å£ä¸Šå¯ä»¥çœ‹å‡º<ol><li>Meå¼€å¯ç»“æŸè¦ç”±ç”¨æˆ·æ§åˆ¶</li><li>èŠ‚ç‚¹é©±åŠ¨éœ€è¦ç”¨æˆ·è§¦å‘</li><li>æ”¯æŒæŒ‡å®šèŠ‚ç‚¹è·³è½¬</li></ol></li></ol><p>ok ä½¿ç”¨demo&amp;åŸºæœ¬ç‰¹æ€§åˆ†æå®Œäº†ï¼Œæ¥ä¸‹æ¥çœ‹æºç </p><hr><h2 id="æºç "><a class="markdownIt-Anchor" href="#æºç "></a> æºç </h2><h3 id="å…ˆçœ‹æ¥å£"><a class="markdownIt-Anchor" href="#å…ˆçœ‹æ¥å£"></a> å…ˆçœ‹æ¥å£</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">MeInitClosure</span> = ((<span class="number">_</span> current: <span class="type">Me</span>) -&gt; ())</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">MeClosure</span> = ((<span class="number">_</span> previous: <span class="type">Me?</span>, <span class="number">_</span> current: <span class="type">Me</span>) -&gt; ())</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> first: <span class="type">Me</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> index: <span class="type">UInt</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> parameters: [<span class="type">String</span> : <span class="type">Any</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// é“¾å¼èŠ‚ç‚¹å‡½æ•°ï¼Œstatic æ˜¯èµ·ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">(name: String = <span class="string">""</span>, this: @escaping MeInitClosure)</span></span> -&gt; <span class="type">Me</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">(this: @escaping MeClosure)</span></span> -&gt; <span class="type">Me</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">(name: String = <span class="string">""</span>, next: @escaping MeClosure)</span></span> -&gt; <span class="type">Me</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">end</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">runNext</span><span class="params">(queue: DispatchQueue)</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">runNext</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">runNextOnMain</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(toIndex jump: UInt = <span class="number">0</span>, queue: DispatchQueue)</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(toIndex jump: UInt = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">jumpOnMain</span><span class="params">(toIndex jump: UInt = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(toName jump: String, queue: DispatchQueue)</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(toName jump: String)</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">jumpOnMain</span><span class="params">(toName jump: String)</span></span></span><br></pre></td></tr></table></figure><ol><li>æä¾› Me èŠ‚ç‚¹ indexï¼Œnameï¼Œä»£ç åº“å†…éƒ¨ç»´æŠ¤</li><li>åªæä¾›å…¶å®èŠ‚ç‚¹ first</li><li>æä¾›çº¿ç¨‹é˜Ÿåˆ—è°ƒåº¦æ¥å£</li><li>parameters æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿåƒæ˜¯ [name: MeClouse] å­—å…¸ï¼Œæ¯ä¸ª me èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªclouse</li></ol><h3 id="çœ‹ä»£ç å®ç°"><a class="markdownIt-Anchor" href="#çœ‹ä»£ç å®ç°"></a> çœ‹ä»£ç å®ç°</h3><ol><li>æ ¸å¿ƒä»£ç ï¼Œè¿™ä¸ªåœ°æ–¹å°è£…äº† GCD</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">runNext</span><span class="params">(queue: DispatchQueue)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> next = <span class="keyword">self</span>.next &#123;</span><br><span class="line">    <span class="comment">//self.nextObj!.parameters = self.parameters //enable to pass parameters to the next object</span></span><br><span class="line">    queue.async &#123;</span><br><span class="line">      next(<span class="keyword">self</span>, <span class="keyword">self</span>.nextObj!)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">jump</span><span class="params">(toIndex jump: UInt = <span class="number">0</span>, queue: DispatchQueue)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> to = me(at: jump) &#123;</span><br><span class="line">    to.this(<span class="keyword">self</span>, to)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸ªé—®é¢˜æ˜¯ï¼š<code>jump</code> çš„queue æ²¡æœ‰ç”¨â€¦â€¦ï¼ˆè¿™ä¸ªåº“çš„ä½¿ç”¨ä»·å€¼ä¸å¤§ï¼‰åªæœ‰ <code>runNext</code> ç›¸å…³æ–¹æ³•å¯ä»¥è°ƒåº¦çº¿ç¨‹<br>parameters: æ˜¯ me èŠ‚ç‚¹ä¿å­˜æ•°æ®ï¼Œç”¨äºç”¨æˆ·è‡ªå·±ä¼ é€’æ•°æ®ä½¿ç”¨</p><ol start="2"><li>å†…éƒ¨æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯é“¾è¡¨</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> nextObj: <span class="type">Me?</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> _first: <span class="type">Me?</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="è¯»æºç " scheme="https://changzw.github.io/categories/%E8%AF%BB%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="æºç " scheme="https://changzw.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift + MVVM:å¦‚ä½•æä¾›ViewModels</title>
    <link href="https://changzw.github.io/2019/04/16/RxSwfit+RAC/RxSwift-MVVM-%E5%A6%82%E4%BD%95%E6%8F%90%E4%BE%9BViewModels/"/>
    <id>https://changzw.github.io/2019/04/16/RxSwfit+RAC/RxSwift-MVVM-%E5%A6%82%E4%BD%95%E6%8F%90%E4%BE%9BViewModels/</id>
    <published>2019-04-16T12:58:40.000Z</published>
    <updated>2020-04-25T02:21:37.289Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><p><a href="https://medium.com/blablacar-tech/rxswift-mvvm-66827b8b3f10" target="_blank" rel="noopener">åŸæ–‡ï¼šRxSwift + MVVM: how to feed ViewModels</a></p><h2 id="ä»‹ç»"><a class="markdownIt-Anchor" href="#ä»‹ç»"></a> ä»‹ç»</h2><p>è‡ªä»æˆ‘ä»¬å¼€å§‹åœ¨BlaBlaCarçš„Model-View-ViewModelï¼ˆMVVMï¼‰æ¶æ„ä¸­ä½¿ç”¨RxSwiftä»¥æ¥ï¼Œå·²ç»å¿«ä¸€å¹´äº†ã€‚æˆ‘ä»¬å¯¹ç»“æœæ„Ÿåˆ°å…´å¥‹ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹æ³•ç¼–å†™çš„ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œç»´æŠ¤ï¼Œæµ‹è¯•å’Œæ‰©å±•ã€‚ä½†æ˜¯ï¼Œæœ€åˆçš„å‡ å‘¨å¹¶ä¸æ˜¯å°èœä¸€ç¢Ÿã€‚æˆ‘ä»¬å¿…é¡»åœ¨MVVM + RxSwiftæ¶æ„çš„æŸäº›æ–¹é¢è¿›è¡Œè¿­ä»£ï¼Œä»¥ä½¿äº‹æƒ…å˜å¾—æ­£ç¡®ã€‚å…¶ä¸­ä¸€ä¸ªæ–¹å¼â€”â€”ç»™ ViewModels æä¾› Inputsã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸¤ç§ä¸åŒæ–¹å¼ç»™ViewModels æä¾› Inputsï¼ˆRx Eventï¼‰</p><p>ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•è°ˆä¸€ä¸‹ ViewModels</p><h2 id="viewmodels"><a class="markdownIt-Anchor" href="#viewmodels"></a> ViewModels</h2><p>ViewModelçš„èŒè´£ï¼Œä½ å¿…é¡»æ­£ç¡®ç†è§£å®ƒï¼ˆä¸æ­¢ä¸€ä¸ªï¼‰ï¼š</p><ul><li>å®ƒåº”è¯¥æ˜¯å¯ä»¥æ’å…¥åˆ°ä»»ä½•Viewä¸Šçš„ã€‚æ¯”å¦‚ï¼Œä¸æ˜¯å…ˆé€ ä¸€ä¸ªViewå†å»å®šä¹‰ä¸€ä¸ªViewModelã€‚æ³¨æ„ï¼Œæ˜¯Viewæ‹¥æœ‰ViewModelã€‚ViewçŸ¥é“ViewModelï¼Œè€Œä¸æ˜¯åè¿‡æ¥ã€‚</li><li>å®ƒæ˜¯å¯æµ‹è¯•çš„ã€‚æœ€ç»ˆï¼ŒMVVMæ¶æ„æœ€å¤§çš„å¥½å¤„å°±æ˜¯è®©ä¸šåŠ¡é€»è¾‘å¯æµ‹ã€‚</li><li>MVVMä½¿ç”¨ç»‘å®šæœºåˆ¶æ›´åŠ ç‰›é€¼ï¼Œæ‰€ä»¥è®©ä½¿ç”¨ RxSwift æ¥æ›´å¥½åœ°åˆ©ç”¨ ViewModel</li></ul><p>to be continuedâ€¦</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="ç¬¬ä¸‰æ–¹æ¡†æ¶" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
      <category term="RxSwift" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/RxSwift/"/>
    
    
      <category term="ç¿»è¯‘" scheme="https://changzw.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="RxSwift" scheme="https://changzw.github.io/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•è¯»ä»£ç å†™ä»£ç </title>
    <link href="https://changzw.github.io/2019/03/03/%E5%A6%82%E4%BD%95%E8%AF%BB%E4%BB%A3%E7%A0%81%E5%86%99%E4%BB%A3%E7%A0%81/"/>
    <id>https://changzw.github.io/2019/03/03/%E5%A6%82%E4%BD%95%E8%AF%BB%E4%BB%A3%E7%A0%81%E5%86%99%E4%BB%A3%E7%A0%81/</id>
    <published>2019-03-02T22:31:09.000Z</published>
    <updated>2020-04-25T02:43:24.383Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="æ€ä¹ˆè¯»"><a class="markdownIt-Anchor" href="#æ€ä¹ˆè¯»"></a> æ€ä¹ˆè¯»</h2><ol><li>è¿™ä¸ªåº“æ˜¯ç”¨æ¥å¹²å˜›ï¼Ÿ</li><li>çœ‹æ–‡ä»¶ç»“æ„<ol><li>æ€è€ƒä½œè€…åˆ†äº†é‚£äº›æ¨¡å—</li><li>æ¯ä¸ªæ¨¡å—éƒ½æ˜¯å¹²å•¥çš„</li><li>æ¨¡å—è”ç³»å®é™…åœºæ™¯æ˜¯å•¥ï¼Œæ–‡ä»¶ä¸Šç”¨äº†å“ªäº›æ¶æ„orè®¾è®¡æ¨¡å¼ï¼ˆMVCï¼ŒMVVMï¼ŒViewStateModelï¼ŒCoordinateï¼ŒMeditateâ€¦â€¦ï¼‰</li><li>æ¨¡å—é—´æ˜¯å¦‚ä½•è”ç³»çš„â€”â€”æ•°æ®æµ</li><li>äº†è§£å…·ä½“æ¨¡å—ç»†èŠ‚</li></ol></li><li>çœ‹å…·ä½“åè®®&amp;ç±»çš„æ¥å£<ol><li>ä½œè€…æƒ³è¦ç»™ç”¨æˆ·æä¾›ä»€ä¹ˆåŠŸèƒ½</li><li>ç±»çš„æ•°æ®å‡ºå£&amp;å…¥å£æ˜¯ä»€ä¹ˆ</li><li>ç±»ä¹‹é—´å…³ç³»ä½¿ç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Œå¦‚ä½•æé«˜äº†å¤ç”¨æ€§</li></ol></li><li>çœ‹æ•°æ®æµå‘<ol><li>å¯¹äºæ–‡æ¡£å°‘&amp;æƒ³æ›´æ·±å…¥ç†è§£ä»£ç ï¼Œå€ŸåŠ© IDE è°ƒè¯•ä»£ç ï¼Œè·Ÿè¸ªæ•°æ®è¾“å…¥è¾“å‡ºï¼Œçœ‹å‡½æ•°è°ƒç”¨æ ˆ</li><li>æ ¹æ®æ•°æ®æµå‘å¯ä»¥æ›´æ¸…æ¥šç±»ä¹‹é—´çš„å…³ç³»</li></ol></li><li>çœ‹å…·ä½“å®ç°<ol><li>æƒ³çŸ¥é“å…·ä½“ç»†èŠ‚å¦‚ä½•å®ç°çš„æ—¶å€™ï¼Œçœ‹æ–‡ä»¶ï¼Œå®šä½æºç ä½ç½®</li></ol></li></ol><h2 id="æ€ä¹ˆå†™"><a class="markdownIt-Anchor" href="#æ€ä¹ˆå†™"></a> æ€ä¹ˆå†™</h2><ol><li>ç¡®å®šåŠŸèƒ½</li><li>æ ¹æ®åŠŸèƒ½ç¡®å®šæ¨¡å—</li><li>æ ¹æ®æ¨¡å—åˆ†æ–‡ä»¶å¤¹<ol><li>æ€è€ƒæ¨¡å—ä¹‹é—´å…³ç³»ï¼Œå‡ºå£å…¥å£ï¼Œç›¸äº’ä¾èµ–å…³ç³»</li></ol></li><li>æ¯ä¸ªæ¨¡å—å†™æ¥å£â€”â€”API<ol><li>API å±‚çº§å…³ç³»ï¼ŒæŠ½è±¡å±‚çº§ï¼Œé«˜å±‚åŠå®ç°é€šç”¨åŠŸèƒ½</li><li>æ¥å£å‡ºå£å…¥å£ï¼Œä¾èµ–æ³¨å…¥</li><li>æ¥å£ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œæ€è€ƒä½¿ç”¨ä½•ç§è®¾è®¡æ¨¡å¼</li></ol></li><li>æ ¹æ®æ¨¡å—ï¼Œå®ç°åè®®<ol><li>class å¼€å‘</li><li>class ä¹‹é—´å…³ç³»ï¼Œä½¿ç”¨ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Œæé«˜å¤ç”¨æ•ˆç‡</li><li>class çš„å‡ºå£å…¥å£ï¼Œä¾èµ–æ³¨å…¥</li><li>ç§æœ‰æˆå‘˜å†…éƒ¨é€»è¾‘</li></ol></li></ol><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="æ€è€ƒ" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/"/>
    
      <category term="å¼€å‘" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="å­¦ä¹ æ„Ÿæ‚Ÿ" scheme="https://changzw.github.io/tags/%E5%AD%A6%E4%B9%A0%E6%84%9F%E6%82%9F/"/>
    
  </entry>
  
  <entry>
    <title>é›ªçƒé€Ÿè¯»æ³•--è¿­ä»£æ ‘--æ•´ä½“&amp;ç»†èŠ‚</title>
    <link href="https://changzw.github.io/2019/02/05/%E9%9B%AA%E7%90%83%E9%80%9F%E8%AF%BB%E6%B3%95/"/>
    <id>https://changzw.github.io/2019/02/05/%E9%9B%AA%E7%90%83%E9%80%9F%E8%AF%BB%E6%B3%95/</id>
    <published>2019-02-05T11:01:50.000Z</published>
    <updated>2020-04-25T03:03:03.779Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="é›ªçƒé€Ÿè¯»æ³•æµ…æ"><a class="markdownIt-Anchor" href="#é›ªçƒé€Ÿè¯»æ³•æµ…æ"></a> é›ªçƒé€Ÿè¯»æ³•â€“æµ…æ</h2><p>ã€Šé›ªçƒé€Ÿè¯»æ³•ã€‹ä¸­è¯´ï¼š</p><blockquote><p>é€Ÿè¯»çš„æ–¹å¼æ˜¯ï¼š<br>é€Ÿåº¦æŠ€å·§ * èµ„æ–™åº“(å¤§å°) = é€Ÿè¯»</p><ul><li>åå¤è¯» n å˜</li><li>æ¯æ¬¡å¿«é€Ÿé˜…è¯»ï¼Œè¦æ±‚1.ä¸æ±‚ç”šè§£ï¼Œ2.è„‘å­é‡Œä¸è¦æœ‰è¯»çš„å£°éŸ³</li></ul><p>å…·ä½“ï¼š</p><ul><li>å…ˆè¯è¯»ç›®å½•ï¼Œå‰è¨€ï¼Œåè®° ç”¨ 15~30ï¼Œæ€è€ƒä¹¦çš„æ•´ä½“ç»“æ„ï¼Œä½œè€…å†™ä½œæ„å›¾</li><li>ä»æ¡†æ¶çš„å¤–å±‚ä¸€å±‚å±‚å‘çŸ¥è¯†ç»†èŠ‚æŒ–ï¼Œæ¯æ¬¡å¤„ç†ä¸€å±‚ï¼Œç†è§£ä¸€å±‚ï¼Œæ„å»ºè‡ªå·±å¯¹è¿™æœ¬ä¹¦çš„èµ„æ–™åº“ï¼ˆæ»šé›ªçƒçš„è¿‡ç¨‹ï¼‰</li></ul></blockquote><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p><ol><li>å¼ºè°ƒå…ˆæŒæ¡çŸ¥è¯†çš„æ¡†æ¶ï¼ä»æ•´ä½“çš„è§’åº¦ä¸€å±‚å±‚å­¦ä¹ çŸ¥è¯†ã€‚</li><li>æœ‰äº†æ¡†æ¶å°±çŸ¥é“æ£®æ—å¤§æ¦‚çš„æ ·å­ï¼</li><li>å¦‚æœå•çº¯çš„æŒ‰ç…§ç›®å½•ä¸€ç‚¹ç‚¹å­¦ä¹ ä¹¦æœ¬ä¸Šçš„çŸ¥è¯†ï¼Œä¼šé™·åœ¨å±€éƒ¨ç»†èŠ‚ä¸­å‡ºä¸æ¥æµªè´¹å¤§é‡æ—¶é—´ï¼Œè¯»ä¹¦æ—¶é—´è¿‡é•¿ï¼Œå‰é¢çš„çŸ¥è¯†ä¼šå¿˜ï¼Œåé¢ä¸ä¸€å®šä¼šè®¤çœŸè¯»å®Œï¼Œæœ€åæ•´æœ¬ä¹¦éƒ½å¾ˆéš¾ç†è§£ã€‚</li><li>ä½œè€…æ˜¯ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼å†™ä¹¦çš„å‘¢ï¼Ÿç±»ä¼¼äºã€Šé›ªçƒé€Ÿè¯»æ³•ã€‹å…ˆæœ‰ä¸­å¿ƒæ€æƒ³ï¼Œç›®å½•ï¼Œæ®µè½ï¼Œç„¶åè½å®åˆ°ç»†èŠ‚ï¼Œã€Šé›ªçƒé€Ÿè¯»æ³•ã€‹å°±æ˜¯æŒ‰ç…§ä½œè€…çš„å†™ä½œçš„æ–¹å¼ç†è§£çŸ¥è¯†çš„è¿‡ç¨‹ã€‚</li><li>é€Ÿè¯»ä¸å‘å‡ºå£°éŸ³ï¼Œæ›´æœ‰åˆ©äºè¯»è€…è·Ÿä½œè€…äº§ç”Ÿå…±é¸£ï¼è¿™ä¸ªä¹Ÿæ˜¯è¯»ä¹¦çš„ä¸€ä¸ªç›®çš„</li></ol><h2 id="ç›®æ ‡-vs-ä»»åŠ¡"><a class="markdownIt-Anchor" href="#ç›®æ ‡-vs-ä»»åŠ¡"></a> ç›®æ ‡ vs ä»»åŠ¡</h2><p>ç›®æ ‡ï¼šä¸€ä¸ªä½ æƒ³è¦çœ‹è§çš„å¥½ç»“æœ<br>ä»»åŠ¡ï¼šä¸ºå®ç°ç›®æ ‡ä½ è¦åšçš„äº‹</p><p>åœ¨ç¼ºå°‘åŠ¨åŠ›çš„æ—¶å€™å¤šæ€è€ƒç›®æ ‡å¸¦æ¥é‚£äº›ç¾å¥½çš„æ„¿æ™¯ï¼Œç”¨ Deadline ç»™è‡ªå·±æ–½åŠ å‹åŠ›ï¼Œå¯¹æ¯”äººçš„æ‰¿è¯ºã€‚</p><p>åœ¨æ‰§è¡Œçš„æ—¶å€™å¤šçœ‹ç»†èŠ‚ï¼Œä»»åŠ¡ï¼Œå› ä¸ºæ€»æ˜¯å…³æ³¨ç›®æ ‡ï¼Œä¼šæ— ä»ä¸‹æ‰‹ï¼Œå¾ˆå¤šç»†èŠ‚ä¸Šçš„å›°éš¾ä¹è§‚å¯¹å¾…ï¼å¯¼è‡´ç›®æ ‡æœ€ç»ˆææµ…ã€‚</p><h2 id="æ ‘çŠ¶ç»“æ„çŸ¥è¯†"><a class="markdownIt-Anchor" href="#æ ‘çŠ¶ç»“æ„çŸ¥è¯†"></a> æ ‘çŠ¶ç»“æ„çŸ¥è¯†</h2><p>æœ‰å…³æ ‘çŠ¶ç»“æ„ï¼ŒçŸ¥è¯†è¿­ä»£è¿‡ç¨‹éƒ½æ˜¯ä¸€å±‚å±‚åŒ…è£¹çš„çŸ¥è¯†ï¼Œæœ‰å†å²æ°”æ¯çš„çŸ¥è¯†éƒ½æ˜¯æ ‘çŠ¶ç»“æ„<br>è¿™æ ·çš„çŸ¥è¯†å¯ä»¥åƒã€Šé›ªçƒé€Ÿè¯»æ³•ã€‹ä¸€æ ·å±‚å±‚å­¦ä¹ </p><h2 id="è®¡ç®—æœºçŸ¥è¯†"><a class="markdownIt-Anchor" href="#è®¡ç®—æœºçŸ¥è¯†"></a> è®¡ç®—æœºçŸ¥è¯†</h2><p>è®¡ç®—æœºçŸ¥è¯†å°±æ˜¯ä¸€ä¸ªå¤§å¤§çš„æ ‘ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¤§æ ‘æï¼Œç„¶åä¸€å±‚å±‚åˆ†è§£è¿™ä¸ªçŸ¥è¯†ç‚¹<br><img src="/img/knowledge_tree.jpg" alt="-"></p><p>ç¨‹åºå¼€å‘çš„æ—¶å€™ä¹Ÿæ˜¯ï¼Œç°æœ‰ç»“æ„ï¼Œç„¶åå†æ˜¯ç»†èŠ‚ï¼</p><p>æœ‰æ—¶é—´è¡¥å……</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="æ€è€ƒ" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/"/>
    
      <category term="å¼€å‘" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="å­¦ä¹ æ„Ÿæ‚Ÿ" scheme="https://changzw.github.io/tags/%E5%AD%A6%E4%B9%A0%E6%84%9F%E6%82%9F/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift 5.RxDataSources</title>
    <link href="https://changzw.github.io/2019/01/31/RxSwfit+RAC/RxSwift-RxDataSources/"/>
    <id>https://changzw.github.io/2019/01/31/RxSwfit+RAC/RxSwift-RxDataSources/</id>
    <published>2019-01-31T05:58:32.000Z</published>
    <updated>2020-04-25T02:21:27.338Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><p><a href="https://github.com/RxSwiftCommunity/RxDataSources/issues?q=is%3Aissue+is%3Aclosed" target="_blank" rel="noopener">åŸæ–‡: RxDataSources</a></p><h2 id="table-å’Œ-collection-view-data-sources"><a class="markdownIt-Anchor" href="#table-å’Œ-collection-view-data-sources"></a> Table å’Œ Collection View data sources</h2><h2 id="ç‰¹æ€§"><a class="markdownIt-Anchor" href="#ç‰¹æ€§"></a> ç‰¹æ€§</h2><ul><li>[x] O(N)è®¡ç®—å·®å¼‚çš„ç®—æ³•<ul><li>è¯¥ç®—æ³•å‡è®¾æ‰€æœ‰ sections å’Œ items éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤æ²¡æœ‰äºŒä¹‰æ€§</li><li>å¦‚æœæœ‰æ­§ä¹‰ï¼Œåœ¨éåŠ¨ç”»åˆ·æ–°æ—¶è‡ªåŠ¨å›é€€</li></ul></li><li>[x] ä»–ä½¿ç”¨å…¶ä»–å¯å‘å¼æ–¹æ³•ä»¥å°†æœ€å°‘æ•°é‡çš„å‘½ä»¤å‘é€åˆ°åˆ†æ®µè§†å›¾<ul><li>å³ä½¿è¿è¡Œæ—¶é—´æ˜¯çº¿æ€§çš„ï¼Œå‘é€å‘½ä»¤çš„é¦–é€‰æ•°é‡é€šå¸¸ä¹Ÿæ¯”çº¿æ€§å°‘</li><li>æœ€å¥½ï¼ˆå¹¶ä¸”æœ‰å¯èƒ½ï¼‰å°†æ›´æ”¹æ•°é‡é™åˆ¶ä¸ºè¾ƒå°çš„æ•°é‡ï¼Œå¹¶ä¸”å¦‚æœæ›´æ”¹æ•°é‡æœçº¿æ€§æ–¹å‘å¢é•¿ï¼Œåˆ™åªéœ€è¿›è¡Œæ­£å¸¸çš„reloadå³å¯</li></ul></li><li>[x] æ”¯æŒæ‰©å±•ä½ çš„ item å’Œ section ç»“æ„<ul><li>åªéœ€ä½¿ç”¨ <code>IdentifiableType</code> å’Œ <code>Equatable</code> æ‰©å±•ä½ çš„ itemï¼Œå¹¶ä½¿ç”¨ <code>AnimatableSectionModelType</code> æ‰©å±• section</li></ul></li><li>[x] æ”¯æŒ section å’Œ item çš„ä¸¤çº§åˆ†å±‚åŠ¨ç”»çš„æ‰€æœ‰ç»„åˆ<ul><li>Section åŠ¨ç”»: Insert, Delete, Mov</li><li>Item åŠ¨ç”»: Insert, Delete, Move, Reload (å¦‚æœæ—§å€¼ä¸ç­‰äºæ–°å€¼)</li></ul></li><li>[x] å¯é…ç½®åŠ¨ç”»ç±»å‹å¯¹äº Insert, Reload and Delete (Automatic, Fade, â€¦)</li><li>[x] ç¤ºä¾‹ app</li><li>[x] éšæœºå‹åŠ›æµ‹è¯•ï¼ˆeg appï¼‰</li><li>[x] æ”¯æŒå¼€ç®±å³ç”¨çš„ç¼–è¾‘ï¼ˆeg appï¼‰</li><li>[x] åŒ UITableView å’Œ UICollectionView ä¸€èµ·å·¥ä½œ</li></ul><h2 id="ä¸ºä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆ"></a> ä¸ºä»€ä¹ˆ</h2><p>ç¼–å†™ table å’Œ collection View æ•°æ®æºå¾ˆç¹çã€‚å¯¹äºæœ€ç®€å•çš„æƒ…å†µï¼Œéœ€è¦å®ç°å¤§é‡çš„å§”æ‰˜æ–¹æ³•ã€‚</p><p>RxSwift é€šè¿‡ç®€å•çš„æ•°æ®ç»‘å®šæœºåˆ¶æœ‰åŠ©äºå‡è½»ä¸€äº›è´Ÿæ‹…ï¼š</p><ol><li>æŠŠä½ çš„æ•°æ®è½¬åŒ–æˆå¯è§å¬åºåˆ— Observable</li><li>ä½¿ç”¨ä¸‹é¢æ–¹æ³•æŠŠæ•°æ®ç»‘å®šåˆ° tableView/collectionView ä¸Š<ul><li>rx.items(dataSource:protocol&lt;RxTableViewDataSourceType, UITableViewDataSource&gt;)</li><li>rx.items(cellIdentifier:String)</li><li>rx.items(cellIdentifier:String:Cell.Type:_: )</li><li>rx.items(<em>:</em>: )</li></ul></li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = <span class="type">Observable</span>&lt;[<span class="type">String</span>]&gt;.just([<span class="string">"first element"</span>, <span class="string">"second element"</span>, <span class="string">"third element"</span>])</span><br><span class="line"></span><br><span class="line">data.bind(to: tableView.rx.items(cellIdentifier: <span class="string">"Cell"</span>)) &#123; index, model, cell <span class="keyword">in</span></span><br><span class="line">  cell.textLabel?.text = model</span><br><span class="line">&#125;</span><br><span class="line">.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><p>è¿™é€‚ç”¨äºç®€å•æ•°æ®é›†ï¼Œä½†ä¸é€‚ç”¨äºéœ€è¦å°†å¤æ‚æ•°æ®é›†ä¸å¤šä¸ªsection ç»‘å®šæˆ–åœ¨æ·»åŠ /ä¿®æ”¹/åˆ é™¤item æ—¶éœ€è¦æ‰§è¡ŒåŠ¨ç”»çš„æƒ…å†µã€‚</p><p>è¿™äº›æ­£æ˜¯RxDataSourceså¸®åŠ©è§£å†³çš„ç”¨ä¾‹ã€‚</p><p>ä½¿ç”¨RxDataSourcesï¼Œå†™èµ·æ¥éå¸¸å®¹æ˜“</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dataSource = <span class="type">RxTableViewSectionedReloadDataSource</span>&lt;<span class="type">SectionModel</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;&gt;(configureCell: configureCell)</span><br><span class="line"><span class="type">Observable</span>.just([<span class="type">SectionModel</span>(model: <span class="string">"title"</span>, items: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])])</span><br><span class="line">    .bind(to: tableView.rx.items(dataSource: dataSource))</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kzaher/rxswiftcontent/rxdatasources/RxDataSources.gif" alt="-"></p><h2 id="æ€ä¹ˆç”¨"><a class="markdownIt-Anchor" href="#æ€ä¹ˆç”¨"></a> æ€ä¹ˆç”¨</h2><p>ç»™å®šä»¥ä¸‹è‡ªå®šä¹‰æ•°æ®ç»“æ„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CustomData</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> anInt: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">var</span> aString: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> aCGPoint: <span class="type">CGPoint</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆä½¿ç”¨éµå¾ª SectionModelType åè®®çš„ç»“æ„å®šä¹‰ä½ çš„sectionï¼š<ul><li>å®šä¹‰ item ç±»å‹åˆ«åï¼šç­‰äºè¯¥ section å°†åŒ…å«çš„ item ç±»å‹</li><li>å£°æ˜ä¸€ä¸ª items å±æ€§ï¼šItem ç±»å‹æ•°ç»„</li></ul></li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SectionOfCustomData</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> header: <span class="type">String</span>    </span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">Item</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SectionOfCustomData</span>: <span class="title">SectionModelType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Item</span> = <span class="type">CustomData</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">init</span>(original: <span class="type">SectionOfCustomData</span>, items: [<span class="type">Item</span>]) &#123;</span><br><span class="line">    <span class="keyword">self</span> = original</span><br><span class="line">    <span class="keyword">self</span>.items = items</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºä¸€ä¸ªdataSourceå¯¹è±¡ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ SectionOfCustomData ç±»å‹ï¼š</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dataSource = <span class="type">RxTableViewSectionedAnimatedDataSource</span>&lt;<span class="type">MySection</span>&gt;(</span><br><span class="line">    configureCell: &#123; ds, tv, <span class="number">_</span>, item <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> cell = tv.dequeueReusableCell(withIdentifier: <span class="string">"Cell"</span>) ?? <span class="type">UITableViewCell</span>(style: .<span class="keyword">default</span>, reuseIdentifier: <span class="string">"Cell"</span>)</span><br><span class="line">        cell.textLabel?.text = <span class="string">"Item \(item)"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cell</span><br><span class="line">    &#125;,</span><br><span class="line">    titleForHeaderInSection: &#123; ds, index <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> ds.sectionModels[index].header</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol start="3"><li>æ ¹æ®éœ€è¦åœ¨dataSourceä¸Šè‡ªå®šä¹‰é—­åŒ…ï¼š<ul><li>titleForHeaderInSection</li><li>titleForFooterInSection</li><li>etc</li></ul></li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dataSource.titleForHeaderInSection = &#123; dataSource, index <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">return</span> dataSource.sectionModels[index].header</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dataSource.titleForFooterInSection = &#123; dataSource, indexPath <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">return</span> dataSource.sectionModels[index].footer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dataSource.canEditRowAtIndexPath = &#123; dataSource, indexPath <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dataSource.canMoveRowAtIndexPath = &#123; dataSource, indexPath <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>å°†å®é™…æ•°æ®å®šä¹‰ä¸º CustomData å¯¹è±¡çš„ Observableåºåˆ—ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°tableView</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sections = [</span><br><span class="line">  <span class="type">SectionOfCustomData</span>(header: <span class="string">"First section"</span>, items: [<span class="type">CustomData</span>(anInt: <span class="number">0</span>, aString: <span class="string">"zero"</span>, aCGPoint: <span class="type">CGPoint</span>.zero), <span class="type">CustomData</span>(anInt: <span class="number">1</span>, aString: <span class="string">"one"</span>, aCGPoint: <span class="type">CGPoint</span>(x: <span class="number">1</span>, y: <span class="number">1</span>)) ]),</span><br><span class="line">  <span class="type">SectionOfCustomData</span>(header: <span class="string">"Second section"</span>, items: [<span class="type">CustomData</span>(anInt: <span class="number">2</span>, aString: <span class="string">"two"</span>, aCGPoint: <span class="type">CGPoint</span>(x: <span class="number">2</span>, y: <span class="number">2</span>)), <span class="type">CustomData</span>(anInt: <span class="number">3</span>, aString: <span class="string">"three"</span>, aCGPoint: <span class="type">CGPoint</span>(x: <span class="number">3</span>, y: <span class="number">3</span>)) ])</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="type">Observable</span>.just(sections)</span><br><span class="line">  .bind(to: tableView.rx.items(dataSource: dataSource))</span><br><span class="line">  .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®æºåŠ¨ç”»"><a class="markdownIt-Anchor" href="#æ•°æ®æºåŠ¨ç”»"></a> æ•°æ®æºåŠ¨ç”»</h2><p>RxDataSources æä¾›äº†ä¸¤ç§ç‰¹æ®Šçš„æ•°æ®æºç±»å‹ï¼Œå®ƒä»¬å¯ä»¥è‡ªåŠ¨å¤„ç†ç»‘å®šæ•°æ®æºä¸­çš„åŠ¨ç”»å˜åŒ–ï¼š<code>RxTableViewSectionedAnimatedDataSource</code> å’Œ <code>RxCollectionViewSectionedAnimatedDataSource</code> ã€‚</p><p>è¦ä½¿ç”¨ä¸¤ä¸ªåŠ¨ç”»æ•°æ®æºä¹‹ä¸€ï¼Œä½ å¿…é¡»åœ¨ä¸Šè¿°æ¦‚è¿°çš„åŸºç¡€ä¸Šé‡‡å–ä¸€äº›é¢å¤–çš„æ­¥éª¤ï¼š</p><ul><li>SectionOfCustomDataéœ€è¦éµå®ˆ AnimatableSectionModelType åè®®</li><li>æ•°æ®æ¨¡å‹å¿…é¡»ç¬¦åˆ<ul><li>IdentifiableTypeï¼šIdentifiableType åè®®æä¾›çš„ <code>identity</code> å¿…é¡»æ˜¯è¡¨ç¤ºæ¨¡å‹å®ä¾‹çš„ä¸å¯å˜æ ‡è¯†ç¬¦(identifier)ã€‚ä¾‹å¦‚ï¼Œå¯¹äº Car æ¨¡å‹ï¼Œä½ å¯èƒ½è¦ä½¿ç”¨ Car çš„plateNumber ä½œä¸ºå…¶æ ‡è¯†ã€‚</li><li>Equatableï¼šéµä» Equatable åè®® æœ‰åŠ©äºRxDataSourcesç¡®å®šå“ªäº› cell å·²æ›´æ”¹ï¼Œå› æ­¤å®ƒåªèƒ½ä¸ºè¿™äº›ç‰¹å®š cell è®¾ç½®åŠ¨ç”»ã€‚è¿™æ„å‘³ç€ï¼Œæ›´æ”¹Caræ¨¡å‹çš„ä»»ä½•å±æ€§éƒ½ä¼šè§¦å‘è¯¥ cell çš„åŠ¨ç”»é‡æ–°åŠ è½½ã€‚</li></ul></li></ul><h2 id="éœ€è¦"><a class="markdownIt-Anchor" href="#éœ€è¦"></a> éœ€è¦</h2><p>Xcode 10.2</p><p>Swift 5.0</p><p>For Swift 4.x version please use versions 3.0.0 â€¦ 3.1.0 For Swift 3.x version please use versions 1.0 â€¦ 2.0.2 For Swift 2.3 version please use versions 0.1 â€¦ 0.9</p><h2 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h2><h3 id="cocoapods"><a class="markdownIt-Anchor" href="#cocoapods"></a> CocoaPods</h3><p>Podfile</p><blockquote><p>pod â€˜RxDataSourcesâ€™, â€˜~&gt; 4.0â€™</p></blockquote><h3 id="carthage"><a class="markdownIt-Anchor" href="#carthage"></a> Carthage</h3><p>Cartfile</p><blockquote><p>github â€œRxSwiftCommunity/RxDataSourcesâ€ ~&gt; 4.0</p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="ç¬¬ä¸‰æ–¹æ¡†æ¶" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
      <category term="RxSwift" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/RxSwift/"/>
    
    
      <category term="ç¿»è¯‘" scheme="https://changzw.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="RxSwift" scheme="https://changzw.github.io/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>ç®€åŒ–è®¾è®¡ App çš„è¿‡ç¨‹</title>
    <link href="https://changzw.github.io/2018/12/06/%E7%AE%80%E5%8C%96%E8%AE%BE%E8%AE%A1-App-%E7%9A%84%E8%BF%87%E7%A8%8B/"/>
    <id>https://changzw.github.io/2018/12/06/%E7%AE%80%E5%8C%96%E8%AE%BE%E8%AE%A1-App-%E7%9A%84%E8%BF%87%E7%A8%8B/</id>
    <published>2018-12-06T09:31:17.000Z</published>
    <updated>2020-05-06T10:18:58.018Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>ä¸€ä¸ª app åŸå‹&amp;éœ€æ±‚æ¥äº†ä»¥åï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿ<br>æœ¬æ¥ä¸€ä¸ªå®Œæˆçš„ä¸œè¥¿å¦‚ä½•æŠŠéœ€æ±‚ç¿»è¯‘æˆç¨‹åºå‘¢ï¼Ÿ</p><h2 id="æ­£å¸¸èŠ‚å¥"><a class="markdownIt-Anchor" href="#æ­£å¸¸èŠ‚å¥"></a> æ­£å¸¸èŠ‚å¥ï¼š</h2><ol><li>åˆ†æéœ€æ±‚<ol><li>åŸå‹åˆ†æ</li><li>éœ€æ±‚åˆ†æ</li></ol></li><li>æŠ€æœ¯ç‚¹è°ƒç ”åˆ†æ<ol><li>æ¶æ„æ–¹å¼</li><li>ä½¿ç”¨ä»€ä¹ˆæ¡†æ¶ï¼ˆæ¡†æ¶å¯¹æ¯”ï¼‰</li><li>View å±‚ä½¿ç”¨ä»€ä¹ˆæ¸²æŸ“æ–¹å¼ï¼ŒModelå±‚ä½¿ç”¨ä»€ä¹ˆç»„ä»¶ï¼Œä¸­é—´å±‚ä½¿ç”¨ä»€ä¹ˆå·¥å…·</li></ol></li><li>æ—¶é—´é¢„ä¼°<ol><li>æ–°æŠ€æœ¯å­¦ä¹ æ—¶é—´</li><li>å¼€å‘æ—¶é—´</li><li>è°ƒè¯•æ—¶é—´</li></ol></li></ol><h2 id="é‡åˆ°é—®é¢˜"><a class="markdownIt-Anchor" href="#é‡åˆ°é—®é¢˜"></a> é‡åˆ°é—®é¢˜</h2><ol><li>éœ€æ±‚é‡å¤§ï¼Œå¼ºè°ƒä»£ç çš„å¤ç”¨æ€§ï¼æ€è€ƒæ—¶é—´è¿‡é•¿</li><li>éœ€æ±‚ç†è§£é”™è¯¯ï¼Œç†è§£ä¸æ·±ï¼Œå·®å¼‚æ€§é—®é¢˜æ²¡æœ‰è§£å†³</li><li>æ–°æŠ€æœ¯ï¼Œç†Ÿç»ƒåº¦é—®é¢˜ï¼Œé”™è¯¯ä½¿ç”¨</li><li>æ²Ÿé€šé—®é¢˜ï¼</li></ol><h2 id="ç®€å•æ€è€ƒ"><a class="markdownIt-Anchor" href="#ç®€å•æ€è€ƒ"></a> ç®€å•æ€è€ƒ</h2><ol><li>ç®€åŒ–å¼€å‘æµç¨‹ï¼</li><li>App ç¼–ç è¿‡ç¨‹<ol><li>ç…§ç€ç”» UI</li><li>ç¡®å®šæ•°æ®æ¸²æŸ“æ–¹å¼ï¼</li><li>ç®€åŒ–è®© model å±‚æ•°æ®ä¼ åˆ° UI å±‚æ¸²æŸ“çš„è¿‡ç¨‹ï¼Œè®©æ°´æµé€šï¼ˆæˆ‘å–œæ¬¢çš„æ–¹å¼æ˜¯å‡½æ•°å“åº”å¼ rxï¼‰</li><li>æ•°æ®æµè¿æ¥å®Œæˆä»¥åï¼Œæ·»åŠ å„ç§é€»è¾‘<ol><li>å•é“¾é€»è¾‘</li><li>ä¸€æ¡æ¡åŠ </li><li>å¤ç”¨çš„åœ°æ–¹åœ¨å¤ç”¨</li></ol></li></ol></li><li>ä»£ç ä¸æ˜¯ä¸€ä¸‹å­å®Œç¾çš„ï¼<ol><li>å¼€å§‹çš„æ—¶å€™ä¸è¦å¤ªå¤æ‚</li><li>ä¸è¦ç”¨å¤ªé«˜ç«¯è‡ªå·±åˆä¸ç†Ÿæ‚‰çš„æŠ€å·§</li><li>é‡æ„ä¼˜åŒ–ä½¿ç”¨æ›´å¥½åœ°æŠ€æœ¯æ‰‹æ®µéƒ½æ˜¯è¿­ä»£çš„è¿‡ç¨‹</li></ol></li></ol><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="æ€è€ƒ" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/"/>
    
      <category term="å¼€å‘" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="å­¦ä¹ æ„Ÿæ‚Ÿ" scheme="https://changzw.github.io/tags/%E5%AD%A6%E4%B9%A0%E6%84%9F%E6%82%9F/"/>
    
  </entry>
  
  <entry>
    <title>viewController transitions</title>
    <link href="https://changzw.github.io/2018/11/06/viewController-transitions/"/>
    <id>https://changzw.github.io/2018/11/06/viewController-transitions/</id>
    <published>2018-11-06T09:21:48.000Z</published>
    <updated>2020-05-18T15:29:03.607Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>iOS ç³»ç»Ÿæä¾›äº†åƒ <code>push, pop, cover vertically</code> è¿™æ ·çš„ <code>ViewController</code> è¿‡æ¸¡ï¼Œè¯¥ç¯‡åˆ†æå¦‚ä½•è‡ªå®šä¹‰è‡ªå·±çš„ ViewController transitionsã€‚ä¸ºå•¥è¦å†™è¿™ä¸ªå› ä¸ºâ€œçœ‹ç€å¾ˆéº»çƒ¦â€ï¼Œæ¯”èµ· pushï¼Œpopï¼Œpresent æ¥è¯´â€¦â€¦</p><p>æ€è€ƒï¼š</p><ol><li>ViewController çš„ è¿‡æ¸¡æµç¨‹æ­¥éª¤æ˜¯ä»€ä¹ˆæ ·çš„</li><li>éƒ½æœ‰ä»€ä¹ˆç»„æˆï¼Œä»–ä»¬ä¹‹é—´çš„é€»è¾‘æ˜¯ä»€ä¹ˆæ ·çš„</li><li>ç”¨æˆ·å¦‚ä½•ä½¿ç”¨</li></ol><p>è¿‡æ¸¡çš„è¿‡ç¨‹ï¼Œåº”è¯¥æœ‰ï¼š</p><ol><li>è´Ÿè´£è§¦å‘äº‹ä»¶</li><li>è´Ÿè´£ç®¡ç†è¿‡æ¸¡åŠ¨ç”»</li><li>è´Ÿè´£è¿‡æ¸¡ç›¸å…³çš„ViewControllersï¼ŒViews</li></ol><h2 id="transitions-ç»“æ„"><a class="markdownIt-Anchor" href="#transitions-ç»“æ„"></a> transitions ç»“æ„</h2><p>transitioning API ä¸€ç»„ protocols ç»“åˆï¼Œå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰åŒ–ï¼Œä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„ transition å¯¹è±¡ or è‡ªå·±å®šä¹‰ä¸€ä¸ªæ–°çš„ã€‚<br><img src="/img/Transition-Frame.jpeg" alt="transitioning API"></p><p>Q: æ¯ä¸ªåè®®çš„è´£ä»»æ˜¯ä»€ä¹ˆï¼Ÿ<br>Q: æ‰§è¡Œæ­¥éª¤æ˜¯ä»€ä¹ˆ</p><h3 id="transitioning-delegate"><a class="markdownIt-Anchor" href="#transitioning-delegate"></a> Transitioning Delegate</h3><p>æ¯ä¸ª ViewController éƒ½æœ‰å¯¹è±¡â€”â€” <code>transitioningDelegate: UIViewControllerTransitioningDelegate</code> ç”¨æ¥å¾—åˆ° Animation controller å¯¹è±¡</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CardViewController</span>: <span class="title">UIViewControllerTransitioningDelegate</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">animationController</span><span class="params">(forPresented presented: UIViewController, presenting: UIViewController, source: UIViewController)</span></span> -&gt; <span class="type">UIViewControllerAnimatedTransitioning?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">FlipPresentAnimationController</span>(originFrame: cardView.frame)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä½  present or dismiss <code>ViewController</code> çš„æ—¶å€™ï¼ŒUIKit ä¼šå‘ <code>transitioningDelegate</code> è¦ä½ è‡ªå®šä¹‰çš„ <code>Animation controller</code> æ¥æ›¿ä»£é»˜è®¤åŠ¨ç”»ã€‚ä½ è¦åšçš„æ˜¯å®ç° <code>UIViewControllerTransitioningDelegate</code> ä»£ç†æ–¹æ³•è¿”å› <code>Animation controller</code></p><h3 id="animation-controller"><a class="markdownIt-Anchor" href="#animation-controller"></a> Animation Controller</h3><p>ç”¨æ¥åšè¿‡æ¸¡åŠ¨ç”»ï¼Œä»–å®ç°è‡ª <code>UIViewControllerAnimatedTransitioning</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlipPresentAnimationController</span>: <span class="title">NSObject</span>,<span class="title">UIViewControllerAnimatedTransitioning</span> </span>&#123;</span><br><span class="line"><span class="comment">// è®¾ç½®åŠ¨ç”»æ—¶é—´</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">transitionDuration</span><span class="params">(using transitionContext: UIViewControllerContextTransitioning?)</span></span> -&gt; <span class="type">TimeInterval</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.6</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ä»UIViewControllerContextTransitioning ä¸­å¾—åˆ° toVc &amp; fromVcï¼Œå¯¹å…¶åˆ¶ä½œåŠ¨ç”»</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">animateTransition</span><span class="params">(using transitionContext: UIViewControllerContextTransitioning)</span></span> &#123;</span><br><span class="line">    <span class="comment">//1 é€šè¿‡ transitionContext å¾—åˆ° fromVC æ˜¯è§¦å‘ presentçš„VCï¼ŒtoVC æ˜¯è¦è¢«å‘ˆç°çš„ VCï¼ŒsnapShotï¼Œæ˜¯toVC å‘ˆç°ä»¥åçš„view æˆªå›¾ç”¨äºåšåŠ¨ç”»</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> fromVC = transitionContext.viewController(forKey: .from),</span><br><span class="line">      <span class="keyword">let</span> toVC = transitionContext.viewController(forKey: .to),</span><br><span class="line">      <span class="keyword">let</span> snapshot = toVC.view.snapshotView(afterScreenUpdates: <span class="literal">true</span>)</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//containerView æ˜¯è¿‡æ¸¡è¿‡ç¨‹ä¸­çš„å®¹å™¨ view</span></span><br><span class="line">    <span class="keyword">let</span> containerView = transitionContext.containerView</span><br><span class="line">    <span class="keyword">let</span> finalFrame = transitionContext.finalFrame(<span class="keyword">for</span>: toVC)</span><br><span class="line"></span><br><span class="line">    snapshot.frame = originFrame</span><br><span class="line">    snapshot.layer.cornerRadius = <span class="type">CardViewController</span>.cardCornerRadius</span><br><span class="line">    snapshot.layer.masksToBounds = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    containerView.addSubview(toVC.view)</span><br><span class="line">    containerView.addSubview(snapshot)</span><br><span class="line">    toVC.view.isHidden = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="type">AnimationHelper</span>.perspectiveTransform(<span class="keyword">for</span>: containerView)</span><br><span class="line">    snapshot.layer.transform = <span class="type">AnimationHelper</span>.yRotation(.pi / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">let</span> duration = transitionDuration(using: transitionContext)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹ view åšåŠ¨ç”»å¤„ç†</span></span><br><span class="line">    <span class="type">UIView</span>.animateKeyframes(</span><br><span class="line">      withDuration: duration,</span><br><span class="line">      delay: <span class="number">0</span>,</span><br><span class="line">      options: .calculationModeCubic,</span><br><span class="line">      animations: &#123;</span><br><span class="line">        <span class="type">UIView</span>.addKeyframe(withRelativeStartTime: <span class="number">0.0</span>, relativeDuration: <span class="number">1</span>/<span class="number">3</span>) &#123;</span><br><span class="line">          fromVC.view.layer.transform = <span class="type">AnimationHelper</span>.yRotation(-.pi / <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UIView</span>.addKeyframe(withRelativeStartTime: <span class="number">1</span>/<span class="number">3</span>, relativeDuration: <span class="number">1</span>/<span class="number">3</span>) &#123;</span><br><span class="line">          snapshot.layer.transform = <span class="type">AnimationHelper</span>.yRotation(<span class="number">0.0</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UIView</span>.addKeyframe(withRelativeStartTime: <span class="number">2</span>/<span class="number">3</span>, relativeDuration: <span class="number">1</span>/<span class="number">3</span>) &#123;</span><br><span class="line">          snapshot.frame = finalFrame</span><br><span class="line">          snapshot.layer.cornerRadius = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">      completion: &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">        toVC.view.isHidden = <span class="literal">false</span></span><br><span class="line">        snapshot.removeFromSuperview()</span><br><span class="line">        fromVC.view.layer.transform = <span class="type">CATransform3DIdentity</span></span><br><span class="line">        transitionContext.completeTransition(!transitionContext.transitionWasCancelled)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç®€è¿°"><a class="markdownIt-Anchor" href="#ç®€è¿°"></a> ç®€è¿°</h2><p>å¯¹äºéœ€è¦è‡ªå®šä¹‰çš„ transitioning çš„ ViewControllerï¼ŒCustomViewController</p><ol><li>CustomViewController: UIViewControllerTransitioningDelegate å®ç°åè®®</li><li>å®ç°åè®®çš„</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">animationController(presented:, presenting:, source:) -&gt; <span class="type">UIViewControllerAnimatedTransitioning</span></span><br><span class="line">animationController(dismiss:) -&gt; <span class="type">UIViewControllerAnimatedTransitioning</span></span><br></pre></td></tr></table></figure><ol start="3"><li>è‡ªå®šä¹‰ Animation Controllerï¼ˆCustomeAnimationController: UIViewControllerAnimatedTransitioning)</li><li>å®ç° UIViewControllerAnimatedTransitioning ä¸­çš„</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transitionDuration(using transitionContext: <span class="type">UIViewControllerContextTransitioning?</span>) -&gt; <span class="type">TimeInterval</span></span><br><span class="line">animateTransition(transitionContext:)</span><br></pre></td></tr></table></figure><h2 id="ç»™-dismiss-æ·»åŠ æ‰‹åŠ¿äº¤äº’"><a class="markdownIt-Anchor" href="#ç»™-dismiss-æ·»åŠ æ‰‹åŠ¿äº¤äº’"></a> ç»™ dismiss æ·»åŠ æ‰‹åŠ¿äº¤äº’</h2><p><img src="https://koenig-media.raywenderlich.com/uploads/2015/07/settings.gif" alt=""></p><blockquote><p><a href="https://www.raywenderlich.com/322-custom-uiviewcontroller-transitions-getting-started#toc-anchor-011" target="_blank" rel="noopener">Custom UIViewController Transitions: Getting Started</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="iOS Programming" scheme="https://changzw.github.io/categories/iOS-Programming/"/>
    
    
      <category term="iOS" scheme="https://changzw.github.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>App æ¶æ„</title>
    <link href="https://changzw.github.io/2018/09/18/architecture/App-%E6%9E%B6%E6%9E%84/"/>
    <id>https://changzw.github.io/2018/09/18/architecture/App-%E6%9E%B6%E6%9E%84/</id>
    <published>2018-09-18T02:28:02.000Z</published>
    <updated>2020-04-25T02:45:36.292Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><p>objc ã€ŠApp æ¶æ„ã€‹ ç¬”è®°</p><h2 id="å¦‚ä½•è®¾è®¡æ¶æ„"><a class="markdownIt-Anchor" href="#å¦‚ä½•è®¾è®¡æ¶æ„"></a> å¦‚ä½•è®¾è®¡æ¶æ„</h2><ol><li>ç¡®å®šæ¨¡å—ï¼ˆModel å±‚ï¼ŒView å±‚ï¼Œåè°ƒå™¨â€¦â€¦ï¼‰<ol><li>å¦‚ä½•ç¡®å®šæ¨¡å—ï¼Ÿè”æƒ³å®é™…åœºæ™¯ï¼Œåˆ†æè´£ä»»ã€è¡Œä¸ºï¼Œç¡®å®šæ¨¡å—ï¼ï¼</li><li>ä¸ºä»€ä¹ˆè¦ç¡®å®šæ¨¡å—ï¼Ÿç¡®å®šæ¨¡å—åï¼Œç¨‹åºä¸ä¼šè¢«åº”ç”¨æ¡†æ¶ä¸­çš„å®ç°ç»†èŠ‚æ‰€æ”¯é…</li></ol></li><li>æ¨¡å—é—´çš„è”ç³»ï¼Œä¾èµ–ï¼Œå˜æ¢ï¼Œé€šçŸ¥è¡Œä¸ºå¦‚ä½•å®šä¹‰ã€‚<ol><li>å°½å¯èƒ½è®©æ•°æ®æµå‘å•å‘æ¸…æ™°</li><li>ç¡®å®šæ•°æ®æµå‘è¡Œä¸ºç»Ÿä¸€ä¸€è‡´ï¼Œç»Ÿä¸€ç¨‹åºå¼€å‘ç»´æŠ¤<ol><li>delegateï¼Œnotificationï¼Œblockï¼Œkvoï¼ŒRxâ€¦â€¦</li></ol></li></ol></li></ol><h2 id="mvc"><a class="markdownIt-Anchor" href="#mvc"></a> MVC</h2><p><img src="/img/MVC.jpeg" alt="mvc"></p><p>Model å±‚åŒ…æ‹¬ï¼Œdata modelå’Œserver model<br>controlerï¼šå¼•ç”¨ server model</p><h2 id="mvvm-c"><a class="markdownIt-Anchor" href="#mvvm-c"></a> MVVM-C</h2><p><img src="/img/mvvm-c.jpeg" alt="mvvm-c"></p><h2 id="ç½‘ç»œ"><a class="markdownIt-Anchor" href="#ç½‘ç»œ"></a> ç½‘ç»œ</h2><h2 id="mvcviewstate"><a class="markdownIt-Anchor" href="#mvcviewstate"></a> MVC+ViewState</h2><p><img src="/img/mvc-viewstate.jpeg" alt="mvc-viewstate"></p><h2 id="model-é€‚é…å™¨-view-ç»‘å®šå™¨"><a class="markdownIt-Anchor" href="#model-é€‚é…å™¨-view-ç»‘å®šå™¨"></a> Model é€‚é…å™¨ + View ç»‘å®šå™¨</h2><h2 id="elm-æ¶æ„"><a class="markdownIt-Anchor" href="#elm-æ¶æ„"></a> Elm æ¶æ„</h2><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="è®¾è®¡æ€æƒ³" scheme="https://changzw.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/"/>
    
    
      <category term="è®¾è®¡æ€æƒ³" scheme="https://changzw.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>â€œTâ€ å­—æ¨¡å‹</title>
    <link href="https://changzw.github.io/2018/08/24/%E5%BC%80%E5%8F%91%E4%B8%8A%E7%9A%84%E6%80%9D%E8%80%83/"/>
    <id>https://changzw.github.io/2018/08/24/%E5%BC%80%E5%8F%91%E4%B8%8A%E7%9A%84%E6%80%9D%E8%80%83/</id>
    <published>2018-08-24T07:30:54.000Z</published>
    <updated>2020-04-25T03:03:14.403Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="æ¶æ„çš„æ—¶å€™å®¹æ˜“ä¹±ä½¿ç”¨-t-å­—æ¨¡å‹æ€è€ƒ"><a class="markdownIt-Anchor" href="#æ¶æ„çš„æ—¶å€™å®¹æ˜“ä¹±ä½¿ç”¨-t-å­—æ¨¡å‹æ€è€ƒ"></a> æ¶æ„çš„æ—¶å€™å®¹æ˜“ä¹±â€”â€”ä½¿ç”¨ â€œTâ€ å­—æ¨¡å‹æ€è€ƒ</h2><p>åŸå› ï¼š<br>æ¶æ„ä»£ç çš„æ—¶å€™ï¼Œæ€»æƒ³æœ‰æ²¡æœ‰æ›´å¥½åœ°è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä½•å°½å¯èƒ½çš„æ¨¡å—è§£è€¦ï¼Œè´£ä»»å•ä¸€â€¦â€¦ï¼Œå¦‚ä½•æŸ¥åˆ†ç±»ï¼Œæ¶æ„ä¸­éœ€è¦æœ‰ä»€ä¹ˆæ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨ä»€ä¹ˆå·¥å…·é“¾â€¦â€¦</p><p>å¯æ˜¯ä¸€ä¸‹å­æŠŠæ‰€æœ‰é—®æ”¾åœ¨ä¸€èµ·ï¼Œæ•´ä¸ªäººå¾ˆå¤šæ—¶å€™ä¼šä¹±ï¼Œè€Œä¸”æƒ³çš„è¶Šå¤šè¶Šä¹±</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ç®€å•åŒ–æ¨¡å—ï¼Œç°æœ‰æœ€åŸºæœ¬çš„æ¡†æ¶ eg MVVMï¼ŒMVC</li><li>æŠŠæœ€ç®€å•çš„æ¨¡å‹å…ˆæ­å»ºèµ·æ¥ï¼Œç„¶åå®ç°ä¸€ä¸ªä¸»æµç¨‹åŠŸèƒ½</li><li>æ¥ç€åœ¨å®ç°å…¶ä»–ä¸»æµç¨‹åŠŸèƒ½</li><li>æƒ³æƒ³å¯ä»¥æ·»åŠ é‚£äº› æ¨¡å—ç»„ä»¶ è®©è‡ªå·±çš„æ¶æ„æ›´åŠ ä¼˜ç¾</li><li>é‡æ„ï¼Œç„¶åå†å…ˆæœ‰ä¸ªä¸»æµç¨‹çº¿</li></ol><p>æ€»ç»“ï¼š</p><ol><li>ç°æœ‰è¦åšçš„ä¸œè¥¿æœ‰ä¸ª å¤–åœ¨çš„æ•´ä½“è®¤è¯†ï¼Œæƒ³ç»™ç”¨æˆ·æä¾›ä»€ä¹ˆ æ¥å£ï¼</li><li>å…ˆå®ç°ä¸€ä¸ªæ¥å£çš„åŠŸèƒ½ï¼Œç„¶åå†æŠŠæ‰€æœ‰çº¿çš„å®ç°å‡ºæ¥</li><li>é‡æ„</li></ol><p>æ•´ä½“æ€æƒ³æ–¹å¼ æ˜¯ â€œTâ€ å­—æ€è€ƒ</p><h2 id="æ¨¡å—ç»„ä»¶é—´äº¤äº’ç¹æ‚-ä¸ºä»€ä¹ˆæœ‰-ä¸­ä»‹è€…"><a class="markdownIt-Anchor" href="#æ¨¡å—ç»„ä»¶é—´äº¤äº’ç¹æ‚-ä¸ºä»€ä¹ˆæœ‰-ä¸­ä»‹è€…"></a> æ¨¡å—ç»„ä»¶é—´äº¤äº’ç¹æ‚â€”â€” ä¸ºä»€ä¹ˆæœ‰ ä¸­ä»‹è€…</h2><ol><li>ç¨‹åºè°ƒç”¨æµç¨‹æ˜¯çº¿æ€§çš„ï¼Œæ€ç»´æ··ä¹±çš„ç¨‹åºå‘˜å¾ˆå®¹æ˜“æŠŠè¿™æ¡çº¿æçš„æ‚ä¹±æ— ç« ï¼Œè™½ç„¶å¯ä»¥è®©ç¨‹åºè·‘èµ·æ¥ï¼Œå¯æ˜¯ç»´æŠ¤è´¹åŠ²</li><li>ä¸­ä»‹è€…ï¼šæ¨¡å—ä¸­æä¾›ä¸­ä»‹è€…ï¼Œå®šä¹‰ä¸€ç§ç¼–ç¨‹è§„èŒƒï¼Œä½¿ç”¨ ä¸­ä»‹è€… è®©ä»£ç åˆ†ç±»ï¼Œè¿™æ ·æŠŠæ¨¡å—å‡å°‘ï¼Œå‡å°‘æ‚ä¹±çš„çº¿ï¼Œè¿™äº›çº¿æ”¾åœ¨ä¸­ä»‹è€…ä¸­</li></ol><p><img src="/img/meditator_chaos.jpg" alt="chaos"><br><img src="/img/meditator_order.jpg" alt="order"></p><p>ä¸­ä»‹è€…â€”â€” åƒä¸ªç®¡ç†è€…ä¸€æ ·ï¼Œåœ¨å®é™…ä¸­è°ƒåº¦å„ä¸ªéƒ¨é—¨ï¼Œéƒ¨é—¨æœ‰ä»€ä¹ˆé—®é¢˜æƒ³ä¸­ä»‹è€…æ±‡æŠ¥</p><p>å¦‚æœæ²¡æœ‰ä¸­ä»‹è€…â€”â€”ç®¡ç†è€…ï¼Œé‚£ä¹ˆ éƒ¨é—¨ä¹‹é—´é—®é¢˜ç›¸äº’ç©¿æ’ orz</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="æ€è€ƒ" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/"/>
    
      <category term="å¼€å‘" scheme="https://changzw.github.io/categories/%E6%80%9D%E8%80%83/%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="å­¦ä¹ æ„Ÿæ‚Ÿ" scheme="https://changzw.github.io/tags/%E5%AD%A6%E4%B9%A0%E6%84%9F%E6%82%9F/"/>
    
  </entry>
  
  <entry>
    <title>RxSwift æºç åˆ†æ</title>
    <link href="https://changzw.github.io/2018/08/18/RxSwfit+RAC/RxSwift-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>https://changzw.github.io/2018/08/18/RxSwfit+RAC/RxSwift-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</id>
    <published>2018-08-18T08:56:26.000Z</published>
    <updated>2020-04-25T02:21:11.915Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><p><img src="/img/RxSwift001.jpg" alt="frame"></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;&lt;p&gt;&lt;img src=&quot;/img/RxSwift001.jpg&quot; alt=&quot;frame&quot;&gt;&lt;/p&gt;&lt;!-- rebuild by neat --&gt;
      
    
    </summary>
    
    
      <category term="ç¬¬ä¸‰æ–¹æ¡†æ¶" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
      <category term="RxSwift" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/RxSwift/"/>
    
    
      <category term="æºç " scheme="https://changzw.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="RxSwift" scheme="https://changzw.github.io/tags/RxSwift/"/>
    
  </entry>
  
  <entry>
    <title>å…³è”å¯¹è±¡</title>
    <link href="https://changzw.github.io/2018/07/01/deep%20analyse/%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/"/>
    <id>https://changzw.github.io/2018/07/01/deep%20analyse/%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/</id>
    <published>2018-07-01T14:32:13.000Z</published>
    <updated>2020-04-25T02:55:18.668Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="å…³è”å¯¹è±¡æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#å…³è”å¯¹è±¡æ˜¯ä»€ä¹ˆ"></a> å…³è”å¯¹è±¡æ˜¯ä»€ä¹ˆ</h2><ul><li>ä»–æ˜¯ objective-c runtime æœºåˆ¶ä¸­æä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œè®©ç”¨æˆ·åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€çš„ç»™ç±»æ·»åŠ å…³è”å±æ€§</li></ul><h2 id="å…³è”å¯¹è±¡çš„ä¸»è¦ä½œç”¨"><a class="markdownIt-Anchor" href="#å…³è”å¯¹è±¡çš„ä¸»è¦ä½œç”¨"></a> å…³è”å¯¹è±¡çš„ä¸»è¦ä½œç”¨</h2><p>å¼€å‘ä¸­å¦‚ä½•ç»™ category æ·»åŠ æˆå‘˜å±æ€§å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå¦‚ä½•åœ¨è¿è¡Œæ—¶ç»™ class å…³è”æ–°çš„å±æ€§ï¼Ÿ</p><ul><li>ä¸»è¦ä½œç”¨ï¼šç»™category æ·»åŠ æˆå‘˜å˜é‡<ul><li>category åº•å±‚ç»“æ„çš„é™åˆ¶ï¼Œä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡åˆ°åˆ†ç±»ä¸­ã€‚ä½†å¯ä»¥é€šè¿‡å…³è”å¯¹è±¡æ¥é—´æ¥æ·»åŠ ã€‚</li><li>åˆ†ç±»ä¸­çš„ @property åªèƒ½å£°æ˜å±æ€§ï¼Œä¸æä¾› _name, getName, setName çš„å®ç°</li><li>ç±»ä¸­ @property æä¾› _name, getName, setName çš„å®ç°</li></ul></li></ul><h2 id="å¦‚ä½•ä½¿ç”¨å…³è”å¯¹è±¡å‘¢"><a class="markdownIt-Anchor" href="#å¦‚ä½•ä½¿ç”¨å…³è”å¯¹è±¡å‘¢"></a> å¦‚ä½•ä½¿ç”¨å…³è”å¯¹è±¡å‘¢</h2><h3 id="å…³è”å¯¹è±¡æ¥å£"><a class="markdownIt-Anchor" href="#å…³è”å¯¹è±¡æ¥å£"></a> å…³è”å¯¹è±¡æ¥å£</h3><p><code>&lt;objc/runtime.h&gt;</code> ä¸­å®šä¹‰çš„ä»¥ä¸‹ä¸‰ä¸ªå…è®¸ä½ å°†ä»»ä½•é”®å€¼åœ¨è¿è¡Œæ—¶å…³è”åˆ°å¯¹è±¡ä¸Šçš„å‡½æ•°ï¼š</p><ul><li>objc_setAssociatedObject</li><li>objc_getAssociatedObject</li><li>objc_removeAssociatedObjects</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">object   :è¡¨ç¤ºå…³è”è€…ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå˜é‡åç†æ‰€å½“ç„¶ä¹Ÿæ˜¯object</span></span><br><span class="line"><span class="comment">key      :è·å–è¢«å…³è”è€…çš„ç´¢å¼•key</span></span><br><span class="line"><span class="comment">value    :è¢«å…³è”è€…</span></span><br><span class="line"><span class="comment">policy   :å…³è”æ—¶é‡‡ç”¨çš„åè®®ï¼Œæœ‰assignï¼Œretainï¼Œcopyç­‰åè®®ï¼Œä¸€èˆ¬ä½¿ç”¨OBJC_ASSOCIATION_RETAIN_NONATOMIC </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">id <span class="title">objc_getAssociatedObject</span><span class="params">(id object, <span class="keyword">const</span> <span class="keyword">void</span> *key)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">objc_setAssociatedObject</span><span class="params">(id object, <span class="keyword">const</span> <span class="keyword">void</span> *key, id value, objc_AssociationPolicy policy)</span></span>;</span><br><span class="line"><span class="comment">//ç§»é™¤æŸä¸ªå¯¹è±¡èº«ä¸Šçš„æ‰€æœ‰å…³è”çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">objc_removeAssociatedObjects</span><span class="params">(id object)</span></span></span><br></pre></td></tr></table></figure><h2 id="å®é™…ä½¿ç”¨æ•ˆæœ"><a class="markdownIt-Anchor" href="#å®é™…ä½¿ç”¨æ•ˆæœ"></a> å®é™…ä½¿ç”¨æ•ˆæœ</h2><p>å¯¹æ¯”å­—å…¸å®ç°ç»™åˆ†ç±»æ·»åŠ  property</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Banana</span> (<span class="title">Test</span>)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> weight;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define Key [NSString stringWithFormat:@<span class="meta-string">"%p"</span>, self]</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Banana</span> (<span class="title">Test</span>)</span></span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *names_;</span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *weights_;</span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    weights_ = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    names_ = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)name &#123;</span><br><span class="line">    names_[Key] = name;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *)name &#123;</span><br><span class="line">    <span class="keyword">return</span> names_[Key];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setWeight:(<span class="keyword">int</span>)weight &#123;</span><br><span class="line">    weights_[Key] = @(weight);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">int</span>)weight &#123;</span><br><span class="line">    <span class="keyword">return</span> [weights_[Key] intValue];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä½¿ç”¨å…¨å±€å­—å…¸çš„æ–¹å¼ï¼Œç»™åˆ†ç±»ä¸­çš„æˆå‘˜å˜é‡æ·»åŠ getï¼Œset å®ç°ä½“</p><p>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å…³è”å¯¹è±¡å‘¢ï¼Ÿ</p><ul><li>å…³è”å¯¹è±¡å®ç°åˆ†ç±»æ·»åŠ æˆå‘˜å±æ€§</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Banana</span> (<span class="title">Test</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)name&#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(name), name, OBJC_ASSOCIATION_COPY_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *)name &#123;</span><br><span class="line">    <span class="comment">// éšå¼å‚æ•°_cmd == @selector(name)</span></span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, _cmd);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setWeight:(<span class="keyword">int</span>)weight &#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(weight), @(weight), OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">int</span>)weight &#123;</span><br><span class="line">    <span class="keyword">return</span> [objc_getAssociatedObject(<span class="keyword">self</span>, _cmd) intValue];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h2 id="å…³è”å¯¹è±¡æºç åˆ†æ"><a class="markdownIt-Anchor" href="#å…³è”å¯¹è±¡æºç åˆ†æ"></a> å…³è”å¯¹è±¡æºç åˆ†æ</h2><p>å…³è”å¯¹è±¡ä¹Ÿæ˜¯ç”¨å…¨å±€ hash è¡¨æ¥ä¿å­˜çš„ã€‚<br><a href="https://opensource.apple.com/tarballs/objc4/objc4-779.1.tar.gz" target="_blank" rel="noopener">objc4-779.1æºç </a> è¿™ä¸ªæ–‡ä»¶ä¸­ <a href="http://objc-references.mm" target="_blank" rel="noopener">objc-references.mm</a></p><p>å…³è”å¯¹è±¡çš„æ ¸å¿ƒç±»</p><div align="left"><img src="/img/ao.jpeg" style="width:800px;height:370px"></div><ul><li>AssociationsManager</li><li>AssociationsHashMap</li><li>ObjectAssociationMap</li><li>ObjcAssociation</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssociationsManager</span> &#123;</span></span><br><span class="line">  <span class="comment">// associative references: object pointer -&gt; PtrPtrHashMap.</span></span><br><span class="line">  <span class="keyword">static</span> AssociationsHashMap *_map;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssociationsHashMap</span> :</span> <span class="keyword">public</span> <span class="built_in">unordered_map</span>&lt;<span class="keyword">disguised_ptr_t</span>, ObjectAssociationMap *, DisguisedPointerHash, DisguisedPointerEqual, AssociationsHashMapAllocator&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectAssociationMap</span> :</span> <span class="keyword">public</span> <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">void</span> *, ObjcAssociation, ObjectPointerLess, ObjectAssociationMapAllocator&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjcAssociation</span> &#123;</span></span><br><span class="line">  <span class="keyword">uintptr_t</span> _policy;</span><br><span class="line">  id _value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å…³è”å¯¹è±¡ä½•æ—¶é‡Šæ”¾"><a class="markdownIt-Anchor" href="#å…³è”å¯¹è±¡ä½•æ—¶é‡Šæ”¾"></a> å…³è”å¯¹è±¡ä½•æ—¶é‡Šæ”¾</h3><p>â€¦â€¦ ä¸æƒ³çœ‹äº†ï¼Œæƒ³çœ‹äº†å†è¡¥å……ï¼Œæ€»ä¹‹ä»–åœ¨æ‰€å…³è”çš„å¯¹è±¡é‡Šæ”¾åï¼Œä¼šé‡Šæ”¾çš„</p><h3 id="å…³è”æ—¶é‡‡ç”¨çš„åè®®"><a class="markdownIt-Anchor" href="#å…³è”æ—¶é‡‡ç”¨çš„åè®®"></a> å…³è”æ—¶é‡‡ç”¨çš„åè®®</h3><table><thead><tr><th>Behavior</th><th>@property Equivalent</th><th>Description</th></tr></thead><tbody><tr><td>OBJC_ASSOCIATION_ASSIGN</td><td>@property (assign) æˆ– @property (unsafe_unretained)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_RETAIN_NONATOMIC</td><td>@property (nonatomic, strong)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œä¸èƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_COPY_NONATOMIC</td><td>@property (nonatomic, copy)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„copyå¼•ç”¨ï¼Œä¸èƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_RETAIN</td><td>@property (atomic, strong)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œèƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_COPY</td><td>@property (atomic, copy)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„copyå¼•ç”¨ï¼Œèƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr></tbody></table><h2 id="å®é™…ä¸­ä½¿ç”¨å…³è”å¯¹è±¡çš„ä¾‹å­"><a class="markdownIt-Anchor" href="#å®é™…ä¸­ä½¿ç”¨å…³è”å¯¹è±¡çš„ä¾‹å­"></a> å®é™…ä¸­ä½¿ç”¨å…³è”å¯¹è±¡çš„ä¾‹å­</h2><p><a href="https://changzw.github.io/2020/03/08/%E4%BD%BF%E7%94%A8-closures-%E6%B7%BB%E5%8A%A0-Gesture-Recognizers/">ä½¿ç”¨ closures æ·»åŠ  Gesture Recognizers</a></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="iOS Programming" scheme="https://changzw.github.io/categories/iOS-Programming/"/>
    
      <category term="objc" scheme="https://changzw.github.io/categories/iOS-Programming/objc/"/>
    
      <category term="runtime" scheme="https://changzw.github.io/categories/iOS-Programming/objc/runtime/"/>
    
    
      <category term="objc" scheme="https://changzw.github.io/tags/objc/"/>
    
  </entry>
  
  <entry>
    <title>swift åºåˆ—åŒ–Codable</title>
    <link href="https://changzw.github.io/2018/05/10/swift-%E5%BA%8F%E5%88%97%E5%8C%96Codable/"/>
    <id>https://changzw.github.io/2018/05/10/swift-%E5%BA%8F%E5%88%97%E5%8C%96Codable/</id>
    <published>2018-05-10T02:10:46.000Z</published>
    <updated>2020-04-25T02:48:33.269Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2><p>åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹(å¯¹è±¡&lt;â€“&gt;I/Oæµ)ã€‚<br>å¯¹è±¡ä¿¡æ¯åºåˆ—åŒ–ä»¥åå˜æˆ I/O æµï¼š</p><ol><li>å¯ä»¥æœ¬åœ°åŒ–å­˜å‚¨ï¼ˆæŒä¹…åŒ–å¯¹è±¡ï¼‰</li><li>ç½‘ç»œé€šè®¯ï¼ˆç½‘ç»œä¼ è¾“å¯¹è±¡ï¼‰</li><li>å®šåˆ¶åè®®ï¼Œè·¨å¹³å°ã€è·¨è¯­è¨€é€šè®¯</li></ol><h2 id="swift-ä¸­çš„åºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#swift-ä¸­çš„åºåˆ—åŒ–"></a> Swift ä¸­çš„åºåˆ—åŒ–</h2><ol><li>Swift 4.0 ä¹‹å‰ä»éœ€è¦æ‰‹åŠ¨è§£æ</li><li>Swift 4.0 ä»¥åï¼Œæä¾› Codable åè®®</li><li>ä»ç„¶å­˜åœ¨é—®é¢˜</li></ol><h3 id="æ²¡æœ‰encoderå’Œdecoder"><a class="markdownIt-Anchor" href="#æ²¡æœ‰encoderå’Œdecoder"></a> æ²¡æœ‰Encoderå’ŒDecoder</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> json: [<span class="type">String</span> : <span class="type">Any</span>] = [</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"cap"</span>,</span><br><span class="line">  <span class="string">"points"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"this is a cat"</span>,</span><br><span class="line">]</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> points: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">var</span> description: <span class="type">String?</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// éœ€è¦æ‰‹åŠ¨è§£æ</span></span><br><span class="line">  <span class="keyword">init</span>?(json: [<span class="type">String</span>: <span class="type">Any</span>]) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> name = json[<span class="string">"name"</span>] <span class="keyword">as</span>? <span class="type">String</span>,</span><br><span class="line">      <span class="keyword">let</span> points = json[<span class="string">"points"</span>] <span class="keyword">as</span>? <span class="type">Int</span>,</span><br><span class="line">      <span class="keyword">let</span> description = json[<span class="string">"description"</span>] <span class="keyword">as</span>? <span class="type">String</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    <span class="keyword">self</span>.name = name</span><br><span class="line">    <span class="keyword">self</span>.points = points</span><br><span class="line">    <span class="keyword">self</span>.description = description</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> p = <span class="type">Product</span>(json: json) &#123;</span><br><span class="line">  <span class="built_in">print</span>(p.name + <span class="string">" \(p.points) "</span> + p.description!)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç¼–ç å™¨ç±»å‹éµå¾ª-codableencodable-decodable-åè®®"><a class="markdownIt-Anchor" href="#ä½¿ç”¨ç¼–ç å™¨ç±»å‹éµå¾ª-codableencodable-decodable-åè®®"></a> ä½¿ç”¨ç¼–ç å™¨ï¼Œç±»å‹éµå¾ª Codable(Encodable &amp; Decodable) åè®®</h3><ol><li>ç±»å‹éµå¾ªCodable</li><li>Encode</li><li>Decode</li></ol><p>2017å¹´6æœˆå‘å¸ƒçš„ Swift4.0 ä¸­çš„ Codable(Encodable &amp; Decodable) åè®®ï¼Œè¡¨æ˜è¯¥åè®®å…·æœ‰è¢«åºåˆ—åŒ–å’Œ/æˆ–ååºåˆ—åŒ–çš„èƒ½â¼’ã€‚<br>Swift æ ‡å‡†åº“ä¸­çš„æ‰€æœ‰åŸºæœ¬ç±»å‹éƒ½éµå¾ª <code>Codable</code> åè®®ï¼Œ<code>Dataï¼ŒDateï¼Œ URLï¼ŒCGPoint å’Œ CGRect</code> åœ¨å†…çš„è®¸å¤š Apple æ¡†æ¶ä¸­çš„å¸¸â½¤æ•°æ®ç±»å‹ï¼Œä¹Ÿå·²ç»é€‚é…äº† Codableã€‚<br>è‡ªå®šä¹‰ç±»å‹éœ€è¦ç”¨æˆ·éµå¾ª Codableåè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Codable</span> = <span class="type">Decodable</span> &amp; <span class="type">Encodable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// æŸä¸ªç±»å‹å¯ä»¥å°†â¾ƒèº«ç¼–ç ä¸ºâ¼€ç§å¤–éƒ¨è¡¨ç¤º</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Encodable</span> </span>&#123; <span class="comment">/// å°†å€¼ç¼–ç åˆ°ç»™å®šçš„ encoder ä¸­</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(to encoder: Encoder)</span></span> <span class="keyword">throws</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// æŸä¸ªç±»å‹å¯ä»¥ä»å¤–éƒ¨è¡¨ç¤ºä¸­è§£ç å¾—åˆ°â¾ƒèº«</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Decodable</span> </span>&#123; <span class="comment">/// é€šè¿‡ä»ç»™å®šçš„ decoder ä¸­è§£ç æ¥åˆ›å»ºæ–°çš„å®ä¾‹</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(from decoder: <span class="type">Decoder</span>) <span class="keyword">throws</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â¼€æ—¦ä½ æ‹¥æœ‰ codable ç±»å‹çš„å€¼ï¼Œä½ å¯ä»¥åˆ›å»ºâ¼€ä¸ªç¼–ç å™¨ï¼Œå¹¶è®©å®ƒå°†è¿™ä¸ªå€¼è½¬æ¢åˆ°åƒæ˜¯ JSON è¿™æ ·çš„åºåˆ—åŒ–æ ¼å¼ã€‚åè¿‡æ¥ï¼Œâ¼€ä¸ªè§£ç å™¨å¯ä»¥å°†åºåˆ—åŒ–åçš„æ•°æ®è½¬å›ä¸ºå®ƒåŸæ¥ç±»å‹çš„â¼€ä¸ªå®ä¾‹ã€‚</p><p>Swift â¾ƒå¸¦ä¸¤å¥—ç¼–ç è§£ç å™¨ï¼Œ<code>JSONEncoder/JSONDecoder</code> å’Œ <code>PropertyListEncoder/PropertyListDecoder</code>ï¼Œå®ƒä»¬å­˜åœ¨äº Foundation ä¸­ã€‚</p><h2 id="jsonencoderjsondecoder"><a class="markdownIt-Anchor" href="#jsonencoderjsondecoder"></a> JSONEncoder/JSONDecoder</h2><h3 id="ä¸éœ€è¦æ‰‹åŠ¨è§£ç "><a class="markdownIt-Anchor" href="#ä¸éœ€è¦æ‰‹åŠ¨è§£ç "></a> ä¸éœ€è¦æ‰‹åŠ¨è§£ç </h3><p>å±æ€§å = keyï¼Œå±æ€§ç±»å‹ = value ç±»å‹ä¸€è‡´ï¼Œä½¿ç”¨ decoder å¯¹jsonè§£ç ï¼Œä¸éœ€è¦æ‰‹åŠ¨è§£ç äº†</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> json = <span class="string">"""</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        "name": "Banana",</span></span><br><span class="line"><span class="string">        "points": 200,</span></span><br><span class="line"><span class="string">        "description": "A banana grown in Ecuador."</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        "name": "Orange",</span></span><br><span class="line"><span class="string">        "points": 100</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">"""</span>.data(using: .utf8)!</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GroceryProduct</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> points: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">var</span> description: <span class="type">String?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£ç </span></span><br><span class="line"><span class="keyword">let</span> decoder = <span class="type">JSONDecoder</span>()</span><br><span class="line"><span class="keyword">let</span> products = <span class="keyword">try</span> decoder.decode([<span class="type">GroceryProduct</span>].<span class="keyword">self</span>, from: json)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The following products are available:"</span>)</span><br><span class="line"><span class="keyword">for</span> product <span class="keyword">in</span> products &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"\t\(product.name) (\(product.points) points)"</span>)</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> description = product.description &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\t\t\(description)"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ä¸Šæ–‡æ— å…³ï¼Œåªæè¿°ä¸‹ç¼–ç è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">let</span> jsonEncoder = <span class="type">JSONEncoder</span>()</span><br><span class="line"><span class="keyword">let</span> jsonData = <span class="keyword">try</span>? jsonEncoder.encode(products)</span><br><span class="line"><span class="keyword">let</span> str = <span class="type">String</span>(decoding: jsonData!, <span class="keyword">as</span>: <span class="type">UTF8</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="built_in">print</span>(str)</span><br><span class="line"><span class="keyword">let</span> jsonObject = <span class="keyword">try</span> <span class="type">JSONSerialization</span>.jsonObject(with: jsonData!, options: .allowFragments)</span><br><span class="line"><span class="built_in">print</span>(jsonObject)</span><br></pre></td></tr></table></figure><p>GroceryProduct ç±»ä¸­å±æ€§éƒ½éµå¾ª <code>Codable</code> åè®®ï¼ŒArrayä¹Ÿæ˜¯ï¼Œæ‰€ä»¥ä¸éœ€è¦å®ç° <code>encode(to encoder: Encoder)</code> å’Œ <code>init(from decoder: Decoder)</code> æ–¹æ³•</p><h3 id="éœ€è¦æ‰‹åŠ¨è§£ç "><a class="markdownIt-Anchor" href="#éœ€è¦æ‰‹åŠ¨è§£ç "></a> éœ€è¦æ‰‹åŠ¨è§£ç </h3><h4 id="jsonä¸­çš„keyå€¼ä¸å±æ€§åç§°ä¸ä¸€è‡´"><a class="markdownIt-Anchor" href="#jsonä¸­çš„keyå€¼ä¸å±æ€§åç§°ä¸ä¸€è‡´"></a> jsonä¸­çš„keyå€¼ä¸å±æ€§åç§°ä¸ä¸€è‡´</h4><p>ä½†æ˜¯è¿™ä¸ªç±»å‹å®é™…ä¸Šå¹¶ä¸â¼€å®šéœ€è¦æ˜¯æš ä¸¾)ã€‚æä¾›â¾ƒå®šä¹‰çš„ç¼–ç é”®æ˜¯â¼€ç§å¾ˆç®€å•ï¼Œâ½½ä¸”æ˜¯å£°æ˜å¼çš„æ”¹å˜ç±»å‹ç¼–ç çš„â½…å¼ã€‚åœ¨æšä¸¾ä¸­ï¼Œæˆ‘ ä»¬å¯ä»¥ï¼š</p><p>â†’ ä½¿â½¤æ˜ç¡®ç»™å®šçš„å­—ç¬¦ä¸²å€¼ï¼Œåœ¨ç¼–ç åçš„è¾“å‡ºä¸­é‡å‘½åå­—æ®µï¼Œæˆ–è€…</p><p>â†’ å°†æŸä¸ªé”®ä»æšä¸¾ä¸­ç§»é™¤ï¼Œä»¥æ­¤å®Œå…¨è·³è¿‡å­—æ®µã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> json = <span class="string">"""</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        "product_name": "Bananas",</span></span><br><span class="line"><span class="string">        "product_cost": 200,</span></span><br><span class="line"><span class="string">        "description": "A banana grown in Ecuador."</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        "product_name": "Oranges",</span></span><br><span class="line"><span class="string">        "product_cost": 100,</span></span><br><span class="line"><span class="string">        "description": "A juicy orange."</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">"""</span>.data(using: .utf8)!</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GroceryProduct</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> points: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">var</span> description: <span class="type">String?</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> name = <span class="string">"product_name"</span></span><br><span class="line">    <span class="keyword">case</span> points = <span class="string">"product_cost"</span></span><br><span class="line">    <span class="keyword">case</span> description</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> decoder = <span class="type">JSONDecoder</span>()</span><br><span class="line"><span class="keyword">let</span> products = <span class="keyword">try</span> decoder.decode([<span class="type">GroceryProduct</span>].<span class="keyword">self</span>, from: json)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The following products are available:"</span>)</span><br><span class="line"><span class="keyword">for</span> product <span class="keyword">in</span> products &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">"\t\(product.name) (\(product.points) points)"</span>)</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> description = product.description &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\t\t\(description)"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹åµŒå¥—"><a class="markdownIt-Anchor" href="#ç±»å‹åµŒå¥—"></a> ç±»å‹åµŒå¥—</h3><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="å¼€å‘è¯­è¨€" scheme="https://changzw.github.io/categories/%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80/"/>
    
      <category term="swift" scheme="https://changzw.github.io/categories/%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80/swift/"/>
    
    
      <category term="swift" scheme="https://changzw.github.io/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>Texture å¸ƒå±€</title>
    <link href="https://changzw.github.io/2018/04/11/Texture-%E5%B8%83%E5%B1%80/"/>
    <id>https://changzw.github.io/2018/04/11/Texture-%E5%B8%83%E5%B1%80/</id>
    <published>2018-04-11T03:10:14.000Z</published>
    <updated>2020-04-25T02:31:32.562Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --><a id="more"></a><h2 id="texture-ç›®æ ‡ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#texture-ç›®æ ‡ä¼˜ç‚¹"></a> Texture ç›®æ ‡&amp;ä¼˜ç‚¹</h2><p>Texture çš„ Layout APIæ˜¯ UIKit AutoLayout çš„é«˜æ•ˆæ›¿ä»£å“</p><ul><li>Fastï¼šè‡ªåŠ¨å¸ƒå±€æ¯” AutoLayout å¿«çš„å¤š</li><li>Asynchronous &amp; Concurrent: Layout åœ¨åå°è®¡ç®—ï¼Œæ‰€ä»¥ç”¨æˆ·äº¤äº’ä¸ä¼šè¢«ç»ˆç«¯</li><li>Declarativeï¼šå¸ƒå±€ç”¨ä¸å¯å˜çš„æ•°æ®ç»“æ„å£°æ˜ã€‚è¿™ä½¿å¸ƒå±€ä»£ç æ›´æ˜“äºå¼€å‘ï¼Œæ–‡æ¡£ç¼–åˆ¶ï¼Œä»£ç å®¡æŸ¥ï¼Œæµ‹è¯•ï¼Œè°ƒè¯•ï¼Œé…ç½®æ–‡ä»¶å’Œç»´æŠ¤ã€‚</li><li>Cacheableï¼šå¸ƒå±€ç»“æœæ˜¯ä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤å¯ä»¥åœ¨åå°å¯¹å…¶è¿›è¡Œé¢„å…ˆè®¡ç®—å¹¶è¿›è¡Œç¼“å­˜ä»¥æé«˜ç”¨æˆ·çš„æ„ŸçŸ¥æ€§èƒ½ã€‚</li><li>Extensibleï¼šæ˜“äºåœ¨ç±»ä¹‹é—´å…±äº«ä»£ç ã€‚</li></ul><p>å— CSS Flexbox æ¨¡å‹å¯å‘<a href="https://changzw.github.io/2017/12/09/flexbox-model/">flexbox model</a></p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¦‚å¿µ"></a> åŸºæœ¬æ¦‚å¿µ</h2><p>Texture å¸ƒå±€ç³»ç»Ÿçš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p><ol><li>Layout Specs</li><li>Layout Elements</li></ol><h3 id="layout-specs"><a class="markdownIt-Anchor" href="#layout-specs"></a> Layout Specs</h3><p>class <code>ASLayoutSpec</code><br>å¸ƒå±€è§„èŒƒï¼ˆlayout specificationï¼‰é€šè¿‡äº†è§£è¿™äº›å­å¸ƒå±€å…ƒç´ ä¹‹é—´çš„ç›¸äº’å…³ç³»å¸ƒå±€å…ƒç´ ï¼Œæ˜¯å¸ƒå±€å…ƒç´ çš„å®¹å™¨ã€‚</p><h3 id="layout-elements"><a class="markdownIt-Anchor" href="#layout-elements"></a> Layout Elements</h3><p>protocol <code>&lt;ASLayoutElement&gt;</code><br>Layout Specs åŒ…å«å¹¶æ’åˆ— Layout Elements<br>æ‰€æœ‰ <code>ASDisplayNodes</code> &amp; <code>ASLayoutSpecs</code> éƒ½éµå¾ª<aslayoutelement>åè®®</aslayoutelement></p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-----------------------ASStackLayoutSpec----------------------</span><br><span class="line">|  -----ASStackLayoutSpec-----  -----ASStackLayoutSpec-----  |</span><br><span class="line">|  |       ASImageNode       |  |       ASImageNode       |  |</span><br><span class="line">|  |       ASImageNode       |  |       ASImageNode       |  |</span><br><span class="line">|  ---------------------------  ---------------------------  |</span><br><span class="line">--------------------------------------------------------------</span><br></pre></td></tr></table></figure><h2 id="layout-specs-å­ç±»"><a class="markdownIt-Anchor" href="#layout-specs-å­ç±»"></a> Layout Specs å­ç±»</h2><ul><li>ASWrapperLayoutSpec</li><li>ASStackLayoutSpec</li><li>ASInsetLayoutSpec</li><li>ASOverlayLayoutSpec</li><li>ASBackgroundLayoutSpec</li><li>ASCenterLayoutSpec</li><li>ASRatioLayoutSpec</li><li>ASRelativeLayoutSpec</li><li>ASAbsoluteLayoutSpec</li><li>ASCornerLayoutSpec</li></ul><h3 id="aswrapperlayoutspec"><a class="markdownIt-Anchor" href="#aswrapperlayoutspec"></a> ASWrapperLayoutSpec</h3><p>å®ƒå¯ä»¥åŒ…è£¹ä¸€ä¸ª <code>ASLayoutElement</code> ï¼Œé€šè¿‡è¿™ä¸ª element çš„siez set è®¡ç®—è¿™ä¸ª element çš„layoutã€‚</p><p>ç”¨äºï¼š<br><code>ASWrapperLayoutSpec</code> å¯¹äºåœ¨ <code>-layoutSpecThatFits:</code> ä¸­åŒ…è£¹å•ä¸ª nodeï¼Œè¿”å›spec.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// return a single subnode from layoutSpecThatFits:</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">ASWrapperLayoutSpec</span>(layoutElement: _subnode)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set a size (but not position)</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  _subnode.style.preferredSize = <span class="type">CGSize</span>(width: constrainedSize.<span class="built_in">max</span>.width,</span><br><span class="line">                                        height: constrainedSize.<span class="built_in">max</span>.height / <span class="number">2.0</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="type">ASWrapperLayoutSpec</span>(layoutElement: _subnode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asinsetlayoutspec"><a class="markdownIt-Anchor" href="#asinsetlayoutspec"></a> ASInsetLayoutSpec</h3><p>ç»™ element æ·»åŠ  inset marginã€‚element å¿…é¡»æœ‰ instrinsic size or æ˜¾ç¤ºè®¾ç½®çš„size</p><div align="left"><img src="/img/texture-insetlayout.jpeg" alt="runloop" style="width:150px;height:96px"></div><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> insets = <span class="type">UIEdgeInsets</span>(top: <span class="number">10.0</span>, <span class="keyword">left</span>: <span class="number">10.0</span>, bottom: <span class="number">10.0</span>, <span class="keyword">right</span>: <span class="number">10.0</span>)</span><br><span class="line">  <span class="keyword">let</span> headerWithInset = <span class="type">ASInsetLayoutSpec</span>(insets: insets, child: textNode)</span><br><span class="line">  <span class="keyword">return</span> headerWithInset</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asoverlaylayoutspec"><a class="markdownIt-Anchor" href="#asoverlaylayoutspec"></a> ASOverlayLayoutSpec</h3><p>é‡å å¸ƒå±€è§„èŒƒå°ºå¯¸æ˜¯æ ¹æ® element çš„å°ºå¯¸è®¡ç®—å¾—å‡ºçš„ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œelement æ˜¯è“è‰²å±‚<br>é‡å å¸ƒå±€è§„èŒƒå°ºå¯¸æ˜¯æ ¹æ®åŒ…è£¹ element çš„å°ºå¯¸è®¡ç®—å‡ºæ¥çš„ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œå­å…ƒç´ æ˜¯è“è‰²å›¾å±‚ã€‚è“è‰² element ä¼šæŠŠä»–çš„ size ä½œä¸º <code>constrainedSize</code> ä¼ ç»™é‡å å¸ƒå±€å…ƒç´ ï¼ˆçº¢è‰²å›¾å±‚ï¼‰ã€‚æ‰€ä»¥ element ï¼ˆè“è‰²layerï¼‰å¿…é¡»è¦æœ‰è‡ªå·±çš„ intrinsic size æˆ–è€… å·²ç»è®¾ç½® sizeäº†ã€‚</p><div align="left"><img src="/img/texture-OverlayLayout.jpeg" alt="OverlayLayout" style="width:150px;height:96px"></div><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> backgroundNode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.blue)</span><br><span class="line">  <span class="keyword">let</span> foregroundNode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.red)</span><br><span class="line">  <span class="keyword">return</span> <span class="type">ASOverlayLayoutSpec</span>(child: backgroundNode, overlay: foregroundNode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asbackgroundlayoutspec"><a class="markdownIt-Anchor" href="#asbackgroundlayoutspec"></a> ASBackgroundLayoutSpec</h3><p>ASBackgroundLayoutSpec å¸ƒå±€ä¸€ä¸ªç»„ä»¶ï¼ˆè“è‰²ï¼‰ï¼Œå¹¶æ‹‰ä¼¸å…¶åçš„å¦ä¸€ä¸ªç»„ä»¶ä½œä¸ºèƒŒæ™¯ï¼ˆçº¢è‰²ï¼‰ã€‚</p><p>background è§„èŒƒ sizeæ ¹æ® child çš„å°ºå¯¸è®¡ç®—ã€‚ä¸‹å›¾ä¸­ï¼Œè“è‰²æ˜¯childã€‚å°† blue child çš„size å½“åš <code>constrainedSize</code> ä¼ ç»™ background layout element (red layer). so child(blue layer) ä¸€å®šè¦æœ‰è‡ªå·±çš„intrinsic size æˆ–è€… å·²ç»è®¾ç½® sizeäº†ã€‚</p><div align="left"><img src="/img/Texture-BackgroundLayout.jpeg" alt="Texture-BackgroundLayout" style="width:150px;height:110px"></div><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> backgroundNode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.red)</span><br><span class="line">  <span class="keyword">let</span> foregroundNode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.blue)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="type">ASBackgroundLayoutSpec</span>(child: foregroundNode, background: backgroundNode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ascenterlayoutspec"><a class="markdownIt-Anchor" href="#ascenterlayoutspec"></a> ASCenterLayoutSpec</h3><p>ASCenterLayoutSpec åœ¨æœ€å¤§ <code>constrainedSize</code> å°†æ”¾åœ¨ child ä¸­å¿ƒä½ç½®ã€‚<br>å¦‚æœcenter specâ€™s width å’Œ height æ²¡æœ‰é™åˆ¶ï¼Œé‚£ä¹ˆ ASCenterLayoutSpec ç¼©åˆ° child çš„sizeå¤§å°ã€‚</p><p><code>ASCenterLayoutSpec</code> ä¸¤ä¸ªå±æ€§:</p><ul><li>centeringOptions. ç¡®å®š child å¦‚ä½•åœ¨ä¸­å¿ƒè§„æ ¼å†…å±…ä¸­ã€‚é€‰é¡¹åŒ…æ‹¬ï¼šNone, X, Y, XY.</li><li>sizingOptions. ç¡®å®šä¸­å¿ƒè§„æ ¼å°†å ç”¨å¤šå°‘ç©ºé—´ã€‚é€‰é¡¹åŒ…æ‹¬ï¼šDefault, minimum X, minimum Y, minimum XY.</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> subnode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.green, <span class="type">CGSize</span>(width: <span class="number">60.0</span>, height: <span class="number">100.0</span>))</span><br><span class="line">  <span class="keyword">let</span> centerSpec = <span class="type">ASCenterLayoutSpec</span>(centeringOptions: .<span class="type">XY</span>, sizingOptions: [], child: subnode)</span><br><span class="line">  <span class="keyword">return</span> centerSpec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asratiolayoutspec"><a class="markdownIt-Anchor" href="#asratiolayoutspec"></a> ASRatioLayoutSpec</h3><p>ASRatioLayoutSpec ä½¿ç”¨å›ºå®šå®½é«˜æ¯”æ¥å¸ƒå±€ç»„ä»¶ã€‚ASRatioLayoutSpec ä»–çš„ <code>constrainedSize</code> å¿…é¡»è¦é…ç½® width or heightã€‚è¿™æ ·æ‰èƒ½å¤Ÿä½¿ç”¨ scale</p><p>ASRatioLayoutSpec ç»å¸¸ç”¨äºé‚£äº›æ²¡æœ‰ intrinsic size çš„nodeï¼ˆASNetworkImageNode or ASVideoNodeï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  <span class="comment">// Half Ratio</span></span><br><span class="line">  <span class="keyword">let</span> subnode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.green, <span class="type">CGSize</span>(width: <span class="number">100</span>, height: <span class="number">100.0</span>))</span><br><span class="line">  <span class="keyword">let</span> ratioSpec = <span class="type">ASRatioLayoutSpec</span>(ratio: <span class="number">0.5</span>, child: subnode)</span><br><span class="line">  <span class="keyword">return</span> ratioSpec</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asrelativelayoutspec"><a class="markdownIt-Anchor" href="#asrelativelayoutspec"></a> ASRelativeLayoutSpec</h3><p>å¹¶æ ¹æ®å‚ç›´å’Œæ°´å¹³ä½ç½®è¯´æ˜ç¬¦å¯¹ç»„ä»¶è¿›è¡Œå¸ƒå±€.<br>ä¸â€œ 9éƒ¨åˆ†â€å›¾åƒåŒºåŸŸç›¸ä¼¼ï¼Œå¯ä»¥å°†å­©å­æ”¾ç½®åœ¨4ä¸ªè§’çš„ä»»æ„ä¸€ä¸ªæˆ–4ä¸ªè¾¹ç¼˜ä¸­çš„ä»»æ„ä¸€ä¸ªçš„ä¸­é—´ä»¥åŠä¸­å¿ƒã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> backgroundNode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.blue)</span><br><span class="line">  <span class="keyword">let</span> foregroundNode = <span class="type">ASDisplayNodeWithBackgroundColor</span>(<span class="type">UIColor</span>.red, <span class="type">CGSize</span>(width: <span class="number">70.0</span>, height: <span class="number">100.0</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> relativeSpec = <span class="type">ASRelativeLayoutSpec</span>(horizontalPosition: .start,</span><br><span class="line">                                          verticalPosition: .start,</span><br><span class="line">                                          sizingOption: [],</span><br><span class="line">                                          child: foregroundNode)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> backgroundSpec = <span class="type">ASBackgroundLayoutSpec</span>(child: relativeSpec, background: backgroundNode)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asabsolutelayoutspec"><a class="markdownIt-Anchor" href="#asabsolutelayoutspec"></a> ASAbsoluteLayoutSpec</h3><p>é€šè¿‡è®¾ç½®å…¶å­èŠ‚ç‚¹çš„layoutPositionå±æ€§æ¥æŒ‡å®šå…¶å­èŠ‚ç‚¹çš„ç¡®åˆ‡ä½ç½®ï¼ˆx / yåæ ‡ï¼‰ã€‚<br>ç»å¯¹å¸ƒå±€æ¯”å…¶ä»–ç±»å‹çš„å¸ƒå±€æ›´ä¸çµæ´»ä¸”éš¾ä»¥ç»´æŠ¤ã€‚</p><p>å”¯ä¸€å±æ€§sizing: ç¡®å®š ASAbsoluteLayoutSpec å ç”¨å¤šå°‘ç©ºé—´ã€‚é€‰é¡¹åŒ…æ‹¬ï¼šDefault å’Œ Size to Fitã€‚è¯·æ³¨æ„ï¼ŒSize to Fit é€‰é¡¹å°†å¤åˆ¶æ—§çš„ASStaticLayoutSpecçš„è¡Œä¸º</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> maxConstrainedSize = constrainedSize.<span class="built_in">max</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Layout all nodes absolute in a static layout spec</span></span><br><span class="line">  guitarVideoNode.style.layoutPosition = <span class="type">CGPoint</span>.zero</span><br><span class="line">  guitarVideoNode.style.preferredSize = <span class="type">CGSize</span>(width: maxConstrainedSize.width, height: maxConstrainedSize.height / <span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line">  nicCageVideoNode.style.layoutPosition = <span class="type">CGPoint</span>(x: maxConstrainedSize.width / <span class="number">2.0</span>, y: maxConstrainedSize.height / <span class="number">3.0</span>)</span><br><span class="line">  nicCageVideoNode.style.preferredSize = <span class="type">CGSize</span>(width: maxConstrainedSize.width / <span class="number">2.0</span>, height: maxConstrainedSize.height / <span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line">  simonVideoNode.style.layoutPosition = <span class="type">CGPoint</span>(x: <span class="number">0.0</span>, y: maxConstrainedSize.height - (maxConstrainedSize.height / <span class="number">3.0</span>))</span><br><span class="line">  simonVideoNode.style.preferredSize = <span class="type">CGSize</span>(width: maxConstrainedSize.width / <span class="number">2.0</span>, height: maxConstrainedSize.height / <span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line">  hlsVideoNode.style.layoutPosition = <span class="type">CGPoint</span>(x: <span class="number">0.0</span>, y: maxConstrainedSize.height / <span class="number">3.0</span>)</span><br><span class="line">  hlsVideoNode.style.preferredSize = <span class="type">CGSize</span>(width: maxConstrainedSize.width / <span class="number">2.0</span>, height: maxConstrainedSize.height / <span class="number">3.0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="type">ASAbsoluteLayoutSpec</span>(children: [guitarVideoNode, nicCageVideoNode, simonVideoNode, hlsVideoNode])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ascornerlayoutspec"><a class="markdownIt-Anchor" href="#ascornerlayoutspec"></a> ASCornerLayoutSpec</h3><p>ASCornerLayoutSpec æä¾›ä¸€ä¸ªç®€å•æ–¹æ³•ï¼ŒæŠŠ element æ”¾åœ¨è§’è½ã€‚</p><div align="left"><img src="/img/texture-CornerLayout.jpeg" alt="Texture-BackgroundLayout" style="width:80px;height:80px"></div><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// Layout the center of badge to the top right corner of avatar.</span></span><br><span class="line">  <span class="keyword">let</span> cornerSpec = <span class="type">ASCornerLayoutSpec</span>(child: avatarNode, corner: badgeNode, location: .topRight)</span><br><span class="line">  <span class="comment">// Slightly shift center of badge inside of avatar.</span></span><br><span class="line">  cornerSpec.offset = <span class="type">CGPoint</span>(x: -<span class="number">3</span>, y: <span class="number">3</span>)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="aslayoutspec"><a class="markdownIt-Anchor" href="#aslayoutspec"></a> ASLayoutSpec</h3><ol><li>æ‰€æœ‰ layout spec éƒ½ç»§æ‰¿è‡ªå®ƒ</li><li>ä¸»è¦ä»»åŠ¡ï¼šå¤„ç† children å¸ƒå±€ç®¡ç†ï¼Œç”¨æˆ·å¯ä»¥ å­ç±»åŒ–å®ƒå®ç°è‡ªå·±è‡ªå®šä¹‰ layout specã€‚</li><li>ä½œä¸ºé—´éš”åŒºï¼šå……å½“ <code>ASStackLayoutSpec</code> çš„spacerï¼Œå½“ä½¿ç”¨ <code>.flexGrow</code> and/or <code>.flexShrink</code> æ—¶å€™</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> spacer = <span class="type">ASLayoutSpec</span>()</span><br><span class="line">  spacer.style.flexGrow = <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">  stack.children = [imageNode, spacer, textNode]</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asstacklayoutspecflexbox-container"><a class="markdownIt-Anchor" href="#asstacklayoutspecflexbox-container"></a> ASStackLayoutSpec(Flexbox Container)</h3><p>ç›¸å…³å±æ€§å¯¹ç…§<a href="https://changzw.github.io/2017/12/09/flexbox-model/">flexbox-model</a></p><p>æœ‰ 7 ä¸ªå±æ€§ï¼š</p><ul><li>direction. ç¡®å®š stack æ–¹å‘ã€‚å¦‚æœå·²ç»è®¾ç½®äº† horizontalAlignment and verticalAlignment, ä»–ä»¬ä¼šè¢«é‡æ–°è§£æä¸€éã€‚å¯¼è‡´ justifyContent and alignItemsä¹Ÿä¼šç›¸åº”çš„å˜åŒ–ã€‚</li><li>spacing. æ¯ä¸ª child element ä¹‹é—´çš„è·ç¦».</li><li>horizontalAlignment. æŒ‡å®š children æ˜¯å¦‚ä½•æ°´å¹³å¯¹é½çš„ã€‚æ ¹æ®stack directionæ–¹å‘ã€‚è®¾ç½®å¯¹é½æ–¹å¼ ä¼šå¯¼è‡´ justifyContent or alignItems æ›´æ–°ã€‚</li><li>verticalAlignment. æŒ‡å®š children æ˜¯å¦‚ä½•å‚ç›´å¯¹é½çš„ã€‚æ ¹æ®stack directionæ–¹å‘ã€‚è®¾ç½®å¯¹é½æ–¹å¼ ä¼šå¯¼è‡´ justifyContent or alignItems æ›´æ–°ã€‚</li><li>justifyContent. æ²¿ä¸»è½´çš„å¯¹é½æ–¹å¼.</li><li>alignItems. æ²¿äº¤å‰è½´çš„æ–¹å‘å¸ƒå±€.</li><li>flexWrap. element å †å æˆå•è¡Œè¿˜æ˜¯å¤šè¡Œã€‚é»˜è®¤ä¸ºå•è¡Œã€‚</li><li>alignContent. å…ƒç´ ç»„æˆæœ‰å¤šè¡Œï¼Œcross-axisæ–¹å‘ç©ºé—´å……è¶³ï¼Œå†…å®¹è¡Œçš„å¯¹é½æ–¹å¼ã€‚</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> mainStack = <span class="type">ASStackLayoutSpec</span>(direction: .horizontal,</span><br><span class="line">                                    spacing: <span class="number">6.0</span>,</span><br><span class="line">                                    justifyContent: .start,</span><br><span class="line">                                    alignItems: .center,</span><br><span class="line">                                    children: [titleNode, subtitleNode])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set some constrained size to the stack</span></span><br><span class="line">  mainStack.style.minWidth = <span class="type">ASDimensionMakeWithPoints</span>(<span class="number">60.0</span>)</span><br><span class="line">  mainStack.style.maxHeight = <span class="type">ASDimensionMakeWithPoints</span>(<span class="number">40.0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mainStack</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="layout-element-å±æ€§"><a class="markdownIt-Anchor" href="#layout-element-å±æ€§"></a> Layout Element å±æ€§</h2><ul><li>ASStackLayoutElement Propertiesï¼šåªä¼šåœ¨ StackLayoutSpec ä¸­çš„å…ƒç´ (node or layout spec)ç”Ÿæ•ˆ</li><li>ASAbsoluteLayoutElement Propertiesï¼šåªä¼šåœ¨AbsoluateLayoutSpecä¸­çš„å…ƒç´ ï¼ˆ subnode æˆ– layoutSpecï¼‰ç”Ÿæ•ˆï¼›</li><li>ASLayoutElement Propertiesï¼šé€‚ç”¨äºæ‰€æœ‰ Node å’Œ layoutSpecï¼›</li></ul><h3 id="asstacklayoutelementflex-itemå±æ€§"><a class="markdownIt-Anchor" href="#asstacklayoutelementflex-itemå±æ€§"></a> ASStackLayoutElement(flex-item)å±æ€§</h3><p>ç›¸å…³å±æ€§å¯¹ç…§<a href="https://changzw.github.io/2017/12/09/flexbox-model/">flexbox-model</a></p><table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>.style.spacingBefore</td><td>CGFloat</td><td>direction ä¸Šä¸å‰ä¸€ä¸ª node çš„é—´éš”</td></tr><tr><td>.style.spacingAfter</td><td>CGFloat</td><td>direction ä¸Šä¸åä¸€ä¸ª node çš„é—´éš”</td></tr><tr><td>.style.flexGrow</td><td>Bool</td><td>å­èŠ‚ç‚¹å°ºå¯¸æ€»å’Œå°äº minimumå³å­˜åœ¨å‰©ä½™ç©ºé—´æ—¶ï¼Œæ˜¯å¦æ”¾å¤§</td></tr><tr><td>.style.flexShrink</td><td>Bool</td><td>å­èŠ‚ç‚¹æ€»å’Œå¤§äº maximumï¼Œå³ç©ºé—´ä¸è¶³æ—¶ï¼Œæ˜¯å¦ç¼©å°</td></tr><tr><td>.style.flexBasis</td><td>ASDimension</td><td>åœ¨ä½¿ç”¨flexGrow æˆ– flexShrink å±æ€§ä¹‹å‰ï¼Œå¹¶ä¸”å‰©ä½™ç©ºé—´è¢«å‡åˆ†ä¹‹å‰ï¼ŒæŒ‡å®šitemçš„åˆå§‹size</td></tr><tr><td>.style.alignSelf</td><td>ASStackLayoutAlignSelf</td><td>item åœ¨cross-axisæ–¹å‘å¸ƒå±€æ–¹å¼ï¼Œæ­¤å±æ€§ä¼šè¦†ç›– layoutSpec(flex-container) å±æ€§alignItemsï¼Œå¯é€‰å€¼æœ‰ï¼šAutoã€Startã€Endã€Centerã€Stretch</td></tr><tr><td>.style.ascender</td><td>CGFloat</td><td>ç”¨äºåŸºçº¿å¯¹é½ï¼Œæè¿°å¯¹è±¡ä»é¡¶éƒ¨åˆ°å…¶åŸºçº¿çš„è·ç¦»</td></tr><tr><td>.style.descender</td><td>CGFloat</td><td>ç”¨äºåŸºçº¿å¯¹é½ï¼Œæè¿°å¯¹è±¡ä»åŸºçº¿åˆ°å…¶åº•éƒ¨çš„è·ç¦»</td></tr></tbody></table><h3 id="asabsolutelayoutelement-å±æ€§"><a class="markdownIt-Anchor" href="#asabsolutelayoutelement-å±æ€§"></a> ASAbsoluteLayoutElement å±æ€§</h3><table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>.style.layoutPosition</td><td>CGPoint</td><td>è¯¥å¯¹è±¡åœ¨ ASAbsoluteLayoutSpec ä¸­çš„ä½ç½®</td></tr></tbody></table><h3 id="aslayoutelement-å±æ€§"><a class="markdownIt-Anchor" href="#aslayoutelement-å±æ€§"></a> ASLayoutElement å±æ€§</h3><table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>.style.width</td><td>ASDimension</td><td>æŒ‡å®š ASLayoutElement å†…å®¹åŒºåŸŸçš„å®½åº¦ã€‚minWidth å’Œ maxWidth å±æ€§ä¼šè¦†ç›– widthï¼Œé»˜è®¤å€¼ä¸º ASDimensionAuto</td></tr><tr><td>.style.height</td><td>ASDimension</td><td>æŒ‡å®šASLayoutElement å†…å®¹åŒºåŸŸçš„é«˜åº¦ã€‚minHeight å’Œ maxHeight å±æ€§ä¼šè¦†ç›– heightï¼Œé»˜è®¤å€¼ä¸º ASDimensionAuto</td></tr><tr><td>.style.minWidth</td><td>ASDimension</td><td>minWidth å±æ€§ç”¨äºè®¾ç½®ä¸€ä¸ªç‰¹å®šå¸ƒå±€å…ƒç´ çš„æœ€å°å®½åº¦.å®ƒå¯ä»¥é˜²æ­¢ width å±æ€§å€¼å°äº minWidth æŒ‡å®šçš„å€¼ï¼ŒminWidth çš„å€¼ä¼šè¦†ç›– maxWidth å’Œ width. é»˜è®¤å€¼ä¸º ASDimensionAuto</td></tr><tr><td>.style.maxWidth</td><td>ASDimension</td><td>maxWidth å±æ€§ç”¨äºè®¾ç½®ä¸€ä¸ªç‰¹å®šå¸ƒå±€å…ƒç´ çš„æœ€å¤§å®½åº¦.å®ƒå¯ä»¥é˜²æ­¢ width å±æ€§å€¼å¤§äº maxWidth æŒ‡å®šçš„å€¼. maxWidth çš„å€¼ä¼šè¦†ç›– widthï¼ŒminWidth ä¼šè¦†ç›– maxWidth. é»˜è®¤å€¼ä¸º ASDimensionAuto</td></tr><tr><td>.style.minHeight</td><td>ASDimension</td><td>minHeight å±æ€§ç”¨äºè®¾ç½®ä¸€ä¸ªç‰¹å®šå¸ƒå±€å…ƒç´ çš„æœ€å°é«˜åº¦.å®ƒå¯ä»¥é˜²æ­¢ height å±æ€§å€¼å°äº minHeight æŒ‡å®šçš„å€¼.minHeight çš„å€¼ä¼šè¦†ç›– maxHeight å’Œ height. é»˜è®¤å€¼ä¸º ASDimensionAuto</td></tr><tr><td>.style.maxHeight</td><td>ASDimension</td><td>maxHeight å±æ€§ç”¨äºè®¾ç½®ä¸€ä¸ªç‰¹å®šå¸ƒå±€å…ƒç´ çš„æœ€å¤§é«˜åº¦ï¼Œå®ƒå¯ä»¥é˜²æ­¢ height å±æ€§å€¼å¤§äº maxHeight æŒ‡å®šçš„å€¼.maxHeight çš„å€¼ä¼šè¦†ç›– heightï¼ŒminHeight ä¼šè¦†ç›– maxHeight.é»˜è®¤å€¼ä¸º ASDimensionAuto</td></tr><tr><td>.style.preferredSize</td><td>CGSize</td><td>æä¾›å¸ƒå±€å…ƒç´ çš„å»ºè®® size.å¦‚æœæä¾›äº† minSize æˆ– maxSizeï¼Œå¹¶ä¸” preferredSize è¶…è¿‡äº†è¿™äº›å€¼ï¼Œåˆ™å¼ºåˆ¶ä½¿ç”¨ minSize æˆ– maxSize.å¦‚æœæœªæä¾› preferredSizeï¼Œåˆ™å¸ƒå±€å…ƒç´ çš„ size é»˜è®¤ä¸º calculateSizeThatFits: æ–¹æ³•æä¾›çš„å›ºæœ‰å¤§å°.æ­¤æ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯å¯¹äºæ²¡æœ‰å›ºæœ‰å¤§å°æˆ–éœ€è¦ç”¨ä¸å›ºæœ‰å¤§å°ä¸åŒçš„çš„ size è¿›è¡Œå¸ƒå±€çš„èŠ‚ç‚¹ï¼Œåˆ™å¿…é¡»æŒ‡å®š preferredSize æˆ– preferredLayoutSize ä¸­çš„ä¸€ä¸ªï¼Œæ¯”å¦‚æ²¡è¿™ä¸ªå±æ€§å¯ä»¥åœ¨ ASImageNode ä¸Šè®¾ç½®ï¼Œä½¿è¿™ä¸ªèŠ‚ç‚¹çš„ size å’Œå›¾ç‰‡ size ä¸åŒ, è­¦å‘Šï¼šå½“ size çš„å®½åº¦æˆ–é«˜åº¦æ˜¯ç›¸å¯¹å€¼æ—¶è°ƒç”¨ getter å°†è¿›è¡Œæ–­è¨€</td></tr><tr><td>.style.minSize</td><td>CGSize</td><td>å¯é€‰å±æ€§ï¼Œä¸ºå¸ƒå±€å…ƒç´ æä¾›æœ€å°å°ºå¯¸ï¼Œå¦‚æœæä¾›ï¼ŒminSize å°†ä¼šå¼ºåˆ¶ä½¿ç”¨.å¦‚æœçˆ¶çº§å¸ƒå±€å…ƒç´ çš„ minSize å°äºå…¶å­çº§çš„ minSizeï¼Œåˆ™å¼ºåˆ¶ä½¿ç”¨å­çº§çš„ minSizeï¼Œå¹¶ä¸”å…¶å¤§å°å°†æ‰©å±•åˆ°å¸ƒå±€è§„åˆ™ä¹‹å¤–,ä¾‹å¦‚ï¼Œå¦‚æœç»™å…¨å±å®¹å™¨ä¸­çš„æŸä¸ªå…ƒç´ è®¾ç½® 50ï¼… çš„ preferredSize ç›¸å¯¹å®½åº¦ï¼Œå’Œ 200pt çš„ minSize å®½åº¦ï¼ŒpreferredSize ä¼šåœ¨ iPhone å±å¹•ä¸Šäº§ç”Ÿ 160pt çš„å®½åº¦ï¼Œä½†ç”±äº 160pt ä½äº 200pt çš„ minSize å®½åº¦ï¼Œå› æ­¤æœ€ç»ˆè¯¥å…ƒç´ çš„å®½åº¦ä¼šæ˜¯ 200pt</td></tr><tr><td>.style.maxSize</td><td>CGSize</td><td>å¯é€‰å±æ€§ï¼Œä¸ºå¸ƒå±€å…ƒç´ æä¾›æœ€å¤§å°ºå¯¸ï¼Œå¦‚æœæä¾›ï¼ŒmaxSize å°†ä¼šå¼ºåˆ¶ä½¿ç”¨</td></tr><tr><td>.style.preferredLayoutSize</td><td>ASLayoutSize</td><td>ä¸ºå¸ƒå±€å…ƒç´ æä¾›å»ºè®®çš„ç›¸å¯¹ size.ASLayoutSize ä½¿ç”¨ç™¾åˆ†æ¯”è€Œä¸æ˜¯ç‚¹æ¥æŒ‡å®šå¸ƒå±€.ä¾‹å¦‚ï¼Œå­å¸ƒå±€å…ƒç´ çš„å®½åº¦åº”è¯¥æ˜¯çˆ¶å®½åº¦çš„ 50ï¼….å¦‚æœæä¾›äº†å¯é€‰çš„ minLayoutSize æˆ– maxLayoutSizeï¼Œå¹¶ä¸” preferredLayoutSize è¶…è¿‡äº†è¿™äº›å€¼ï¼Œåˆ™å°†ä½¿ç”¨ minLayoutSize æˆ– maxLayoutSize</td></tr><tr><td>.style.minLayoutSize</td><td>ASLayoutSize</td><td>å¯é€‰å±æ€§ï¼Œä¸ºå¸ƒå±€å…ƒç´ æä¾›æœ€å°çš„ç›¸å¯¹å°ºå¯¸ï¼Œ å¦‚æœæä¾›ï¼ŒminLayoutSize å°†ä¼šå¼ºåˆ¶ä½¿ç”¨.å¦‚æœçˆ¶çº§å¸ƒå±€å…ƒç´ çš„ minLayoutSize å°äºå…¶å­çº§çš„ minLayoutSizeï¼Œåˆ™ä¼šå¼ºåˆ¶ä½¿ç”¨å­çº§çš„ minLayoutSizeï¼Œå¹¶ä¸”å…¶å¤§å°å°†æ‰©å±•åˆ°å¸ƒå±€è§„åˆ™ä¹‹å¤–</td></tr><tr><td>.style.maxLayoutSize</td><td>ASLayoutSize</td><td>å¯é€‰å±æ€§ï¼Œä¸ºå¸ƒå±€å…ƒç´ æä¾›æœ€å¤§çš„ç›¸å¯¹å°ºå¯¸.å¦‚æœæä¾›ï¼ŒmaxLayoutSize å°†ä¼šå¼ºåˆ¶ä½¿ç”¨.å¦‚æœçˆ¶çº§å¸ƒå±€å…ƒç´ çš„ maxLayoutSize å°äºå…¶å­çº§çš„ maxLayoutSizeï¼Œé‚£ä¹ˆå°†å¼ºåˆ¶ä½¿ç”¨å­çº§çš„ maxLayoutSizeï¼Œå¹¶ä¸”å…¶å¤§å°å°†æ‰©å±•åˆ°å¸ƒå±€è§„åˆ™ä¹‹å¤–</td></tr></tbody></table><h2 id="layout-api-sizing"><a class="markdownIt-Anchor" href="#layout-api-sizing"></a> Layout API Sizing</h2><p>åœ¨Layout APIä¸­ï¼Œç†è§£å¤åˆå°ºå¯¸ç±»å‹çš„æœ€ç®€å•æ–¹æ³•æ˜¯æŸ¥çœ‹æ‰€æœ‰çš„ unit ä¹‹é—´çš„å…³ç³»ã€‚</p><div align="left"><img src="/img/texture-sizing.jpeg" alt="texture-sizing" style="width:400px;height:100px"></div><h3 id="values-cgfloat-asdimension"><a class="markdownIt-Anchor" href="#values-cgfloat-asdimension"></a> Values (CGFloat, ASDimension)</h3><p>ASDimensionæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šçš„CGFloatï¼Œæ”¯æŒè¡¨ç¤ºç‚¹å€¼ï¼Œç›¸å¯¹ç™¾åˆ†æ¯”å€¼æˆ–è‡ªåŠ¨å€¼ã€‚</p><p>unit å…è®¸ç›¸åŒçš„APIæ¥å—å›ºå®šå€¼å’Œç›¸å¯¹å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dimension returned is relative (%)</span></span><br><span class="line"><span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br><span class="line"><span class="type">ASDimensionMakeWithFraction</span>(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// dimension returned in points</span></span><br><span class="line"><span class="type">ASDimensionMake</span>(<span class="string">"70pt"</span>)</span><br><span class="line"><span class="type">ASDimensionMake</span>(<span class="number">70</span>)</span><br><span class="line"><span class="type">ASDimensionMakeWithPoints</span>(<span class="number">70</span>)</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-asdimension-çš„ä¾‹å­"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-asdimension-çš„ä¾‹å­"></a> ä½¿ç”¨ ASDimension çš„ä¾‹å­</h3><p>ASDimension ç”¨äºè®¾ç½® <code>ASStackLayoutSpec</code> ä¸­element çš„ <code>flexBasis</code>. <code>flexBasis</code> å±æ€§åœ¨ stack layout ä¸­æŒ‡å®šå¯¹è±¡çš„åˆå§‹å¤§å°ï¼Œ</p><p>åœ¨ä¸‹é¢çš„è§†å›¾ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å·¦ä¾§å †æ ˆå æ®æ°´å¹³å®½åº¦çš„40ï¼…ï¼Œå³ä¾§å †æ ˆå æ®å®½åº¦çš„60ï¼…ã€‚</p><div align="left"><img src="/img/flexbasis.jpeg" alt="flexbasis" style="width:300px;height:450px"></div><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨æ°´å¹³å †æ ˆçš„ä¸¤ä¸ªå­çº§ä¸Šè®¾ç½®.flexBasiså±æ€§ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.leftStack.style.flexBasis = <span class="type">ASDimensionMake</span>(<span class="string">"40%"</span>)</span><br><span class="line"><span class="keyword">self</span>.rightStack.style.flexBasis = <span class="type">ASDimensionMake</span>(<span class="string">"60%"</span>)</span><br><span class="line"></span><br><span class="line">horizontalStack.children = [<span class="keyword">self</span>.leftStack, <span class="keyword">self</span>.rightStack]</span><br></pre></td></tr></table></figure><h3 id="sizes-cgsize-aslayoutsize"><a class="markdownIt-Anchor" href="#sizes-cgsize-aslayoutsize"></a> Sizes (CGSize, ASLayoutSize)</h3><p>ASLayoutSizeä¸CGSizeç›¸ä¼¼ï¼Œä½†æ˜¯å…¶å®½åº¦å’Œé«˜åº¦å€¼å¯ä»¥è¡¨ç¤ºç‚¹æˆ–ç™¾åˆ†æ¯”å€¼ã€‚å®½åº¦å’Œé«˜åº¦çš„ç±»å‹æ˜¯ç‹¬ç«‹çš„ï¼›ä¸€ä¸ªå¯ä»¥æ˜¯ç‚¹æˆ–ç™¾åˆ†æ¯”å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ASLayoutSizeMake</span>(<span class="type">ASDimension</span> width, <span class="type">ASDimension</span> height);</span><br></pre></td></tr></table></figure><p>ASLayoutSizeç”¨äºè®¾ç½®å¸ƒå±€å…ƒç´ çš„ <code>.preferredLayoutSize</code> , <code>.minLayoutSize</code> å’Œ <code>.maxLayoutSize</code> å±æ€§ã€‚å®ƒå…è®¸ç›¸åŒçš„APIæ¥å—å›ºå®šå¤§å°ä»¥åŠç›¸å¯¹å¤§å°ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dimension type "Auto" indicates that the layout element may </span></span><br><span class="line"><span class="comment">// be resolved in whatever way makes most sense given the circumstances</span></span><br><span class="line"><span class="keyword">let</span> width = <span class="type">ASDimensionMake</span>(.auto, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> height = <span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br><span class="line">layoutElement.style.preferredLayoutSize = <span class="type">ASLayoutSizeMake</span>(width, height)</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸éœ€è¦ç›¸å¯¹å€¼ï¼Œåˆ™å¯ä»¥è®¾ç½®å¸ƒå±€å…ƒç´ çš„.preferredSizeï¼Œ.minSizeå’Œ.maxSizeå±æ€§ã€‚è¿™äº›å±æ€§é‡‡ç”¨å¸¸è§„CGSizeå€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layoutElement.style.preferredSize = <span class="type">CGSize</span>(width: <span class="number">30</span>, height: <span class="number">60</span>)</span><br></pre></td></tr></table></figure><p>å¤§å¤šæ•°æ—¶å€™ï¼Œéƒ½ä¸æƒ³åŒæ—¶é™åˆ¶å®½åº¦å’Œé«˜åº¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ASDimensionå€¼åˆ†åˆ«è®¾ç½®å¸ƒå±€å…ƒç´ çš„å°ºå¯¸å±æ€§ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">layoutElement.style.width     = <span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br><span class="line">layoutElement.style.minWidth  = <span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br><span class="line">layoutElement.style.maxWidth  = <span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br><span class="line"></span><br><span class="line">layoutElement.style.height    = <span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br><span class="line">layoutElement.style.minHeight = <span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br><span class="line">layoutElement.style.maxHeight = <span class="type">ASDimensionMake</span>(<span class="string">"50%"</span>)</span><br></pre></td></tr></table></figure><h3 id="size-range-assizerange"><a class="markdownIt-Anchor" href="#size-range-assizerange"></a> Size Range (ASSizeRange)</h3><p>UIKitæ²¡æœ‰æä¾›ç»„åˆæœ€å°å’Œæœ€å¤§CGSizeçš„ structã€‚å› æ­¤ï¼Œåˆ›å»ºäº†ASSizeRangeä»¥æ”¯æŒæœ€å°å’Œæœ€å¤§CGSizeå¯¹ã€‚</p><p>ASSizeRangeé€šå¸¸ç”¨äºå¸ƒå±€APIçš„å†…éƒ¨ã€‚ä½†æ˜¯ï¼Œä½œä¸ºè¾“å…¥ä¼ é€’ç»™layoutSpecThatFitsï¼šçš„constrainedSizeå€¼æ˜¯ASSizeRangeã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">layoutSpecThatFits</span><span class="params">(<span class="number">_</span> constrainedSize: ASSizeRange)</span></span> -&gt; <span class="type">ASLayoutSpec</span></span><br></pre></td></tr></table></figure><p>ä¼ é€’ç»™ASDisplayNodeå­ç±»çš„layoutSpecThatFitsï¼šæ–¹æ³•çš„constrainedSizeæ˜¯èŠ‚ç‚¹åº”é€‚åˆçš„æœ€å°å’Œæœ€å¤§å¤§å°ã€‚constrainedSizeä¸­åŒ…å«çš„æœ€å°CGSizeå’Œæœ€å¤§CGSizeå¯ç”¨äºè°ƒæ•´èŠ‚ç‚¹çš„å¸ƒå±€å…ƒç´ çš„å¤§å°ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;!-- build time:Fri May 29 2020 12:55:11 GMT+0800 (CST) --&gt;
    
    </summary>
    
    
      <category term="ç¬¬ä¸‰æ–¹æ¡†æ¶" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
    
      <category term="UI å¸ƒå±€" scheme="https://changzw.github.io/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/UI-%E5%B8%83%E5%B1%80/"/>
    
    
      <category term="swift" scheme="https://changzw.github.io/tags/swift/"/>
    
      <category term="Texture" scheme="https://changzw.github.io/tags/Texture/"/>
    
      <category term="ç¿»è¯‘" scheme="https://changzw.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
</feed>
